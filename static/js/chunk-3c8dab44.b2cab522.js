/*!
 *  build: 杭州数蛙科技有限公司 
 *  copyright: dgiot_dashboard 
 *  time: Thu Apr 01 2021 11:01:36 GMT+0000 (Coordinated Universal Time)
 */
(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-3c8dab44"],{"05cc":function(e,t,a){"use strict";a("27c3")},"079a":function(e,t,a){},"0881":function(e,t,a){"use strict";a("24b5")},"0bff":function(e,t,a){"use strict";a("400c")},"0daa":function(e,t,a){"use strict";a.r(t);var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"rulesengine"},[a("div",{staticClass:"engintable"},[a("div",{staticClass:"engineheader"},[a("h3",[e._v(e._s(e.$translateTitle("rule.rule")))]),a("el-button",{staticStyle:{float:"right",margin:"19px 0"},attrs:{type:"primary",icon:"el-icon-plus",size:"small"},on:{click:e.addEngine}},[e._v(" "+e._s(e.$translateTitle("developer.add"))+" ")])],1),a("el-table",{staticStyle:{width:"100%","text-align":"center"},attrs:{data:e.engineData,"cell-class-name":e.getRowindex}},[a("el-table-column",{attrs:{label:"ID",align:"center",width:"180"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",{on:{click:function(a){return e.detailRules(t.row.id)}}},[e._v(e._s(t.row.id))])]}}])}),a("el-table-column",{attrs:{label:"主题",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(t.row.for.join(",")))])]}}])}),a("el-table-column",{attrs:{prop:"rawsql",align:"center",label:"SQL"}}),a("el-table-column",{attrs:{label:e.$translateTitle("rule.ResponseAction"),align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return e._l(t.row.actions,(function(t,i){return a("p",{key:i},[e._v(" "+e._s(t.name)+" ")])}))}}])}),a("el-table-column",{attrs:{align:"center",label:"已命中"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(e.matched(t.row.metrics)))])]}}])}),a("el-table-column",{attrs:{label:e.$translateTitle("developer.operation"),align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{type:"info",size:"mini",plain:""},on:{click:function(a){return e.detailRules(t.row.id)}}},[e._v(" 查看 ")]),a("el-button",{attrs:{type:"info",size:"mini",plain:""},on:{click:function(a){return e.deleteRule(t.row.id)}}},[e._v(" 删除 ")])]}}])})],1),a("div",{staticClass:"block"},[a("el-pagination",{attrs:{"page-sizes":[10,20,30,50],"page-size":e.pagesize,total:e.total,layout:"total, sizes, prev, pager, next, jumper"},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}})],1)],1)])},n=[],r=(a("d81d"),a("b0c0"),a("a15b"),a("1b07")),o={data:function(){return{engineData:[],pagesize:10,start:0,total:0}},mounted:function(){this.orginRule()},methods:{orginRule:function(){var e=this;Object(r["getRule"])().then((function(t){t&&(e.engineData=t,e.total=e.engineData.length)})).catch((function(t){e.$message(t.error)}))},handleSizeChange:function(e){},handleCurrentChange:function(e){},addEngine:function(){this.$router.push({path:"/rules_engine/addengine",query:{title:"新增"}})},matched:function(e){for(var t=0,a=0;a<e.length;a++)t+=e[a].matched;return t},actions:function(e){return e.map((function(e){return e.name})),string.join(",")},getRowindex:function(e,t,a){if(0==e.columnIndex)return"firstcolumn"},detailRules:function(e){this.$router.push({path:"/rules_engine/checkengine",query:{id:e}})},deleteRule:function(e){var t=this;Object(r["ruleDelete"])(e).then((function(e){e&&(t.$message("删除成功"),t.orginRule())})).catch((function(e){t.$message(e.error)}))}}},l=o,s=(a("71f7"),a("2877")),c=Object(s["a"])(l,i,n,!1,null,"4a45fe88",null);t["default"]=c.exports},"1aff":function(e,t,a){"use strict";a("3ac3")},"1bc4":function(e,t,a){"use strict";a("ba9b")},"21c1":function(e,t,a){},"24b5":function(e,t,a){},"27c3":function(e,t,a){},"2a70":function(e,t,a){},3152:function(e,t,a){},"31dc":function(e,t,a){"use strict";a("5f94")},"32b6":function(e,t,a){},3684:function(e,t,a){},"3ac3":function(e,t,a){},"3c50":function(e,t,a){"use strict";a.r(t);var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"devproduct"},[a("div",{staticClass:"prosecond"},[a("el-form",{staticClass:"demo-form-inline",attrs:{inline:!0,model:e.formInline,size:"small"}},[a("el-form-item",[a("el-input",{attrs:{placeholder:e.$translateTitle("product.searchproductname")},model:{value:e.formInline.productname,callback:function(t){e.$set(e.formInline,"productname",t)},expression:"formInline.productname"}})],1),a("el-form-item",[a("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.searchProduct(0)}}},[e._v(" "+e._s(e.$translateTitle("developer.search"))+" ")])],1),a("el-form-item",{staticStyle:{float:"right","text-align":"right"}},[a("el-button",{directives:[{name:"show",rawName:"v-show",value:""!=e.projectid,expression:"projectid != ''"}],attrs:{type:"primary"},on:{click:e.addproduct}},[e._v(" "+e._s(e.$translateTitle("product.createproduct"))+" ")]),a("el-button",{attrs:{type:"primary"},on:{click:e.addgroup}},[e._v("新增")])],1)],1),a("div",{staticClass:"protable"},[a("el-table",{staticStyle:{width:"100%"},attrs:{data:e.groupData}},[a("el-table-column",{attrs:{prop:"objectId",label:"ProductID"}}),a("el-table-column",{attrs:{label:e.$translateTitle("product.productname")},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(t.row.name))])]}}])}),a("el-table-column",{attrs:{label:e.$translateTitle("product.productgrouping")},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(t.row.devType))])]}}])}),a("el-table-column",{attrs:{label:e.$translateTitle("product.nodetype")},scopedSlots:e._u([{key:"default",fn:function(t){return[1==t.row.nodeType?a("span",[e._v(" "+e._s(e.$translateTitle("product.gateway"))+" ")]):e._e(),0==t.row.nodeType?a("span",[e._v(" "+e._s(e.$translateTitle("product.equipment"))+" ")]):e._e(),2==t.row.nodeType?a("span",[e._v("分组")]):e._e()]}}])}),a("el-table-column",{attrs:{label:e.$translateTitle("product.classification")},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(t.row.CategoryKey))])]}}])}),a("el-table-column",{attrs:{label:e.$translateTitle("product.addingtime")},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(e.utc2beijing(t.row.createdAt)))])]}}])}),a("el-table-column",{attrs:{label:e.$translateTitle("developer.operation"),width:"420"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-link",{attrs:{underline:!1,icon:"el-icon-office-building",type:"primary"},on:{click:function(a){return e.proudctView(t.row)}}},[e._v(" 运行组态 ")]),a("el-link",{attrs:{underline:!1,icon:"el-icon-link",type:"primary"},on:{click:function(a){return e.proudctEdit(t.row)}}},[e._v(" 编辑组态 ")]),a("el-link",{attrs:{underline:!1,icon:"el-icon-attract",type:"primary"},on:{click:function(a){return e.GoTodevices(t.row)}}},[e._v(" "+e._s(e.$translateTitle("product.equipment"))+" ")]),a("el-link",{attrs:{underline:!1,type:"primary",icon:"el-icon-view"},on:{click:function(a){return e.deviceToDetail(t.row)}}},[e._v(" 配置 ")]),a("el-popover",{ref:"popover-"+t.$index,attrs:{placement:"top",width:"300"}},[a("p",[e._v("确定删除这个"+e._s(t.row.name)+"产品吗？")]),a("div",{staticStyle:{margin:"0","text-align":"right"}},[a("el-button",{attrs:{size:"mini"},on:{click:function(e){t._self.$refs["popover-"+t.$index].doClose()}}},[e._v(" "+e._s(e.$translateTitle("developer.cancel"))+" ")]),a("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(a){return e.makeSure(t)}}},[e._v(" "+e._s(e.$translateTitle("developer.determine"))+" ")])],1),a("el-link",{attrs:{slot:"reference",underline:!1,icon:"el-icon-delete",type:"danger"},slot:"reference"},[e._v(" "+e._s(e.$translateTitle("developer.delete"))+" ")])],1)]}}])})],1)],1),a("div",{staticClass:"elpagination",staticStyle:{"margin-top":"20px"}},[a("el-pagination",{attrs:{"page-sizes":[10,20,30,50],"page-size":e.length,total:e.total,layout:"total, sizes, prev, pager, next, jumper"},on:{"size-change":e.productSizeChange,"current-change":e.productCurrentChange}})],1)],1),a("div",{staticClass:"prodialog"},[a("el-dialog",{attrs:{title:e.$translateTitle("product.createproduct"),visible:e.dialogFormVisible,"close-on-click-modal":!1,"before-close":e.handleClose,width:"40%",top:"5vh"},on:{"update:visible":function(t){e.dialogFormVisible=t}}},[a("div",{staticClass:"content"},[a("div",{staticClass:"contentone"},[a("div",{staticStyle:{display:"flex"}},[a("span",[e._v(e._s(e.$translateTitle("product.productinformation")))]),a("p",{staticStyle:{"flex-grow":"2",width:"auto",height:"1px",margin:"10px","border-top":"1px dashed #dddddd"}})]),a("el-form",{ref:"ruleForm",attrs:{model:e.form,rules:e.rules}},[a("el-form-item",{attrs:{label:e.$translateTitle("product.productname"),prop:"name"}},[a("el-input",{attrs:{autocomplete:"off"},model:{value:e.form.name,callback:function(t){e.$set(e.form,"name",t)},expression:"form.name"}})],1),a("el-form-item",{attrs:{label:"产品分组",prop:"devType"}},[a("el-input",{attrs:{autocomplete:"off"},model:{value:e.form.devType,callback:function(t){e.$set(e.form,"devType",t)},expression:"form.devType"}})],1),a("el-form-item",{attrs:{label:e.$translateTitle("product.classification")}},[a("el-cascader",{attrs:{options:e.categoryListOptions},model:{value:e.form.category,callback:function(t){e.$set(e.form,"category",t)},expression:"form.category"}})],1),a("el-form-item",{attrs:{rules:[{required:!0,message:"请选择所属应用",trigger:"blur"}],label:"所属应用"}},[a("el-select",{attrs:{disabled:""},on:{change:e.selectApp},model:{value:e.form.relationApp,callback:function(t){e.$set(e.form,"relationApp",t)},expression:"form.relationApp"}},e._l(e.allApps,(function(e,t){return a("el-option",{key:t,attrs:{label:e.title,value:e.title}})})),1)],1)],1)],1),a("div",{staticClass:"contenttwo",staticStyle:{"margin-top":"20px"}},[a("div",{staticStyle:{display:"flex"}},[a("span",[e._v(e._s(e.$translateTitle("product.nodetype")))]),a("p",{staticStyle:{"flex-grow":"2",width:"auto",height:"1px",margin:"10px","border-top":"1px dashed #dddddd"}})]),a("el-form",{ref:"ruleForm",attrs:{model:e.form,rules:e.rules}},[a("el-form-item",{attrs:{label:e.$translateTitle("product.nodetype"),prop:"nodeType"}},[a("el-radio-group",{on:{change:e.changeNode},model:{value:e.form.nodeType,callback:function(t){e.$set(e.form,"nodeType",t)},expression:"form.nodeType"}},[a("el-radio",{attrs:{label:0}},[e._v(" "+e._s(e.$translateTitle("product.equipment"))+" ")]),a("el-radio",{attrs:{label:1}},[e._v(" "+e._s(e.$translateTitle("product.gateway"))+" ")]),a("el-radio",{attrs:{label:2}},[e._v("分组")])],1)],1)],1)],1),a("div",{staticClass:"contentthird",staticStyle:{"margin-top":"20px"}},[a("div",{staticStyle:{display:"flex"}},[a("span",[e._v(" "+e._s(e.$translateTitle("product.networkinganddescription"))+" ")]),a("p",{staticStyle:{"flex-grow":"2",width:"auto",height:"1px",margin:"10px","border-top":"1px dashed #dddddd"}})]),a("el-form",{ref:"ruleForm",attrs:{model:e.form,rules:e.rules}},[a("el-form-item",{attrs:{label:e.$translateTitle("product.networking")+"(共"+e.channel.length+"项)",prop:"netType"}},[a("el-select",{attrs:{placeholder:e.$translateTitle("product.selectgateway")},model:{value:e.form.netType,callback:function(t){e.$set(e.form,"netType",t)},expression:"form.netType"}},e._l(e.channel,(function(e,t){return a("el-option",{key:t,attrs:{label:t+1+":"+e.label,value:e.value,title:"当前第"+(t+1)+"项"}})})),1)],1),a("el-form-item",{attrs:{label:"产品模型"}},[e.imageUrl?a("img",{staticClass:"avatar",attrs:{src:e.imageUrl}}):a("i",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"el-icon-plus avatar-uploader-icon"}),a("form",{ref:"uploadform",staticStyle:{position:"absolute"},attrs:{method:"POST",enctype:"multipart/form-data"}},[a("input",{staticStyle:{position:"relative",top:"-100px","z-index":"5",width:"100px",height:"100px",cursor:"pointer",opacity:"0"},attrs:{type:"file"},on:{change:function(t){return e.upload(t)}}})]),e.imageUrl?a("el-button",{staticStyle:{"vertical-align":"text-bottom"},attrs:{type:"danger",size:"mini"},on:{click:e.deleteImgsrc}},[e._v(" 删除 ")]):e._e()],1),a("el-form-item",{attrs:{label:e.$translateTitle("developer.describe"),prop:"desc"}},[a("el-input",{attrs:{type:"textarea"},model:{value:e.form.desc,callback:function(t){e.$set(e.form,"desc",t)},expression:"form.desc"}})],1)],1)],1)]),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.submitForm("ruleForm")}}},[e._v(" "+e._s(e.$translateTitle("developer.determine"))+" ")]),a("el-button",{on:{click:function(t){e.dialogFormVisible=!1}}},[e._v(" "+e._s(e.$translateTitle("developer.cancel"))+" ")])],1)])],1),a("div",{staticClass:"add-group"},[a("el-dialog",{attrs:{visible:e.groupform,title:"新增虚拟分组",width:"25%"},on:{"update:visible":function(t){e.groupform=t}}},[a("el-form",{ref:"addGroup",staticClass:"demo-ruleForm",attrs:{model:e.addGroup,"label-width":"80px"}},[a("el-row",[a("el-col",{attrs:{span:6}},[a("el-form-item",{attrs:{rules:[{required:!0,message:"分组名不能为空"}],label:"分组名",prop:"name"}})],1),a("el-col",{attrs:{span:18}},[a("el-input",{attrs:{type:"text",autocomplete:"off"},model:{value:e.addGroup.name,callback:function(t){e.$set(e.addGroup,"name",t)},expression:"addGroup.name"}})],1)],1)],1),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.addDeviceGroup()}}},[e._v("新增")]),a("el-button",{on:{click:function(t){return e.resetForm()}}},[e._v("重置")])],1)],1)],1),a("div",{staticClass:"import-dialog"},[a("el-dialog",{attrs:{visible:e.importDialogShow,title:"导入产品",width:"25%"},on:{"update:visible":function(t){e.importDialogShow=t}}},[a("el-form",{ref:"uploadProForm",attrs:{model:e.formPro}},[a("el-upload",{ref:"fileUpload",staticClass:"upload-demo",attrs:{action:e.uploadAction,data:e.uploadData,headers:e.uploadHeaders,"file-list":e.fileList,"on-change":e.handleChange,"with-credentials":!0,"auto-upload":!1,"on-success":e.handleUploadSuccess,"on-error":e.handleUploadError,accept:".xls, .xlsx, .zip"}},[a("el-button",{attrs:{slot:"trigger",size:"small",type:"primary"},slot:"trigger"},[e._v(" 选泽文件 ")])],1)],1),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{staticClass:"btn-left",attrs:{size:"small",type:"primary"},on:{click:e.submitUpload}},[e._v(" 上 传 ")]),a("el-button",{staticClass:"btn-right",attrs:{size:"small"},on:{click:function(t){e.importDialogShow=!1}}},[e._v(" 取 消 ")])],1)],1)],1)])},n=[],r=a("1da1"),o=(a("96cf"),a("b0c0"),a("4de4"),a("1276"),a("ac1f"),a("c19f"),a("d3b7"),a("5cc6"),a("9a8c"),a("a975"),a("735e"),a("c1ac"),a("d139"),a("3a7b"),a("d5d6"),a("82f81"),a("e91f"),a("60bd"),a("5f96"),a("3280"),a("3fcc"),a("ca91"),a("25a1"),a("cd26"),a("3c5d"),a("2954"),a("649e"),a("219c"),a("170b"),a("b39a"),a("72f7"),a("5319"),a("d81d"),a("99af"),a("7212")),l=a("5da9"),s=a("1285"),c=a("7497"),d=a("e0e9"),u=(a("30f8"),a("e455")),p=a("be65"),m=a.n(p),f=a("5638"),h={data:function(){return{hashkey:"",addGroup:{name:""},groupform:!1,length:10,total:0,start:0,activeName:"first",formInline:{productname:""},uploadHeaders:{sessionToken:m.a.get("access_token")},uploadAction:"",uploadData:{},fileList:[],productIdentifier:"",groupData:[],formLabelWidth:"80px",dialogFormVisible:!1,importDialogShow:!1,form:{name:"",category:[],nodeType:0,desc:"",netType:"",devType:"",productSecret:"",roles:[],relationApp:""},formPro:{name:"",url:""},rules:{roles:[{required:!0,message:"请选择所属应用",trigger:"blur"}],name:[{required:!0,message:"请输入产品",trigger:"blur"}],devType:[{required:!0,message:"请输入产品标识，用于区分不同设备",trigger:"blur"}],category:[{required:!0,message:"请选择所属分类",trigger:"change"}],nodeType:[{required:!0,message:"请选择节点类型",trigger:"change"}],netType:[{required:!0,message:"请选择联网方式",trigger:"change"}],relationApp:[{required:!0,message:"请选择产品可见角色",trigger:"change"}]},option:[],ruleoptions:[],channel:[{label:"蜂窝(2G/3G/4G)(直连)",value:"CELLULAR"},{label:"NB-IOT通道",value:"NB-IOT"},{label:"BLE(低功耗蓝牙)",value:"Bluetooth"},{label:"5G通道(直连)",value:"5G"},{label:"WIFI通道(直连)",value:"WIFI"},{label:"ZigBee通道",value:"ZigBee"},{label:"Modbus",value:"Modbus"},{label:"LoRa(WAN)(直连)",value:"LoRaWAN"},{label:"OPC UA",value:" OPC UA"},{label:"ZETA通道",value:"ZETA"},{label:"网线连接(直连)",value:"网线连接"},{label:"自定义",value:"OTHER"}],imageUrl:"",productid:"",loading:!1,allApps:[],categoryList:[],categoryListOptions:[],fileServer:"",access_token:"",projectid:"",projectName:"",allTableDate:[]}},computed:{},mounted:function(){this.Industry(),this.searchProduct(0)},beforeDestroy:function(){this.projectName=""},methods:{addDeviceGroup:function(){var e=this;this.$refs["addGroup"].validate((function(t){if(!t)return!1;Object(f["addGroup"])(e.addGroup.name).then((function(t){e.$message({message:"新建设备分组成功",type:"success"}),e.searchProduct(),e.groupform=!1})).catch((function(t){e.$message({message:"新建设备分组失败"+t.computed,type:"error"}),e.groupform=!1}))}))},resetForm:function(){this.$refs["addGroup"].resetFields()},changeNode:function(e,t){0!=t&&(this.form.netType=""),this.channel=0==e?[{label:"蜂窝(2G/3G/4G)",value:"CELLULAR"},{label:"NB-IOT通道",value:"NB-IOT"},{label:"BLE(低功耗蓝牙)",value:"Bluetooth"},{label:"5G通道",value:"5G"},{label:"WIFI通道",value:"WIFI"},{label:"ZigBee通道",value:"ZigBee"},{label:"LoRa(WAN)",value:"LoRaWAN"},{label:"Modbus",value:"Modbus"},{label:"OPC UA",value:" OPC UA"},{label:"ZETA通道",value:"ZETA"},{label:"网线连接",value:"网线连接"},{label:"自定义",value:"OTHER"}]:[{label:"蜂窝(2G/3G/4G)",value:"CELLULAR"},{label:"5G通道",value:"5G"},{label:"WIFI通道",value:"WIFI"},{label:"NB-IOT通道",value:"NB-IOT"},{label:"LoRaWAN",value:"LoRaWAN"},{label:"网线连接",value:"网线连接"},{label:"自定义",value:"OTHER"}]},selectApp:function(e){var t=this;e&&Object(l["getRole"])(e).then((function(e){e&&(t.fileServer=e.file,t.access_token=e.access_token)}))},treeData:function(e){var t=JSON.parse(JSON.stringify(e));return t.filter((function(e){var a=t.filter((function(t){return e.id==t.parentid}));return a.length>0&&(e.children=a),0==e.parentid}))},deleteImgsrc:function(){event.stopPropagation(),this.imageUrl=""},upload:function(e){if(this.loading=!0,e){var t=e.target.files[0],a=t.name,i=e.target.files[0].type,n=(t.type.split("/")[0],"image/jpeg"===i||"image/JPEG"===i||"image/png"===i||"image/PNG"===i||"image/bpm"===i||"image/BPM"===i);if(!n)return this.$message({message:"请上传图片",type:"error"}),!1;var r=new FileReader;r.readAsDataURL(t);var o=this;r.onloadend=function(){var e=r.result,t=o.dataURItoBlob(e);o.uploadFile(t,a)}}},dataURItoBlob:function(e){for(var t=atob(e.split(",")[1]),a=e.split(",")[0].split(":")[1].split(";")[0],i=new ArrayBuffer(t.length),n=new Uint8Array(i),r=0;r<t.length;r++)n[r]=t.charCodeAt(r);return new Blob([i],{type:a})},uploadFile:function(e,t){var a=this,i=new FormData;i.append("file",e,t),i.append("output","json"),i.append("path",this.form.relationApp),i.append("auth_token",this.access_token);this.$http.post(this.fileServer,i).then((function(e){e&&(a.imageUrl=e.body.url,a.loading=!1)})).catch((function(e){a.loading=!1,a.$message(e.bodyText)}))},submitUpload:function(){var e=this;this.uploadAction="/product",this.$nextTick((function(){e.uploadData.appid=m.a.get("appids"),e.$refs.fileUpload.submit()}))},handleUploadSuccess:function(e,t,a){this.$message({type:"success",message:"产品导入成功"}),this.importDialogShow=!1,this.$refs["uploadProForm"].resetFields(),this.searchProduct()},handleUploadError:function(e,t,a){this.$message({showClose:!0,message:e})},handleChange:function(e,t){t.length>0&&(this.fileList=[t[t.length-1]])},utc2beijing:function(e){var t=new Date(+new Date(e)+288e5).toISOString().replace(/T/g," ").replace(/\.[\d]{3}Z/,"");return t},getDict:function(e,t){return Object(r["a"])(regeneratorRuntime.mark((function e(){var t,a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t={limit:1e3,where:{"data.key":"category"}},e.next=3,Object(d["queryDict"])(t);case 3:a=e.sent,a.results;case 5:case"end":return e.stop()}}),e)})))()},searchProduct:function(e){var t=this;return Object(r["a"])(regeneratorRuntime.mark((function a(){var i,n,r,s;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return 0==e&&(t.start=0),i={order:"-updatedAt",skip:t.start,limit:t.length,where:{nodeType:"2"}},a.next=4,Object(o["queryProduct"])(i);case 4:return n=a.sent,r=n.results,t.groupData=r,t.total=t.groupData.length,a.next=10,Object(l["queryRole"])({limit:100});case 10:s=a.sent,t.allApps=s.results;case 12:case"end":return a.stop()}}),a)})))()},handleClose:function(){this.dialogFormVisible=!1},addproduct:function(){this.dialogFormVisible=!0},addgroup:function(){this.groupform=!0},getParent:function(e,t,a){var i=this;return t.map((function(n){e==n.id?(a.unshift(n.value),i.getParent(n.parentid,t,a)):0==n.parentid&&n.id==e&&a.unshift(n.value)})),this.form.category=a,a},getIndustryParent:function(e,t){var a=this;t.map((function(i){i.value==e&&a.getParent(i.id,t,[])}))},editorProduct:function(e){for(var t in this.form.relationApp="",this.dialogFormVisible=!0,this.productid=e.id,this.getIndustryParent(e.attributes.category,this.categoryList),this.form.desc=e.attributes.desc,this.form.name=e.attributes.name,this.form.nodeType=e.attributes.nodeType,this.form.netType=e.attributes.netType,this.form.devType=e.attributes.devType,this.form.productSecret=e.attributes.productSecret,this.changeNode(e.attributes.nodeType,0),e.attributes.icon&&(this.imageUrl=e.attributes.icon),e.attributes.ACL.permissionsById)this.form.relationApp=t?t.substr(5):"";this.selectApp(this.form.relationApp)},Industry:function(){var e=this;return Object(r["a"])(regeneratorRuntime.mark((function t(){var a,i,n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.categoryList=[],a={limit:1e3,where:{"data.key":"category"}},t.next=4,Object(d["queryDict"])(a);case 4:i=t.sent,n=i.results,n.map((function(t){var a={};a.value=t.type,a.label=t.data.CategoryName,a.id=t.data.Id,a.parentid=t.data.SuperId,e.categoryList.push(a)})),e.categoryListOptions=e.treeData(e.categoryList);case 8:case"end":return t.stop()}}),t)})))()},submitForm:function(e){},resetProductForm:function(){this.form={name:"",category:[],nodeType:0,desc:"",netType:"",devType:"",productSecret:"",roles:[],relationApp:""},this.imageUrl=""},deviceToDetail:function(e){this.$router.push({path:"/roles/detailproduct",query:{id:e.objectId}})},GoTodevices:function(e){this.$router.push({path:"/roles/thing",query:{productid:e.objectId}})},makeSure:function(e){var t=this,a={keys:"count(*)",skip:0,limit:1,where:{product:e.row.objectId}};Object(s["queryDevice"])(a).then((function(a){a.count>0?t.$message("请先删除该产品下设备"):Object(o["getProduct"])(e.row.objectId).then((function(a){Object(o["delProduct"])(e.row.objectId).then((function(a){a&&(t.$message({type:"success",message:"删除成功"}),e._self.$refs["popover-".concat(e.$index)].doClose(),t.searchProduct())})).catch((function(e){}))})).catch((function(e){}))})).catch((function(e){}))},productSizeChange:function(e){this.length=e,this.searchProduct()},productCurrentChange:function(e){this.start=(e-1)*this.length,this.searchProduct()},blackDict:function(e,t){var a=this;return Object(r["a"])(regeneratorRuntime.mark((function i(){var n,r;return regeneratorRuntime.wrap((function(i){while(1)switch(i.prev=i.next){case 0:return n={data:t,key:e,type:"Product"},i.next=3,Object(d["postDict"])(n);case 3:r=i.sent,r?a.$message({type:"success",message:"备份成功"}):a.$message({type:"error",message:"备份失败"});case 5:case"end":return i.stop()}}),i)})))()},CloneData:function(e){var t=this;return Object(r["a"])(regeneratorRuntime.mark((function a(){var i,n,r,o;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return i={category:e.attributes.category,devType:e.attributes.devType,name:e.attributes.name,thing:e.attributes.thing},a.next=3,Object(c["getHashClass"])("Product",i);case 3:n=a.sent,r=n.objectId,o=n.code,200==o&&t.blackDict(r,i);case 7:case"end":return a.stop()}}),a)})))()},proudctClone:function(e){var t=this;return Object(r["a"])(regeneratorRuntime.mark((function a(){var i,n;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:e.attributes.config.cloneState=!0,i=e,n=Object(o["putProduct"])(e.id,i),n&&t.CloneData(e);case 4:case"end":return a.stop()}}),a)})))()},proudctEdit:function(e){var t=window.location.origin+"/spa",a="production";t="development"==a?this.$globalConfig.localTopoUrl:window.location.origin+"/spa";var i="".concat(t,"/#?drawProudctid=").concat(e.objectId,"&proudctid=").concat(e.objectId);localStorage.setItem("rowId",e.objectId),window.open(i,"__blank")},proudctView:function(e){var t=window.location.origin+"/spa",a="production";t="development"==a?this.$globalConfig.localTopoUrl:window.location.origin+"/spa";var i="".concat(t,"/#/views/").concat(e.objectId);window.open(i,"__blank")},exportpro:function(){this.allTableDate?Object(u["export_txt_to_zip"])(JSON.stringify(this.allTableDate),"Dict","Dict"):this.$message({type:"warning",message:"数据为空,无法导出"})}}},v=h,g=(a("632e"),a("a7dd"),a("2877")),b=Object(g["a"])(v,i,n,!1,null,"f46d343c",null);t["default"]=b.exports},"3e26":function(e,t,a){"use strict";a("e94a")},"3e38":function(e,t,a){"use strict";a("e815")},"400c":function(e,t,a){},"40bf":function(e,t,a){"use strict";a.r(t);var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"editdevices"},[a("div",{staticClass:"editheader"},[a("el-breadcrumb",{attrs:{"separator-class":"el-icon-arrow-right"}},[a("el-breadcrumb-item",{attrs:{to:{path:"/roles/thing"}}},[e._v(" "+e._s(e.$translateTitle("route.设备管理"))+" ")]),a("el-breadcrumb-item",[e._v(" "+e._s(e.$translateTitle("route.设备详情"))+" ")])],1)],1),a("div",[a("el-tabs",{on:{"tab-click":e.tabHandleClick},model:{value:e.activeName,callback:function(t){e.activeName=t},expression:"activeName"}},[a("el-tab-pane",{attrs:{label:e.$translateTitle("equipment.deviceinformation"),name:"first"}},[a("div",{staticStyle:{"box-sizing":"border-box",padding:"10px",background:"#ffffff"}},[a("div",[a("table",{staticClass:"mailtable",staticStyle:{width:"100%"},attrs:{border:"0",cellspacing:"0",cellpadding:"0"}},[a("tr",[a("td",{staticClass:"cloumn"},[e._v(" "+e._s(e.$translateTitle("equipment.devicenumber")+":")+" ")]),a("td",[e._v(e._s(e.devicedetail.devaddr))]),a("td",{staticClass:"cloumn"},[e._v(" "+e._s(e.$translateTitle("equipment.product")+":")+" ")]),a("td",[e._v(e._s(e.devicedetail.productName))]),a("td",{staticClass:"cloumn"},[e._v(" "+e._s(e.$translateTitle("equipment.installationlocation"))+" ")]),a("td",[e._v(e._s(e.devicedetail.address))])]),a("tr",[a("td",{staticClass:"cloumn"},[e._v(" "+e._s(e.$translateTitle("equipment.state")+":")+" ")]),a("td",{staticClass:"ACTIVE"},[e._v(" "+e._s(e.$translateTitle("product.active"))+" ")]),a("td",{staticClass:"cloumn"},[e._v("ProductId:")]),a("td",[e._v(e._s(e.devicedetail.productid))]),a("td",{staticClass:"cloumn"},[e._v(" "+e._s(e.$translateTitle("equipment.lastonlinetime")+":")+" ")]),a("td",[e._v(e._s(e.devicedetail.lastOnlineTime))])]),a("tr",[a("td",{staticClass:"cloumn"},[e._v(" "+e._s(e.$translateTitle("equipment.ipaddress")+":")+" ")]),a("td",[e._v(e._s(e.devicedetail.ip||"-"))]),a("td",{staticClass:"cloumn"},[e._v(" ProductSecret: "),a("el-tooltip",{staticStyle:{"margin-left":"5px",color:"#cccccc"},attrs:{content:"注意保密，如有泄露即使更换",placement:"top"}},[a("i",{staticClass:"el-icon-question"})])],1),a("td",[e._v(e._s(e.devicedetail.productSecret))]),a("td",{staticClass:"cloumn"},[e._v(" "+e._s(e.$translateTitle("equipment.createdAt")+":")+" ")]),a("td",[e._v(e._s(e.devicedetail.createdAt))])]),a("tr",[a("td",{staticClass:"cloumn"},[e._v(" "+e._s(e.$translateTitle("equipment.nodetype")+":")+" ")]),0==e.devicedetail.nodeType?a("td",[e._v(" "+e._s(e.$translateTitle("product.equipment"))+" ")]):a("td",[e._v(e._s(e.$translateTitle("product.gateway")))]),a("td",{staticClass:"cloumn"},[e._v(" "+e._s(e.$translateTitle("developer.describe")+":")+" ")]),a("td",[e._v(e._s(e.devicedetail.desc))])])])])]),a("div",{staticClass:"twofirsttable",staticStyle:{"box-sizing":"border-box",padding:"10px","margin-top":"20px",background:"#ffffff"}},[a("h4",[e._v(" "+e._s(e.$translateTitle("equipment.deviceextensioninformation"))+" ")]),a("el-input",{attrs:{row:10,cols:5,type:"textarea",readonly:""},model:{value:e.devicedetail.shadow,callback:function(t){e.$set(e.devicedetail,"shadow",t)},expression:"devicedetail.shadow"}})],1)]),a("el-tab-pane",{attrs:{label:"Topic"+e.$translateTitle("product.list"),name:"second"}},[a("div",{staticStyle:{"box-sizing":"border-box",padding:"10px",background:"#ffffff"}},[a("el-table",{staticStyle:{width:"100%","text-align":"center"},attrs:{data:e.topicData}},[a("el-table-column",{attrs:{label:"Topic",align:"left"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(" "+e._s(t.row.topic.replace("${ProductId}/${DevAddr}",e.devicedetail.productid+"/"+e.devicedetail.devaddr))+" ")])]}}])}),a("el-table-column",{attrs:{label:e.$translateTitle("equipment.operationauthority"),align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return["pub"==t.row.type?a("span",[e._v(" "+e._s(e.$translateTitle("product.pub"))+" ")]):e._e(),"sub"==t.row.type?a("span",[e._v(" "+e._s(e.$translateTitle("product.sub"))+" ")]):e._e()]}}])}),a("el-table-column",{attrs:{label:e.$translateTitle("developer.describe"),prop:"desc",align:"center"}}),a("el-table-column",{attrs:{label:e.$translateTitle("developer.operation"),align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[t.row.isdef?e._e():a("el-button",{attrs:{type:"primary",size:"mini"}},[e._v(" "+e._s(e.$translateTitle("developer.edit"))+" ")]),t.row.isdef?e._e():a("el-button",{attrs:{type:"danger",size:"mini"}},[e._v(" "+e._s(e.$translateTitle("developer.delete"))+" ")])]}}])})],1)],1)]),a("el-tab-pane",{attrs:{label:e.$translateTitle("equipment.runningstate"),name:"third"}},[a("div",{staticStyle:{"box-sizing":"border-box",padding:"10px",background:"#ffffff"}},[a("div",{staticStyle:{"text-align":"right"}},[a("div",{staticStyle:{float:"left"}},[a("span",[e._v(e._s(e.$translateTitle("equipment.realtimerefresh")))]),a("el-switch",{attrs:{"active-color":"#13ce66","inactive-color":"#cccccc"},on:{change:function(t){return e.updateTrue(t)}},model:{value:e.isupdate,callback:function(t){e.isupdate=t},expression:"isupdate"}})],1),a("el-button-group",[a("el-button",{class:e.isshowtable?"":"buttonactive",attrs:{type:"primary",plain:"",size:"small"},on:{click:function(t){e.isshowtable=!1}}},[e._v(" "+e._s(e.$translateTitle("equipment.chart"))+" ")]),a("el-button",{class:e.isshowtable?"buttonactive":"",attrs:{type:"primary",plain:"",size:"small"},on:{click:function(t){e.isshowtable=!0}}},[e._v(" "+e._s(e.$translateTitle("equipment.table"))+" ")])],1)],1),e.isshowtable?e._e():a("div",{staticClass:"thirdtb"},[a("ul",{staticStyle:{display:"flex","flex-wrap":"wrap"}},e._l(e.properties,(function(t,i){return a("li",{key:i,staticClass:"updatedtable"},[a("div",{staticStyle:{height:"70px"}},[a("span",{staticStyle:{"font-size":"16px"}},[e._v(e._s(t.name))]),a("span",{staticStyle:{float:"right","margin-right":"10px"}},[a("svg-icon",{attrs:{"icon-class":t.name}})],1)]),"double"==t.dataType.type||"float"==t.dataType.type||"int"==t.dataType.type?a("div",{staticClass:"stla",attrs:{title:t.dataType.type}},[a("span",[e._v(e._s(e._f("filterVal")(t.value)))]),t.dataType.specs.unit?a("span",[e._v(" "+e._s(t.dataType.specs.unit)+" ")]):e._e()]):e._e(),"enmu"==t.dataType.type||"bool"==t.dataType.type?a("div",{staticClass:"stla",attrs:{title:t.dataType.type}},[a("span",[e._v(e._s(e._f("filterVal")(t.value)))]),a("span",[e._v(e._s(t.dataType.specs[t.value]))])]):e._e(),"struct"==t.dataType.type?a("div",{staticClass:"stla",attrs:{title:t.dataType.type}},e._l(t.specs,(function(t,i){return a("i",{key:i,staticStyle:{display:"block",height:"30px","font-style":"normal"}},["double"==t.dataType.type||"float"==t.dataType.type||"int"==t.dataType.type?a("div",{staticClass:"stla"},[a("span",[e._v(e._s(t.name+":")+"ee")]),a("span",[e._v(e._s(t.value)+"aa")]),t.dataType.specs.unit?a("span",[e._v(" "+e._s(t.dataType.specs.unit)+"rr ")]):e._e()]):e._e(),"enmu"==t.dataType.type||"bool"==t.dataType.type?a("div",{staticClass:"stla"},[a("span",[e._v(e._s(t.name+":"))]),a("span",[e._v(e._s(t.value))]),a("span",[e._v(e._s(t.dataType.specs[t.value]))])]):e._e()])})),0):e._e(),a("div",{staticClass:"ta"},[a("span",{staticClass:"fontSize"},[e._v(" "+e._s(e.$translateTitle("equipment.updatetime")+":")+" ")]),t.createdat?a("span",{staticClass:"fontSize",on:{click:function(t){return e.print(e.properties)}}},[e._v(" "+e._s(e.timestampToTime(t.createdat))+" ")]):e._e()]),a("div",{staticClass:"ta"},[a("el-link",{attrs:{underline:!1,type:"primary"},on:{click:function(a){return e.dataDetail(t)}}},[e._v(" 查看数据 ")])],1)])})),0)]),e.isshowtable?a("div",{staticClass:"thirdtable"},[a("el-table",{staticStyle:{width:"100%","margin-top":"10px","text-align":"center"},attrs:{data:e.thirdData.slice((e.thirdstart-1)*e.thirdlength,e.thirdstart*e.thirdlength)}},[a("el-table-column",{attrs:{label:e.$translateTitle("equipment.serialnumber"),align:"center",type:"index",width:"100"}}),a("el-table-column",{attrs:{label:e.$translateTitle("equipment.value"),prop:"value",align:"center","show-overflow-tooltip":""}}),a("el-table-column",{attrs:{label:e.$translateTitle("equipment.time"),prop:"time",align:"center",width:"300"}})],1),a("el-pagination",{staticStyle:{"margin-top":"20px"},attrs:{"page-sizes":[10,25,50,100],"page-size":e.thirdlength,total:e.thirdtotal,background:"",layout:"total, sizes, prev, pager, next, jumper"},on:{"size-change":e.handleSizeChange1,"current-change":e.handleCurrentChange1}})],1):e._e()])]),a("el-tab-pane",{attrs:{label:e.$translateTitle("route.在线调试"),name:"ninth"}}),"0"!=e.$route.query.nodeType?a("el-tab-pane",{attrs:{label:e.$translateTitle("equipment.subdevice"),name:"children"}},[a("div",{staticClass:"childrendevices"},[a("el-form",{staticClass:"demo-form-inline",attrs:{inline:!0,model:e.childrendevices,size:"small"}},[a("el-form-item",{attrs:{label:e.$translateTitle("equipment.devicenumber")+":"}},[a("el-input",{attrs:{placeholder:e.$t("equipment.devicenumber")},model:{value:e.childrendevices.devicesname,callback:function(t){e.$set(e.childrendevices,"devicesname",t)},expression:"childrendevices.devicesname"}})],1),a("el-form-item",[a("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.getDevices(0)}}},[e._v(" "+e._s(e.$translateTitle("developer.search"))+" ")])],1),a("el-form-item",[a("el-button",{attrs:{disabled:0==e.multipleTable.length,type:"primary"},on:{click:e.deleteDevcie}},[e._v(" "+e._s(e.$translateTitle("equipment.RelievingAssociation"))+" ")]),a("el-button",{attrs:{disabled:0==e.multipleTable.length,type:"primary"},on:{click:e.unactiveDevice}},[e._v(" "+e._s(e.$translateTitle("developer.prohibit"))+" ")]),a("el-button",{attrs:{disabled:0==e.multipleTable.length,type:"primary"},on:{click:e.activeDevice}},[e._v(" "+e._s(e.$translateTitle("developer.enable"))+" ")])],1),a("el-form-item",[a("el-button",{attrs:{type:"info",plain:""}},[e._v(" "+e._s(e.$translateTitle("equipment.Refresh"))+" ")]),a("el-button",{attrs:{type:"primary"},on:{click:function(t){e.childDialog=!0}}},[e._v(" "+e._s(e.$translateTitle("equipment.addchilddevice"))+" ")])],1)],1),a("div",{staticClass:"devicetable"},[a("el-table",{ref:"filterTable",staticStyle:{width:"100%","margin-top":"20px","text-align":"center"},attrs:{data:e.devicesTableData},on:{"selection-change":e.DevicesSelectionChange}},[a("el-table-column",{attrs:{type:"selection",align:"center",width:"55"}}),a("el-table-column",{attrs:{label:e.$translateTitle("equipment.devicenumber"),align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(t.row.devaddr))]),a("p",{staticStyle:{margin:"0",color:"green"}},[e._v(e._s(t.row.name))])]}}],null,!1,4136976086)}),a("el-table-column",{attrs:{label:e.$translateTitle("equipment.state"),align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",{class:t.row.status},[e._v(" "+e._s(t.row.status)+" ")])]}}],null,!1,2447536504)}),a("el-table-column",{attrs:{label:"子网地址",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(" "+e._s(void 0==t.row.route?"":t.row.route[e.devicedetail.devaddr])+" ")])]}}],null,!1,2958591836)}),a("el-table-column",{attrs:{label:e.$translateTitle("equipment.product"),align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",{attrs:{type:"success"}},[e._v(e._s(t.row.productName))])]}}],null,!1,1749163773)}),a("el-table-column",{attrs:{label:e.$translateTitle("equipment.nodetype"),align:"center"},scopedSlots:e._u([{key:"default",fn:function(e){return[0==e.row.nodeType?a("svg-icon",{staticStyle:{width:"2rem",height:"2rem"},attrs:{"icon-class":"iot"}}):a("svg-icon",{staticStyle:{width:"2rem",height:"2rem"},attrs:{"icon-class":"wgicon"}})]}}],null,!1,3338878781)}),a("el-table-column",{attrs:{label:e.$translateTitle("developer.prohibit")+"/"+e.$translateTitle("developer.enable"),align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-switch",{attrs:{"active-color":"#5eb058","inactive-color":"#cccccc"},on:{change:function(a){return e.handelUpdate(a,t.row,t.$index)}},model:{value:t.row.isEnable,callback:function(a){e.$set(t.row,"isEnable",a)},expression:"scope.row.isEnable"}})]}}],null,!1,1866847722)}),a("el-table-column",{attrs:{label:e.$translateTitle("equipment.lastonlinetime"),align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[t.row.lastOnlineTime?a("span",[e._v(" "+e._s(e.timestampToTime(t.row.lastOnlineTime))+" ")]):a("span",[e._v("—")])]}}],null,!1,1144690468)}),a("el-table-column",{attrs:{label:e.$translateTitle("developer.operation"),align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-link",{attrs:{underline:!1,type:"primary",icon:"el-icon-view"},on:{click:function(a){return e.deviceToDetail(t.row)}}},[e._v(" "+e._s(e.$translateTitle("equipment.see"))+" ")]),a("el-popover",{ref:"popover-"+t.$index,attrs:{placement:"top",width:"300"}},[a("p",[e._v("确定解除这个"+e._s(t.row.name)+"设备关联吗？")]),a("div",{staticStyle:{margin:"0","text-align":"right"}},[a("el-button",{attrs:{size:"mini"},on:{click:function(e){t._self.$refs["popover-"+t.$index].doClose()}}},[e._v(" "+e._s(e.$translateTitle("developer.cancel"))+" ")]),a("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(a){return e.makeSure(t)}}},[e._v(" "+e._s(e.$translateTitle("developer.determine"))+" ")])],1),a("el-link",{attrs:{slot:"reference",underline:!1,icon:"el-icon-delete",type:"danger"},slot:"reference"},[e._v(" "+e._s(e.$translateTitle("equipment.RelievingAssociation"))+" ")])],1)]}}],null,!1,4222664526)})],1)],1),a("div",{staticClass:"elpagination",staticStyle:{"margin-top":"20px"}},[a("el-pagination",{attrs:{"page-sizes":[10,20,30,50],"page-size":e.childrenDeviceLength,total:e.childrenDeviceTotal,layout:"total, sizes, prev, pager, next, jumper"},on:{"size-change":e.childrenDeviceSizeChange,"current-change":e.childrenDeviceCurrentChange}})],1)],1),a("el-dialog",{attrs:{title:e.$t("equipment.addchilddevice"),visible:e.childDialog,"close-on-click-modal":!1,width:"30%"},on:{"update:visible":function(t){e.childDialog=t}}},[a("div",{staticClass:"childdialog"},[a("el-form",{ref:"childrenForm",staticClass:"demo-form-inline",attrs:{model:e.childrenForm}},[a("el-form-item",{attrs:{label:e.$translateTitle("equipment.products"),rules:[{required:!0,message:"选择产品",trigger:"change"}],prop:"product"}},[a("el-select",{attrs:{placeholder:e.$t("equipment.products")},on:{change:e.checkProduct},model:{value:e.childrenForm.product,callback:function(t){e.$set(e.childrenForm,"product",t)},expression:"childrenForm.product"}},e._l(e.allProudct,(function(e,t){return a("el-option",{key:t,attrs:{label:e.name,value:e.objectId}})})),1)],1),a("el-form-item",{attrs:{label:e.$translateTitle("product.equipment"),rules:[{required:!0,message:"选择设备",trigger:"change"}],prop:"device"}},[a("el-select",{directives:[{name:"el-select-loadmore",rawName:"v-el-select-loadmore",value:e.loadmore,expression:"loadmore"}],attrs:{placeholder:e.$t("product.equipment"),disabled:!e.ischange},model:{value:e.childrenForm.device,callback:function(t){e.$set(e.childrenForm,"device",t)},expression:"childrenForm.device"}},e._l(e.productDevices,(function(e,t){return a("el-option",{key:t,attrs:{label:e.name,value:e.objectId}})})),1)],1),a("el-form-item",{attrs:{rules:[{required:!0,message:"请输入子网地址",trigger:"blur"}],label:"子网地址",prop:"route"}},[a("el-input",{attrs:{placeholder:"子网地址"},model:{value:e.childrenForm.route,callback:function(t){e.$set(e.childrenForm,"route",t)},expression:"childrenForm.route"}})],1)],1)],1),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){e.childDialog=!1}}},[e._v(" "+e._s(e.$translateTitle("developer.cancel"))+" ")]),a("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.submitDevice("childrenForm")}}},[e._v(" "+e._s(e.$translateTitle("developer.determine"))+" ")])],1)])],1):e._e(),e.isshowchild?a("el-tab-pane",{attrs:{label:"设备指令",name:"instruct"}},[a("Instruct",{attrs:{"product-id":e.productid,"devices-id":e.deviceid}})],1):e._e()],1),a("el-dialog",{attrs:{visible:e.datadialogVisible,"close-on-click-modal":!1,title:"历史数据",width:"40%"},on:{"update:visible":function(t){e.datadialogVisible=t}}},[a("div",{staticClass:"dialogcontent"},[a("el-tabs",{attrs:{type:"border-card"},on:{"tab-click":e.handleClick}},[a("el-tab-pane",[a("span",{attrs:{slot:"label"},slot:"label"},[a("i",{staticClass:"el-icon-date"}),e._v(" 表格 ")]),a("el-table",{staticStyle:{width:"100%","text-align":"center"},attrs:{data:e.datafordetail.slice((e.dataDeviceStart-1)*e.dataDeviceLength,e.dataDeviceStart*e.dataDeviceLength),stripe:"",height:"300"}},[a("el-table-column",{attrs:{prop:"name",label:"名称",align:"center"}}),a("el-table-column",{attrs:{prop:"value",label:"数值",align:"center"}}),a("el-table-column",{attrs:{label:"时间",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(e.timestampToTime(t.row.time)))])]}}])})],1),a("div",{staticClass:"elpagination",staticStyle:{"margin-top":"20px"}},[a("el-pagination",{attrs:{"page-sizes":[10,20,30,50],"page-size":e.dataDeviceLength,total:e.dataDeviceTotal.length,layout:"total, sizes, prev, pager, next, jumper"},on:{"size-change":e.dataDeviceSizeChange,"current-change":e.dataDeviceCurrentChange}})],1)],1),a("el-tab-pane",[a("span",{attrs:{slot:"label"},slot:"label"},[a("i",{staticClass:"el-icon-tickets"}),e._v(" 图表 ")]),a("div",{staticStyle:{width:"100%",height:"auto"},attrs:{id:"echarts"}},[a("line-chart",{attrs:{"chart-data":e.lineChartData}})],1)])],1)],1),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){e.datadialogVisible=!1}}},[e._v("取 消")]),a("el-button",{attrs:{type:"primary"},on:{click:function(t){e.datadialogVisible=!1}}},[e._v(" 确 定 ")])],1)])],1)])},n=[],r=a("1da1"),o=(a("96cf"),a("b0c0"),a("d81d"),a("99af"),a("b64b"),a("a9e3"),a("a630"),a("3ca3"),a("6062"),a("d3b7"),a("ddb0"),a("1285")),l=a("ed08"),s=a("36ef"),c=(a("30f8"),a("c4b2")),d={},u={components:{LineChart:s["default"],Instruct:c["default"]},filters:{filterVal:function(e){return e||0==e?e:"--"}},directives:{"el-select-loadmore":{bind:function(e,t){var a=e.querySelector(".el-select-dropdown .el-select-dropdown__wrap");a.addEventListener("scroll",(function(){var e=this.scrollHeight-this.scrollTop<=this.clientHeight;e&&t.value()}))}}},data:function(){return{width:0,lineChartData:"",datafordetail:[],datadialogVisible:!1,childDialog:!1,ninthform:{product:"",devices:""},wmxform:{product:"",devices:""},tableData:[],activeName:"first",text:"1111111",deviceid:"",devicedetail:{},topicData:[],thirdstart:1,thirdlength:10,thirdtotal:0,topic:[{topic:"thing/${ProductId}/${DevAddr}/post",type:"pub",desc:"设备上报",isdef:!0},{topic:"thing/${ProductId}/${DevAddr}",type:"sub",desc:"消息下发",isdef:!0}],thirdData:[],isupdate:!1,ispushdata:!0,timer:null,properties:[],isshowtable:!1,productProperties:[],childrendevices:{devicesname:""},multipleTable:[],devicesTableData:[],childrenDeviceLength:10,childrenDeviceStart:0,childrenDeviceTotal:0,childrenForm:{product:"",device:"",route:""},isshowchild:!1,allProudct:[],productDevices:[],ischange:!1,ischildren:!1,productid:"",dataDeviceTotal:0,dataDeviceLength:10,dataDeviceStart:1,devicedevaddr:"",dirstart:1,dirlength:20,selectproduct:""}},watch:{properties:{deep:!0,handler:function(e){}}},mounted:function(){this.getDeviceDetail()},destroyed:function(){window.clearInterval(this.timer),this.timer=null},methods:{print:function(e){},tabHandleClick:function(e){"ninth"==e.name&&this.$router.push({path:"/roles/onlinetest",query:{deviceid:this.devicedevaddr,productid:this.productid}}),"children"==e.name&&this.getDevices()},timestampToTime:function(e){var t=new Date(1e3*e),a=t.getFullYear()+"-",i=(t.getMonth()+1<10?"0"+(t.getMonth()+1):t.getMonth()+1)+"-",n=(t.getDate()+1<=10?"0"+t.getDate():t.getDate())+" ",r=(t.getHours()+1<=10?"0"+t.getHours():t.getHours())+":",o=(t.getMinutes()+1<=10?"0"+t.getMinutes():t.getMinutes())+":",l=t.getSeconds()+1<=10?"0"+t.getSeconds():t.getSeconds();return a+i+n+r+o+l},getDevices:function(e){var t=this;0==e&&(this.childrenDeviceStart=0),this.devicesTableData=[];var a="route."+this.devicedetail.devaddr,i={};i[a]={$regex:".+"};var n={limit:this.childrenDeviceLength,skip:this.childrenDeviceStart,keys:"count(*)",include:"product",parentId:this.deviceId,where:i};""!=this.childrendevices.devicesname&&(n.where.devaddr=this.childrendevices.devicesname),this.$queryDevice(n).then((function(e){t.childrenDeviceTotal=e.count,e.results&&e.results.map((function(e){var a={};a.objectId=e.objectId,a.name=e.name,a.status=e.status,a.originstatus=e.status,a.nodeType=e.product.nodeType,a.productName=e.product.name,a.devaddr=e.devaddr,a.isEnable=e.isEnable,a.route=e.route,t.devicesTableData.push(a)}))})).catch((function(e){t.$baseMessage("请求出错11",e.error,3e3)}))},getDeviceDetail:function(){var e=this;return Object(r["a"])(regeneratorRuntime.mark((function t(){var a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:a=e,e.deviceid=e.$route.query.deviceid,e.ischildren=e.$route.query.ischildren,Object(o["getTdDevice"])(e.deviceid).then((function(t){if(t.results.length>0){var i=t.results[0],n={};e.productid=e.$objGet(i,"product.objectId"),e.devicedevaddr=e.$objGet(i,"devaddr"),n.id=i.objectId,n.createdAt=Object(l["utc2beijing"])(i.createdAt),n.productName=e.$objGet(i,"product.name"),n.productid=e.$objGet(i,"product.objectId"),n.address=e.$objGet(i,"location.latitude")+"，"+e.$objGet(i,"location.longitude"),n.ip=e.$objGet(i,"ip"),n.basedata=JSON.stringify(i.basedata),n.DeviceName=i.name,n.status=i.status,n.desc=e.$objGet(i,"desc"),n.devaddr=e.$objGet(i,"devaddr"),n.nodeType=e.$objGet(i,"product.nodeType"),n.devType=e.$objGet(i,"product.devType"),n.productSecret=e.$objGet(i,"product.productSecret");e.$objGet(i,"tddata");if(a.properties=JSON.parse(JSON.stringify(e.$objGet(i,"product.thing.properties"))),a.properties&&a.properties.map((function(e){d[e["identifier"]]={expectedData:[],actualData:[],results:[],title:"int"===e["dataType"]["type"]||"float"===e["dataType"]["type"]||"double"===e["dataType"]["type"]?e["name"]+"("+e["dataType"]["specs"]["unit"]+")":e["name"],data:[],max:0}})),e.devicedetail=n,0!=e.$route.query.nodeType&&"true"==e.ischildren){e.activeName="children",e.isshowchild=!0,e.getDevices();var r={};e.$queryProduct(r).then((function(t){e.allProudct=t.results}))}else e.ischildren=!1,e.isshowchild=!0,e.$queryProduct({}).then((function(t){e.allProudct=t.results}));e.isupdate=!0,e.updateTrue(!0),i.product.topics?e.topicData=i.product.topics.concat(e.topic):e.topicData=e.topic}else e.$message("objectId 未返回")}));case 4:case"end":return t.stop()}}),t)})))()},Update:function(){var e=this;var t=this;Object(o["getTdDevice"])(this.deviceid).then((function(e){if(e&&(e.results&&0!=e.results.length&&t.thirdData.unshift({time:Object(l["timestampToTime"])(Math.ceil((new Date).getTime()/1e3)),value:JSON.stringify(e.results[0].tddata[0].data)}),t.thirdtotal=t.$objGet(t,"thirdData.length"),t.properties&&e.results))for(var a in t.properties.map((function(a,i){for(var n in e.results[0].tddata[0].data)a.identifier.toLowerCase()==n.toLowerCase()&&(a.createdat=e.results[0].lasttime,t.$set(t.properties[i],"value",e.results[0].tddata[0].data[n]))})),d)for(var i in e.results[0].tddata[0].data)a.toLowerCase()==i.toLowerCase()&&(d[a].expectedData.push(e.results[0].tddata[0].data[i]),d[a].actualData.push(e.results[0].createdAt.substring(0,19)),d[a].results&&d[a].results.length>0&&(d[a].results=Array.from(new Set(d[a].results.unshift(i)))))})).catch((function(a){window.clearInterval(t.timer),e.isupdate=!1}))},dataDetail:function(e){this.datadialogVisible=!0;var t={};for(var a in d)e.identifier==a&&(this.datafordetail=d[a].data,t=d[a],this.dataDeviceTotal=d[a].data);this.lineChartData=t},updateTrue:function(e){var t=this;this.ispushdata=!1,1==e?this.timer=window.setInterval((function(){t.Update()}),5e3):(window.clearInterval(this.timer),this.timer=null)},dataDeviceSizeChange:function(e){this.dataDeviceStart=1},dataDeviceCurrentChange:function(e){this.dataDeviceStart=e},handleSizeChange1:function(e){this.thirdstart=1,this.thirdlength=e},handleCurrentChange1:function(e){this.thirdstart=e},DevicesSelectionChange:function(e){this.multipleTable=e},childrenDeviceCurrentChange:function(e){this.childrenDeviceStart=(e-1)*this.childrenDeviceLength,this.getDevices()},childrenDeviceSizeChange:function(e){this.childrenDeviceLength=e,this.getDevices()},checkProduct:function(e){var t=this;this.ischange=!0,this.selectproduct=e;var a={limit:this.dirlength,skip:(this.dirstart-1)*this.dirlength,keys:"count(*)",where:{product:e}};this.$queryDevice(a).then((function(e){e.results&&e.results.length>0?t.productDevices=e.results:t.productDevices=[],t.childrenForm.device=""}))},deviceToDetail:function(e){this.$router.push({path:"/roles/editdevices",query:{deviceid:e.objectId,nodeType:e.nodeType,ischildren:"false"}})},loadmore:function(){this.dirstart++,this.checkProduct(this.selectproduct)},submitDevice:function(e){var t=this;this.$refs[e].validate((function(e){if(!e)return!1;var a={};a[t.devicedevaddr]=t.childrenForm.route;var i={parentId:{__type:"Pointer",className:"Device",objectId:t.deviceid},route:a};t.$putDevice(t.childrenForm.device,i).then((function(e){e&&(t.$message({type:"success",message:"添加成功"}),t.childDialog=!1,t.getDevices(),t.$refs["childrenForm"].resetFields())}))}))},deleteDevcie:function(e){var t=this;Promise.all([this.multipleTable.map((function(e){var a={parentId:null};t.$putDevice(e.objectId,a).then((function(e){}))}))]).then((function(e){e&&0!=e.length?(t.$message({message:"解除关联成功",type:"success"}),t.getDevices()):t.$message({message:"解除关联失败",type:"error"})})).catch((function(e){}))},unactiveDevice:function(e){var t=this;Promise.all([this.multipleTable.map((function(e){var a={isEnable:!1};t.$putDevice(e.objectId,a).then((function(e){}))}))]).then((function(e){e&&0!=e.length?(t.$message({message:"禁用成功",type:"success"}),t.getDevices()):t.$message({message:"禁用失败",type:"error"})})).catch((function(e){}))},activeDevice:function(e){var t=this;Promise.all([this.multipleTable.map((function(e){var a={isEnable:!0};t.$putDevice(e.objectId,a).then((function(e){}))}))]).then((function(e){e&&0!=e.length?(t.$message({message:"启用成功",type:"success"}),t.getDevices()):t.$message({message:"启用失败",type:"error"})})).catch((function(e){}))},makeSure:function(e){var t=this,a=JSON.parse(JSON.stringify(e.row.route)),i=this.devicedevaddr;delete a[i];var n={parentId:null,route:a};this.$putDevice(e.row.objectId,n).then((function(a){a&&(t.$message({type:"success",message:"解除关联成功"}),e._self.$refs["popover-".concat(e.$index)].doClose(),t.getDevices())}))},handelUpdate:function(e,t,a){var i=this,n={};for(var r in t)n[r]=t[r];n.isEnable=1!=n.isEnable,this.devicesTableData[a]=n,this.$confirm("是否修改此设备状态?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){var e={};for(var a in t)e[a]=t[a];e.isEnable=1==e.isEnable;var n={isEnable:e.isEnable};i.$putDevice(t.objectId,n).then((function(e){i.$message({type:"success",message:"状态修改成功"})})),i.getDevices()})).catch((function(){i.$message({type:"info",message:"已取消修改"});var e=t;e.isEnable=1!=e.isEnable,i.devicesTableData[a]=e}))},handleClick:function(e){}}},p=u,m=(a("3e26"),a("d361"),a("2877")),f=Object(m["a"])(p,i,n,!1,null,"0cfa8289",null);t["default"]=f.exports},"48a3":function(e,t,a){"use strict";a("d7da")},"51e6":function(e,t,a){"use strict";a.r(t);var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{attrs:{id:"addApp"}},[a("div",{staticClass:"head"},[a("el-breadcrumb",{attrs:{"separator-class":"el-icon-arrow-right"}},[a("el-breadcrumb-item",{attrs:{to:{path:"/roles/applicationManagement"}}},[e._v(" "+e._s(e.$translateTitle("application.applicationmanagement"))+" ")]),a("el-breadcrumb-item",[e._v(" "+e._s("update"==e.actionType?"编辑应用":"新增应用")+" ")])],1),a("el-button",{attrs:{type:"primary",plain:"",size:"small"},on:{click:e.handleClickBack}},[e._v(" "+e._s(e.$translateTitle("application.return"))+" ")])],1),a("div",{staticClass:"form"},[a("div",{staticClass:"title"},[a("p",{staticStyle:{color:"#f00"}},[e._v(" "+e._s("*"+e.$translateTitle("application.mustfillin"))+" ")])]),a("el-form",{ref:"form",attrs:{model:e.form,"label-width":"180px"}},[a("el-row",[a("el-col",{attrs:{span:12}},[a("div",{staticClass:"grid-content bg-purple"},[a("el-form-item",{attrs:{rules:[{required:!0,message:"工程单位不能为空"}],label:"工程单位",prop:"department"}},[a("el-input",{attrs:{placeholder:"工程单位"},model:{value:e.form.department,callback:function(t){e.$set(e.form,"department",t)},expression:"form.department"}})],1),a("el-form-item",{attrs:{label:e.$translateTitle("application.applicationname"),rules:[{required:!0,message:"工程名称不能为空"}],prop:"name"}},[a("el-input",{attrs:{placeholder:e.$translateTitle("application.applicationname"),readonly:""},model:{value:e.form.name,callback:function(t){e.$set(e.form,"name",t)},expression:"form.name"}})],1),a("el-form-item",{attrs:{label:e.$translateTitle("application.applicationlink"),rules:[{required:!0,message:"工程链接不能为空"}],prop:"productIdentifier"}},[a("el-select",{attrs:{placeholder:"请选择",disabled:""},model:{value:e.form.productIdentifier,callback:function(t){e.$set(e.form,"productIdentifier",t)},expression:"form.productIdentifier"}},e._l(e.applicationList,(function(t){return a("el-option",{key:t.id,attrs:{label:e.host+t.desc,value:t.desc}})})),1)],1),a("el-form-item",{attrs:{label:e.$translateTitle("application.industrytype"),rules:[{required:!0,message:"请选择所属行业",trigger:"blur"}],prop:"category"}},[a("el-cascader",{ref:"category",attrs:{options:e.treeData,placeholder:e.$translateTitle("application.industrytype"),clearable:""},model:{value:e.form.category,callback:function(t){e.$set(e.form,"category",t)},expression:"form.category"}})],1),a("el-form-item",{attrs:{rules:[{required:!0,message:"请选择所属应用",trigger:"blur"}],label:"所属应用"}},[a("el-input",{attrs:{placeholder:"请选择所属应用"},model:{value:e.form.relationApp,callback:function(t){e.$set(e.form,"relationApp",t)},expression:"form.relationApp"}},[a("template",{slot:"append"},[a("i",{class:[e.showTree?"el-icon-arrow-up":"el-icon-arrow-down"],staticStyle:{cursor:"pointer"},on:{click:function(t){e.showTree=!e.showTree}}})])],2),e.showTree?a("div",[a("el-tree",{attrs:{data:e.allApps,props:e.defaultProps},on:{"node-click":e.handleNodeClick}})],1):e._e()],1),a("el-form-item",{attrs:{label:e.$translateTitle("application.applicationdescription")}},[a("el-input",{attrs:{rows:4,placeholder:e.$translateTitle("application.applicationdescription"),type:"textarea",maxlength:"300","show-word-limit":""},model:{value:e.form.desc,callback:function(t){e.$set(e.form,"desc",t)},expression:"form.desc"}})],1)],1)]),a("el-col",{attrs:{span:12}},[a("div",{staticClass:"grid-content bg-purple-light"},[a("el-form-item",{attrs:{label:e.$translateTitle("application.applicationpictures")}},[a("el-upload",{ref:"upload",staticClass:"upload-demo",attrs:{"file-list":e.form.fileList,"auto-upload":!1,limit:1,"on-success":e.handleSuccess,action:"/upload","list-type":"picture"}},[a("el-button",{attrs:{slot:"trigger",size:"small",type:"primary"},slot:"trigger"},[e._v(" "+e._s(e.$translateTitle("application.selectfile"))+" ")]),a("el-button",{staticStyle:{"margin-left":"10px"},attrs:{size:"small",type:"success"},on:{click:e.submitUpload}},[e._v(" "+e._s(e.$translateTitle("application.uploadtoserver"))+" ")]),a("span",{directives:[{name:"show",rawName:"v-show",value:""!=e.form.img,expression:"form.img != ''"}]},[e._v(" "+e._s(e.$translateTitle("developer.path"))+":"+e._s(e.form.img)+" ")]),a("div",{staticClass:"el-upload__tip",attrs:{slot:"tip"},slot:"tip"},[e._v(" "+e._s(e.$translateTitle("application.onlyJPG/PNGfilescanbeuploadedandnomorethan500kb"))+" ")])],1)],1),a("el-form-item",{attrs:{label:"背景图片"}},[a("el-upload",{ref:"upload1",staticClass:"upload-demo",attrs:{"file-list":e.form.fileList1,"auto-upload":!1,limit:1,"on-success":e.handleSuccess1,action:"/upload","list-type":"picture"}},[a("el-button",{attrs:{slot:"trigger",size:"small",type:"primary"},slot:"trigger"},[e._v(" "+e._s(e.$translateTitle("application.selectfile"))+" ")]),a("el-button",{staticStyle:{"margin-left":"10px"},attrs:{size:"small",type:"success"},on:{click:e.submitUpload1}},[e._v(" "+e._s(e.$translateTitle("application.uploadtoserver"))+" ")]),a("span",{directives:[{name:"show",rawName:"v-show",value:""!=e.form.img1,expression:"form.img1 != ''"}]},[e._v(" "+e._s(e.$translateTitle("developer.path"))+":"+e._s(e.form.img1)+" ")]),a("div",{staticClass:"el-upload__tip",attrs:{slot:"tip"},slot:"tip"},[e._v(" "+e._s(e.$translateTitle("application.onlyJPG/PNGfilescanbeuploadedandnomorethan500kb"))+" ")])],1)],1),a("el-form-item",{attrs:{label:e.$translateTitle("application.copyrightinformation")}},[a("el-input",{attrs:{rows:3,placeholder:e.$translateTitle("application.copyrightinformation"),type:"textarea",maxlength:"300","show-word-limit":""},model:{value:e.form.copyright,callback:function(t){e.$set(e.form,"copyright",t)},expression:"form.copyright"}})],1),a("el-form-item",{attrs:{label:e.$translateTitle("application.monitoringpanel")}},[a("el-input",{attrs:{placeholder:e.$translateTitle("application.monitoringpanel")},model:{value:e.form.dashboard,callback:function(t){e.$set(e.form,"dashboard",t)},expression:"form.dashboard"}},[a("template",{slot:"prepend"},[e._v("http://")]),a("el-button",{staticStyle:{color:"#ffffff",background:"#409eff","border-radius":"1px 1px 1px 0"},attrs:{slot:"append",type:"primary"},on:{click:e.open12},slot:"append"},[e._v(" "+e._s(e.$translateTitle("application.preview"))+" ")])],2)],1)],1)])],1),a("el-divider",[a("b",[e._v(e._s(e.$translateTitle("application.applicationconfiguration")))])]),a("el-row",[a("el-col",{attrs:{span:12}},[a("div",{staticClass:"grid-content bg-purple"},[a("el-form-item",{attrs:{label:e.$translateTitle("application.applicationaccessscale"),rules:[{required:!0,message:"请选择工程接入规模",trigger:"change"}],prop:"scale"}},[a("el-select",{attrs:{clearable:""},model:{value:e.form.scale,callback:function(t){e.$set(e.form,"scale",e._n(t))},expression:"form.scale"}},e._l(e.form.scaleDate,(function(e){return a("el-option",{key:e.id,attrs:{label:e.label,value:e.value}})})),1)],1)],1)])],1)],1),a("div",{staticClass:"btns"},[a("el-button",{directives:[{name:"show",rawName:"v-show",value:"add"==e.actionType,expression:"actionType == 'add'"}],attrs:{type:"primary"},on:{click:e.handleClickSubmit}},[e._v(" "+e._s(e.$translateTitle("application.submission"))+" ")]),a("el-button",{directives:[{name:"show",rawName:"v-show",value:"update"==e.actionType,expression:"actionType == 'update'"}],attrs:{type:"primary"},on:{click:e.handleClickUpdate}},[e._v(" 更新 ")])],1)],1)])},n=[],r=a("1da1"),o=(a("96cf"),a("4de4"),a("a9e3"),a("b0c0"),a("1276"),a("ac1f"),a("a15b"),a("d81d"),a("bc35")),l=a("e0e9"),s=a("ed08"),c=a("58dd"),d=a("7212"),u=a("5dca"),p=(a("30f8"),{data:function(){return{imageUrl:!1,host:window.location.origin+"/lot/",applicationList:[],form:{name:"",options:[],category:[],relationApp:"",number:"",code:"",scale:"",dashboard:"",product:[],department:"",scaleDate:[{id:0,value:100,label:"100"},{id:1,value:1e3,label:"1000"},{id:2,value:1e4,label:"1万"},{id:3,value:1e5,label:"10万"},{id:4,value:1e6,label:"100万"},{id:5,value:1e7,label:"1000万"},{id:6,value:1e8,label:"1亿"}],productIdentifier:"",fileList:[],fileList1:[],img:"",img1:"",copyright:"",desc:"",time:7200,secret:""},sessionToken:"",file:"",actionType:"",relationAppObjectId:"",content:{title:"",objectId:""},argu:{},Notification:"",showTree:!1,allApps:[],defaultProps:{children:"children",label:"label"},productlist:[]}},computed:{treeData:function(){var e=JSON.parse(JSON.stringify(this.form.options));return e.filter((function(t){var a=e.filter((function(e){return t.id==e.parentid}));return a.length>0&&(t.children=a),0==t.parentid}))},applicationData:function(){return[]}},created:function(){this.Industry(),this.randomSecret(),this.getProductList()},mounted:function(){this.initData()},beforeDestroy:function(){this.Notification&&this.Notification.close()},methods:{handleClickRefresh:function(){this.randomSecret()},onApplicationchange:function(e){},getProductList:function(e){var t=this;this.$query_object("Product",{}).then((function(e){e.results&&(t.productlist=e.results)}))},randomSecret:function(){var e=Math.ceil(25*Math.random());this.form.secret=Base64.encode(String.fromCharCode(65+e)+Math.ceil(1e7*Math.random())+Number(new Date))},initData:function(){var e=this;return Object(r["a"])(regeneratorRuntime.mark((function t(){var a,i;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.argu=e.$route.query,e.content.title=e.argu.title,e.actionType=e.argu.actionType,t.next=5,Object(c["app_count"])({limit:100,where:{}});case 5:a=t.sent,i=a.results,i&&(e.applicationList=i,"update"==e.actionType?(e.form.name=e.argu.name,e.form.scale=Number(Object(s["handleZero"])(e.argu.scale)),e.form.secret=e.argu.secret,e.form.productIdentifier=e.argu.productIdentifier,e.content.objectId=e.argu.objectId,e.form.department=e.argu.userUnit,e.form.desc=e.argu.desc,e.form.copyright=e.argu.copyright,e.argu.category&&(e.form.category=e.argu.category.split("/")),e.argu.dashboard?e.form.dashboard=e.argu.dashboard.substr(7):e.form.dashboard="",""!=e.argu.logo&&(e.form.img=e.argu.logo,e.form.fileList.push({name:"logo.png",url:e.argu.logo})),""!=e.argu.background&&(e.form.img1=e.argu.background,e.form.fileList1.push({name:"background.png",url:e.argu.background})),e.form.relationApp=e.argu.name):(e.relationAppObjectId=e.$route.query.appObjectId,e.form.relationApp=e.$route.query.name,e.form.productIdentifier=e.$route.query.desc,e.form.name=e.$route.query.desc));case 8:case"end":return t.stop()}}),t)})))()},handleClickBack:function(){this.$router.push({path:"/roles/applicationManagement"})},submitUpload:function(){this.$refs.upload.submit()},handleChangeFile:function(e){var t=e.target.files[0],a=t.name.substr(-3);t.size/1024>500?this.$message("上传图片大小不能超过500KB!"):"png"!=a&&"jpg"!=a?this.$message("上传图片格式不正确，必须是png或jpg格式！"):this.file=t},handleSuccess:function(e,t,a){this.form.img=e.path,this.$message({message:"上传成功！",type:"success"}),document.getElementsByClassName("el-icon-close")[0].setAttribute("display","none")},handleError:function(e,t,a){this.$message({message:"上传失败！",type:"error"})},isSubmit:function(){return""!=this.form.name&&""!=this.form.scale&&""!=this.form.productIdentifier||(this.$message("有必填项没有填写，无法提交！"),!1)},handleSuccess1:function(e,t,a){this.form.img1=e.path,this.$message({message:"上传成功！",type:"success"}),document.getElementsByClassName("el-icon-close")[0].setAttribute("display","none")},submitUpload1:function(){this.$refs.upload1.submit()},handleClickSubmit:function(){var e=this;return Object(r["a"])(regeneratorRuntime.mark((function t(){var a,i,n,r,o;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e.isSubmit()){t.next=2;break}return t.abrupt("return");case 2:return a="role:"+e.form.relationApp,i={},i[a]={read:!0,write:!0},n={ACL:i,title:e.form.name,category:e.form.category.join("/"),scale:e.form.scale,productIdentifier:e.form.productIdentifier,copyright:e.form.copyright,desc:e.form.desc,logo:e.form.img,background:e.form.img1,userUnit:e.form.department,dashboard:""},""!=e.form.dashboard?n.dashboard="http://"+e.form.dashboard:n.dashboard="",t.next=9,Object(d["postProduct"])(n);case 9:r=t.sent,o=r.objectId,o&&e.addRelation(res.objectId,e.relationAppObjectId);case 12:case"end":return t.stop()}}),t)})))()},addRelation:function(e,t){var a=this;return Object(r["a"])(regeneratorRuntime.mark((function i(){var n;return regeneratorRuntime.wrap((function(i){while(1)switch(i.prev=i.next){case 0:return i.next=2,Object(u["postRelation"])({destClass:"Project",destId:e,destField:"app",srcClass:"App",srcId:t});case 2:n=i.sent,n?(a.$message({message:"添加部署成功！",type:"success"}),a.$router.push({path:"/roles/projectManagement"})):a.$message("部署失敗");case 4:case"end":return i.stop()}}),i)})))()},handleClickUpdate:function(){var e=this;return Object(r["a"])(regeneratorRuntime.mark((function t(){var a,i,n,r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e.isSubmit()){t.next=2;break}return t.abrupt("return");case 2:return a="role:"+e.form.relationApp,i={},i[a]={read:!0,write:!0},n={ACL:i,title:e.form.name,category:e.form.category.join("/"),scale:e.form.scale,productIdentifier:e.form.productIdentifier,copyright:e.form.copyright,desc:e.form.desc,logo:e.form.img,background:e.form.img1,userUnit:e.form.department,dashboard:""},""!=e.form.dashboard?n.dashboard="http://"+e.form.dashboard:n.dashboard="",t.next=9,Object(d["putProduct"])(e.argu.objectId,n);case 9:r=t.sent,r&&(e.$message({message:"修改成功！",type:"success"}),e.$router.push({path:"/roles/projectManagement"}));case 11:case"end":return t.stop()}}),t)})))()},handleNodeClick:function(e){this.showTree=!this.showTree,this.addchannel.applicationtText=e.name},Industry:function(){var e=this;return Object(r["a"])(regeneratorRuntime.mark((function t(){var a,i,n,r,s;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,Object(o["Roletree"])();case 2:return a=t.sent,i=a.results,n=void 0===i?[]:i,e.allApps=n,e.form.options=[],t.next=9,Object(l["queryDict"])({limit:1e3,where:{"data.key":"category"}});case 9:r=t.sent,r&&(s=r.results,s.map((function(t){var a={};a.value=t.data.CategoryName,a.label=t.data.CategoryName,a.id=t.data.Id,a.parentid=t.data.SuperId,e.form.options.push(a)})));case 11:case"end":return t.stop()}}),t)})))()},open12:function(){this.Notification=this.$notify({title:"面板预览",dangerouslyUseHTMLString:!0,duration:0,type:"success",message:"<div><iframe\n              src='http://".concat(this.form.dashboard,'\'\n              width="1000"\n              height="400"\n              frameborder="0"\n    ></iframe></div>')})}}}),m=p,f=(a("0881"),a("3e38"),a("2877")),h=Object(f["a"])(m,i,n,!1,null,"6fdf9604",null);t["default"]=h.exports},"5cd2":function(e,t,a){"use strict";a("f16d")},"5d5b":function(e,t,a){"use strict";a("f91d")},"5f94":function(e,t,a){},"627a":function(e,t,a){"use strict";a.r(t);var i,n,r,o,l=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"onlinetest"},[a("div",{staticClass:"onlinetest_top"},[a("div",[a("el-form",{attrs:{model:e.devices,inline:!0,size:"mini"}},[a("el-form-item",{attrs:{label:"请选择设备"}},[a("el-select",{on:{change:e.selsectProduct},model:{value:e.devices.productid,callback:function(t){e.$set(e.devices,"productid",t)},expression:"devices.productid"}},e._l(e.productlist,(function(e,t){return a("el-option",{key:t,attrs:{label:e.name,value:e.objectId}})})),1)],1),a("el-form-item",[a("el-select",{directives:[{name:"el-select-loadmore",rawName:"v-el-select-loadmore",value:e.loadmore,expression:"loadmore"}],model:{value:e.devices.devicedevaddr,callback:function(t){e.$set(e.devices,"devicedevaddr",t)},expression:"devices.devicedevaddr"}},e._l(e.devicelist,(function(e,t){return a("el-option",{key:t,attrs:{label:e.name,value:e.devaddr}})})),1)],1),a("el-form-item",{attrs:{label:"服务通道"}},[a("el-select",{model:{value:e.devices.subtopic,callback:function(t){e.$set(e.devices,"subtopic",t)},expression:"devices.subtopic"}},e._l(e.channellist,(function(e,t){return a("el-option",{key:t,attrs:{label:e.name,value:e.id}})})),1)],1),a("el-form-item",[a("el-button",{attrs:{type:"primary"},on:{click:e.subTopic}},[e._v("订阅")])],1)],1)],1),a("div",{staticClass:"top_content"},[a("span",{staticStyle:{display:"inline-block","font-size":"20px","font-weight":"900"}},[e._v(" 实时日志 ")]),a("span",{staticClass:"status",class:e.status}),a("div",{staticStyle:{float:"right"}},[a("el-switch",{staticStyle:{display:"inline-block","margin-right":"10px"},attrs:{"active-color":"#13ce66","inactive-color":"#ff4949","inactive-text":"自动刷新"},on:{change:e.isInterval},model:{value:e.value4,callback:function(t){e.value4=t},expression:"value4"}}),a("el-button",{attrs:{type:"primary",size:"mini"},on:{click:e.sendTrueInterval}},[e._v(" 刷新 ")]),a("el-button",{attrs:{type:"primary",size:"mini"},on:{click:e.clearTopic}},[e._v(" 清屏 ")])],1),e._m(0)])]),a("div",{staticClass:"onlinetest_bottom"},[a("el-tabs",{attrs:{type:"border-card"}},[a("el-tab-pane",{attrs:{label:"调试真实设备"}},[a("div",{staticClass:"bottom1_top"},[a("div",[a("div",{staticClass:"editorheader"},[a("el-form",{attrs:{model:e.editor1,inline:!0,"label-width":"80px",size:"mini"}},[a("el-form-item",{attrs:{label:"调试功能"}},[a("el-select",{on:{change:e.selectMessage},model:{value:e.editor1.function,callback:function(t){e.$set(e.editor1,"function",t)},expression:"editor1.function"}},e._l(e.dataslist,(function(e,t){return a("el-option",{key:t,attrs:{value:e.objectId,label:e.data.name}})})),1)],1),a("el-form-item",[a("el-button",{attrs:{type:"primary",icon:"el-icon-plus",circle:""},on:{click:e.addMessage}}),a("el-button",{attrs:{disabled:""==e.editor1.function,type:"danger",icon:"el-icon-delete",circle:""},on:{click:e.deleteMessage}})],1),a("div",{staticStyle:{"margin-top":"10px"}},[""==e.editor1.function?a("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"请选择功能",placement:"top-start"}},[a("span",[a("el-button",{attrs:{disabled:""==e.editor1.function,type:"primary",size:"mini"},on:{click:e.sendMessage1}},[e._v(" 发送指令 ")])],1)]):a("el-button",{attrs:{disabled:""==e.editor1.function,type:"primary",size:"mini"},on:{click:e.sendMessage1}},[e._v(" 发送指令 ")]),a("el-button",{attrs:{disabled:""==e.editor1.function,type:"primary",icon:"el-icon-edit",size:"mini"},on:{click:e.editorMessage}},[e._v(" 更新 ")]),a("el-button",{attrs:{disabled:""==e.editor1.function,type:"info",plain:"",size:"mini"}},[e._v(" 重置 ")])],1)],1)],1),a("div",{staticStyle:{background:"#ffffff"}},[a("label",{attrs:{id:"plug-name"}})]),a("pre",{staticClass:"ace_editor",staticStyle:{"min-height":"300px"},attrs:{id:"editor1"}},[a("textarea",{staticClass:"ace_text-input"})])])])]),a("el-tab-pane",{attrs:{label:"调试虚拟设备"}},[a("div",{staticClass:"editor2header"},[1==e.isactive?a("div",{staticClass:"editor2show animated fadeIn"},[a("el-button-group",[a("el-button",{attrs:{type:1==e.primary1?"primary":"info",size:"mini",plain:""},on:{click:function(t){e.primary1=1}}},[e._v(" 属性上报 ")]),a("el-button",{attrs:{type:2==e.primary1?"primary":"info",size:"mini",plain:""},on:{click:function(t){e.primary1=2}}},[e._v(" 事件上报 ")]),a("el-button",{attrs:{type:3==e.primary1?"primary":"info",size:"mini",plain:""},on:{click:e.functionClick}},[e._v(" 属性调试 ")]),a("el-button",{attrs:{type:4==e.primary1?"primary":"info",size:"mini",plain:""},on:{click:function(t){e.primary1=4}}},[e._v(" 服务调用 ")])],1),a("div",{directives:[{name:"show",rawName:"v-show",value:1==e.primary1,expression:"primary1 == 1"}],staticClass:"primary1"},[a("el-form",{attrs:{model:e.primary1form,size:"mini"}},[a("el-form-item",{attrs:{label:"lightStatus"}},[a("el-select",{model:{value:e.primary1form.status,callback:function(t){e.$set(e.primary1form,"status",t)},expression:"primary1form.status"}},[a("el-option",{attrs:{label:"11111",value:"2222"}})],1)],1),a("div",{staticClass:"primary1content"}),a("div",{staticClass:"primary1bottom"},[a("el-button",{attrs:{type:"primary",size:"mini"}},[e._v("推送")]),a("el-button",{attrs:{type:"info",size:"mini",plain:""}},[e._v(" 策略推送 ")]),a("el-button",{attrs:{type:"info",size:"mini",plain:""},on:{click:function(t){e.isactive=!1}}},[e._v(" 关闭虚拟设备 ")]),a("el-button",{attrs:{type:"info",size:"mini",plain:""}},[e._v(" 查看数据 ")])],1)],1)],1),a("div",{directives:[{name:"show",rawName:"v-show",value:2==e.primary1,expression:"primary1 == 2"}],staticClass:"primary2 animated fadeInUp"},[a("div",{staticStyle:{"margin-top":"20px","margin-bottom":"20px","font-size":"20px",color:"#73777a"}},[e._v(" 暂无数据 ")]),a("div",[a("el-button",{attrs:{type:"primary",size:"small"}},[e._v("编辑物模型")]),a("el-button",{attrs:{type:"info",size:"small"},on:{click:function(t){e.isactive=!1}}},[e._v(" 关闭设备 ")])],1)]),a("div",{directives:[{name:"show",rawName:"v-show",value:3==e.primary1||4==e.primary1,expression:"primary1 == 3 || primary1 == 4"}],staticClass:"primary3"},[a("div",{staticClass:"editorheader"},[a("el-form",{attrs:{model:e.editor2,inline:!0,"label-width":"80px",size:"mini"}},[a("el-form-item",{attrs:{label:"调试功能"}},[a("el-select",{model:{value:e.editor2.function,callback:function(t){e.$set(e.editor2,"function",t)},expression:"editor2.function"}},[a("el-option",{attrs:{label:"11111",value:"2222"}})],1)],1),3==e.primary1?a("div",{staticStyle:{display:"inline-block"}},[a("el-form-item",{attrs:{label:"功能"}},[a("el-select",{model:{value:e.editor2.method,callback:function(t){e.$set(e.editor2,"method",t)},expression:"editor2.method"}},[a("el-option")],1)],1)],1):e._e()],1)],1),a("div",{staticStyle:{background:"#ffffff"}},[a("label",{attrs:{id:"plug-name"}})]),a("pre",{staticClass:"ace_editor",staticStyle:{"min-height":"300px"},attrs:{id:"editor2"}},[a("textarea",{staticClass:"ace_text-input"})]),a("div",[""==e.editor2.function?a("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"请选择功能",placement:"top-start"}},[a("span",[a("el-button",{attrs:{disabled:""==e.editor2.function,type:"info",plain:"",size:"mini"}},[e._v(" 发送指令 ")])],1)]):a("el-button",{attrs:{type:"info",plain:"",size:"mini"}},[e._v(" 发送指令 ")]),a("el-button",{attrs:{type:"info",plain:"",size:"mini"}},[e._v("重置")])],1)])],1):a("div",{staticClass:"editor2hidden animated fadeInDown"},[a("div",{staticStyle:{"margin-top":"20px","font-size":"20px"}},[e._v("调试虚拟设备")]),a("div",{staticStyle:{"margin-top":"8px","margin-bottom":"20px","font-size":"14px",color:"#73777a","text-align":"center"}},[e._v(" 虚拟设备可以模拟真实设备在云端建立连接，上报定义的属性及事件处理， "),a("br"),e._v(" 这样可以不依赖真实设备快速开发应用 ")]),a("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(t){e.isactive=!0}}},[e._v(" 启动真实设备 ")])],1)])])],1)],1),a("el-dialog",{attrs:{visible:e.messageDialogVisible,"close-on-click-modal":!1,title:"新建功能",width:"50%"},on:{"update:visible":function(t){e.messageDialogVisible=t}}},[a("el-form",{attrs:{model:e.messageform,inline:!0,size:"small"}},[a("el-form-item",{attrs:{label:"功能名称"}},[a("el-input",{attrs:{type:"text"},model:{value:e.messageform.name,callback:function(t){e.$set(e.messageform,"name",t)},expression:"messageform.name"}})],1)],1),a("label",{attrs:{id:"plug-name"}},[e._v("消息体")]),a("pre",{staticClass:"ace_editor",staticStyle:{"min-height":"300px"},attrs:{id:"message"}},[a("textarea",{staticClass:"ace_text-input"})]),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){e.messageDialogVisible=!1}}},[e._v("取 消")]),a("el-button",{attrs:{type:"primary"},on:{click:e.addCmd}},[e._v("确 定")])],1)],1)],1)},s=[function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticStyle:{"margin-top":"20px"}},[a("pre",{staticClass:"ace_editor",staticStyle:{width:"100%","min-height":"300px"},attrs:{id:"subprodevice"}},[e._v("          "),a("textarea",{staticClass:"ace_text-input",staticStyle:{overflow:"scroll"}}),e._v("        ")])])}],c=a("5530"),d=(a("4d63"),a("ac1f"),a("25f0"),a("d81d"),a("b0c0"),a("c620")),u=a("7212"),p=a("e0e9"),m=a("89e8"),f="",h={name:"OnlineTest",directives:{"el-select-loadmore":{bind:function(e,t){var a=e.querySelector(".el-select-dropdown .el-select-dropdown__wrap");a.addEventListener("scroll",(function(){var e=this.scrollHeight-this.scrollTop<=this.clientHeight;e&&t.value()}))}}},data:function(){return{primary:!0,status:"active",value4:!0,contentData:[],devices:{devicedevaddr:"",productid:"",subtopic:""},editor1:{function:"",method:""},editor2:{function:"",method:""},messageDialogVisible:!1,primary2active:!0,primary1:1,isactive:!1,primary1form:{status:""},productlist:[],devicelist:[],formData:{pageIndex:1,pageSize:20},channellist:[],subdialogtimer:null,messageform:{name:""},dataslist:[],sendindex:0,detaildatas:{}}},mounted:function(){i=ace.edit("editor1"),i.session.setMode("ace/mode/json"),i.setTheme("ace/theme/eclipse"),i.setOptions({enableBasicAutocompletion:!0,enableSnippets:!0,enableLiveAutocompletion:!0}),r=ace.edit("subprodevice"),r.session.setMode("ace/mode/text"),r.setTheme("ace/theme/gob"),r.setReadOnly(!0),r.setOptions({enableBasicAutocompletion:!1,enableSnippets:!0,enableLiveAutocompletion:!0}),this.getProduct()},beforeDestroy:function(){var e={topic:"log/channel/"+this.devices.subtopic+"/"+this.devices.productid+"/"+this.devices.devicedevaddr,qos:2};d["Websocket"].unsubscribe(e,(function(e){e.result})),r.setValue(""),f=""},methods:{sendZl:function(){},setJson:function(){},nowtime:function(){var e=Date.parse(new Date),t=new Date(e),a=(t.getFullYear(),t.getMonth()+1<=10?t.getMonth():t.getMonth(),t.getDate()+1<=10?t.getDate():t.getDate(),(t.getHours()+1<=10?"0"+t.getHours():t.getHours())+":"),i=(t.getMinutes()+1<=10?"0"+t.getMinutes():t.getMinutes())+":",n=t.getSeconds()+1<=10?"0"+t.getSeconds():t.getSeconds();return a+i+n+" "},subTopic:function(){this.sendindex++;var e={topic:"log/channel/"+this.devices.subtopic+"/"+this.devices.productid+"/"+this.devices.devicedevaddr,qos:2},t=new RegExp("log/channel/"+this.devices.subtopic+"/"+this.devices.productid+"/"+this.devices.devicedevaddr),a=this;d["Websocket"].add_hook(t,(function(e){r.session.getLength()>=1e3?f="":f+=a.nowtime()+e+"\n",r.setValue(f),r.gotoLine(r.session.getLength())}));var i=JSON.stringify({action:"start_logger"});d["Websocket"].subscribe(e,(function(e){if(e.result){var t={topic:"channel/"+a.devices.subtopic+"/"+a.devices.productid+"/"+a.devices.devicedevaddr,text:i,retained:!0,qos:2};d["Websocket"].sendMessage(t),a.subdialogtimer=window.setInterval((function(){d["Websocket"].sendMessage(t)}),6e5)}}))},addMessage:function(){this.messageDialogVisible=!0,setTimeout((function(){o=ace.edit("message"),o.session.setMode("ace/mode/json"),o.setTheme("ace/theme/eclipse"),o.setOptions({enableBasicAutocompletion:!0,enableSnippets:!0,enableLiveAutocompletion:!0}),r=ace.edit("subprodevice"),r.session.setMode("ace/mode/text"),r.setTheme("ace/theme/gob"),r.setOptions({enableBasicAutocompletion:!1,enableSnippets:!0,enableLiveAutocompletion:!0})}))},selectMessage:function(e){var t=this;this.dataslist.map((function(a){a.objectId==e&&(i.setValue(JSON.stringify(a.data.commond)),t.detaildatas=JSON.parse(JSON.stringify(a.data)))}))},sendMessage1:function(){if(""!=this.editor1.function){0==this.sendindex&&this.subTopic();var e=this,t={topic:"thing/"+e.devices.productid+"/"+e.devices.devicedevaddr,text:i.getValue(),retained:!0,qos:2};d["Websocket"].sendMessage(t)}else this.$message("请挑选调试功能")},addCmd:function(){var e=this;""!=this.messageform.name?""!=o.getValue()?Object(u["getProduct"])(this.devices.productid).then((function(t){if(t){var a={};a=Object(c["a"])(Object(c["a"])({},a),JSON.parse(o.getValue()));var i={};i.name=e.messageform.name,i.type=t.devType,i.productid=t.objectId,i.commond=a;var n={ACL:t.ACL,data:i,type:"CMD"};Object(p["postDict"])(n).then((function(t){t&&(e.$message("创建成功"),e.messageDialogVisible=!1,e.getDict())})).catch((function(e){}))}})).catch((function(e){})):this.$message("请输入功能"):this.$message("请输入功能名称")},getDict:function(){var e=this,t={limit:100,where:{type:"CMD","data.productid":this.devices.productid}};Object(p["queryDict"])(t).then((function(t){t&&(e.dataslist=t.results)})).catch((function(e){}))},isInterval:function(e){var t="",a=this;t=0==e?JSON.stringify({action:"stop_logger"}):JSON.stringify({action:"start_logger"});var i={topic:"channel/"+a.devices.subtopic+"/"+a.devices.productid+"/"+a.devices.devicedevaddr,text:t,retained:!0,qos:2};d["Websocket"].sendMessage(i)},sendTrueInterval:function(){var e=this,t=JSON.stringify({action:"start_logger"}),a={topic:"channel/"+e.devices.subtopic+"/"+e.devices.productid+"/"+e.devices.devicedevaddr,text:t,retained:!0,qos:2};d["Websocket"].sendMessage(a)},clearTopic:function(){r.setValue(""),f=""},loadmore:function(){this.formData.pageIndex++,this.selsectProduct(this.productid)},deleteMessage:function(){var e=this;Object(p["delDict"])(this.editor1.function).then((function(t){t&&(e.$message("删除成功"),e.getDict(),e.editor1.function="",i.setValue(""))})).catch((function(e){}))},editorMessage:function(){var e=this;this.detaildatas.commond=JSON.parse(i.getValue());var t={data:this.detaildatas};Object(p["putDict"])(this.editor1.function,t).then((function(t){t&&(e.$message("编辑成功"),e.getDict())})).catch((function(e){}))},getProduct:function(){var e=this,t={limit:100};Object(u["queryProduct"])(t).then((function(t){e.productlist=t.results,e.devices.productid=e.$route.query.productid,e.getDevices(e.devices.productid,!0),e.getChannel(e.devices.productid),e.getDict()})).catch((function(e){}))},getChannel:function(e){var t=this,a="1",i={__type:"Pointer",className:"Product",objectId:e};Object(m["getChannelCountByProduct"])(this.channellength,this.channelstart,i,a).then((function(e){e.count>0?(t.channellist=e.results,t.devices.subtopic=e.results[0].objectId):(t.channellist={},t.devices.subtopic="")})).catch((function(e){t.$baseMessage("请求出错",e.error,3e3)}))},getDevices:function(e,t){var a=this,i={limit:this.formData.pageSize,skip:(this.formData.pageIndex-1)*this.formData.pageSize,keys:"count(*)",include:"product",where:{product:e}};this.$queryDevice(i).then((function(e){e.count>0&&(a.devicelist=e.results,a.devices.devicedevaddr=e.results[0].devaddr),t&&(a.devices.devicedevaddr=a.$route.query.deviceid)})).catch((function(e){a.$baseMessage("请求出错",e.error,3e3)}))},selsectProduct:function(e){this.formData.pageIndex=1,this.devicelist=[],this.devices.productid=e,this.devices.devicedevaddr="",this.getDevices(e),this.getChannel(e)},functionClick:function(){this.primary1=3,setTimeout((function(){n=ace.edit("editor2"),n.session.setMode("ace/mode/json"),n.setTheme("ace/theme/eclipse"),n.setOptions({enableBasicAutocompletion:!0,enableSnippets:!0,enableLiveAutocompletion:!0})}),300)}}},v=h,g=(a("1aff"),a("2877")),b=Object(g["a"])(v,l,s,!1,null,"04df3369",null);t["default"]=b.exports},"632e":function(e,t,a){"use strict";a("2a70")},6727:function(e,t,a){"use strict";a("21c1")},"6a57":function(e,t,a){"use strict";a("eaf2")},"71f7":function(e,t,a){"use strict";a("848a")},7298:function(e,t,a){"use strict";a.r(t);var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"devproduct"},[a("el-tabs",{model:{value:e.activeName,callback:function(t){e.activeName=t},expression:"activeName"}},[a("el-tab-pane",{attrs:{label:e.$translateTitle("product.myproduct")+"("+e.total+")",name:"first"}},[a("div",{staticClass:"prosecond"},[a("el-form",{staticClass:"demo-form-inline",attrs:{inline:!0,model:e.formInline,size:"small"}},[a("el-form-item",[a("el-input",{attrs:{placeholder:e.$translateTitle("product.searchproductname")},model:{value:e.formInline.productname,callback:function(t){e.$set(e.formInline,"productname",t)},expression:"formInline.productname"}})],1),a("el-form-item",[a("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.searchProduct(0)}}},[e._v(" "+e._s(e.$translateTitle("developer.search"))+" ")])],1),a("el-form-item",{staticStyle:{float:"right","text-align":"right"}},[a("el-button",{attrs:{type:"primary"},on:{click:e.addproduct}},[e._v(" "+e._s(e.$translateTitle("product.createproduct"))+" ")]),a("el-button",{attrs:{type:"primary"},on:{click:e.exportpro}},[e._v(" "+e._s(e.$translateTitle("product.exportpro"))+" ")]),a("el-button",{attrs:{type:"primary"},on:{click:function(t){e.importDialogShow=!0}}},[e._v(" "+e._s(e.$translateTitle("product.importpro"))+" ")])],1)],1),a("div",{staticClass:"protable"},[a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.listLoading,expression:"listLoading"}],staticStyle:{width:"100%"},attrs:{data:e.proTableData}},[a("el-table-column",{attrs:{prop:"objectId",label:"ProductID",width:"200"}}),a("el-table-column",{attrs:{label:e.$translateTitle("product.productname"),width:"200"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(t.row.name))])]}}])}),a("el-table-column",{attrs:{label:e.$translateTitle("product.productgrouping"),width:"200"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(t.row.devType))])]}}])}),a("el-table-column",{attrs:{label:e.$translateTitle("product.nodetype"),width:"200"},scopedSlots:e._u([{key:"default",fn:function(t){return[1==t.row.nodeType?a("span",[e._v(" "+e._s(e.$translateTitle("product.gateway"))+" ")]):e._e(),0==t.row.nodeType?a("span",[e._v(" "+e._s(e.$translateTitle("product.equipment"))+" ")]):e._e()]}}])}),a("el-table-column",{attrs:{label:e.$translateTitle("product.addingtime")},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(e.utc2beijing(t.row.createdAt)))])]}}])}),a("el-table-column",{attrs:{label:e.$translateTitle("developer.operation")},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-link",{attrs:{underline:!1,type:"primary",icon:"el-icon-view"},on:{click:function(a){return e.deviceToDetail(t.row)}}},[e._v(" 配置 ")]),a("el-popover",{ref:"popover-"+t.$index,attrs:{placement:"top",width:"300"}},[a("p",[e._v("确定删除这个"+e._s(t.row.name)+"产品吗？")]),a("div",{staticStyle:{margin:"0","text-align":"right"}},[a("el-button",{attrs:{size:"mini"},on:{click:function(e){t._self.$refs["popover-"+t.$index].doClose()}}},[e._v(" "+e._s(e.$translateTitle("developer.cancel"))+" ")]),a("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(a){return e.makeSure(t)}}},[e._v(" "+e._s(e.$translateTitle("developer.determine"))+" ")])],1),a("el-link",{attrs:{slot:"reference",underline:!1,icon:"el-icon-delete",type:"danger"},slot:"reference"},[e._v(" "+e._s(e.$translateTitle("developer.delete"))+" ")])],1),a("el-link",{attrs:{underline:!1,icon:"el-icon-attract",type:"primary"},on:{click:function(a){return e.GoTodevices(t.row)}}},[e._v(" "+e._s(e.$translateTitle("product.equipment"))+" ")]),a("el-link",{attrs:{underline:!1,icon:"el-icon-edit",type:"success"},on:{click:function(a){return e.editorProduct(t.row)}}},[e._v(" 修改 ")])]}}])})],1)],1),a("div",{staticClass:"elpagination",staticStyle:{"margin-top":"20px"}},[a("el-pagination",{attrs:{"page-sizes":[10,20,30,50],"page-size":e.length,total:e.total,layout:"total, sizes, prev, pager, next, jumper"},on:{"size-change":e.productSizeChange,"current-change":e.productCurrentChange}})],1)],1)])],1),a("div",{staticClass:"prodialog"},[a("el-dialog",{attrs:{title:e.$translateTitle("product.createproduct"),visible:e.dialogFormVisible,"close-on-click-modal":!1,"before-close":e.handleClose,width:"40%",top:"5vh"},on:{"update:visible":function(t){e.dialogFormVisible=t}}},[a("div",{staticClass:"content"},[a("div",{staticClass:"contentone"},[a("div",{staticStyle:{display:"flex"}},[a("span",[e._v(e._s(e.$translateTitle("product.productinformation")))]),a("p",{staticStyle:{"flex-grow":"2",width:"auto",height:"1px",margin:"10px","border-top":"1px dashed #dddddd"}})]),a("el-form",{ref:"form",attrs:{model:e.form,rules:e.rules}},[a("el-form-item",{attrs:{label:e.$translateTitle("product.productname"),prop:"name"}},[a("el-input",{attrs:{autocomplete:"off"},model:{value:e.form.name,callback:function(t){e.$set(e.form,"name",t)},expression:"form.name"}})],1),a("el-form-item",{attrs:{label:"产品分组",prop:"devType"}},[a("el-input",{attrs:{autocomplete:"off"},model:{value:e.form.devType,callback:function(t){e.$set(e.form,"devType",t)},expression:"form.devType"}})],1),a("el-form-item",{attrs:{label:e.$translateTitle("product.classification")}},[a("el-cascader",{attrs:{options:e.categoryListOptions},model:{value:e.form.category,callback:function(t){e.$set(e.form,"category",t)},expression:"form.category"}})],1),a("el-form-item",{directives:[{name:"show",rawName:"v-show",value:"add"==e.custom_status,expression:"custom_status == 'add'"}],attrs:{label:"所属应用",prop:"relationApp"}},[a("el-input",{attrs:{placeholder:"请选择所属应用",readonly:""},on:{focus:function(t){e.showTree=!e.showTree}},model:{value:e.form.relationApp,callback:function(t){e.$set(e.form,"relationApp",t)},expression:"form.relationApp"}}),e.showTree?a("div",[a("el-tree",{attrs:{data:e.allApps,props:e.defaultProps},on:{"node-click":e.handleNodeClick}})],1):e._e()],1),a("el-form-item",{attrs:{label:e.$translateTitle("product.nodetype"),prop:"nodeType"}},[a("el-radio-group",{on:{change:e.changeNode},model:{value:e.form.nodeType,callback:function(t){e.$set(e.form,"nodeType",t)},expression:"form.nodeType"}},[a("el-radio",{attrs:{label:0}},[e._v(" "+e._s(e.$translateTitle("product.equipment"))+" ")]),a("el-radio",{attrs:{label:1}},[e._v(" "+e._s(e.$translateTitle("product.gateway"))+" ")])],1)],1),a("el-form-item",{attrs:{label:e.$translateTitle("product.networking")+"(共"+e.channel.length+"项)",prop:"netType"}},[a("el-select",{attrs:{placeholder:e.$translateTitle("product.selectgateway")},model:{value:e.form.netType,callback:function(t){e.$set(e.form,"netType",t)},expression:"form.netType"}},e._l(e.channel,(function(e,t){return a("el-option",{key:t,attrs:{label:t+1+":"+e.label,value:e.value,title:"当前第"+(t+1)+"项"}})})),1)],1),a("el-form-item",{attrs:{label:"产品模型"}},[e.imageUrl?a("img",{staticClass:"avatar",attrs:{src:e.imageUrl}}):a("i",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"el-icon-plus avatar-uploader-icon"}),a("form",{ref:"uploadform",staticStyle:{position:"absolute"},attrs:{method:"POST",enctype:"multipart/form-data"}},[a("input",{staticStyle:{position:"relative",top:"-100px","z-index":"5",width:"100px",height:"100px",cursor:"pointer",opacity:"0"},attrs:{type:"file"},on:{change:function(t){return e.upload(t)}}})]),e.imageUrl?a("el-button",{staticStyle:{"vertical-align":"text-bottom"},attrs:{type:"danger",size:"mini"},on:{click:e.deleteImgsrc}},[e._v(" 删除 ")]):e._e()],1),a("el-form-item",{attrs:{label:e.$translateTitle("developer.describe"),prop:"desc"}},[a("el-input",{attrs:{type:"textarea"},model:{value:e.form.desc,callback:function(t){e.$set(e.form,"desc",t)},expression:"form.desc"}})],1)],1)],1),a("div",{staticClass:"contenttwo",staticStyle:{"margin-top":"20px"}},[a("div",{staticStyle:{display:"flex"}},[a("span",[e._v(e._s(e.$translateTitle("product.nodetype")))]),a("p",{staticStyle:{"flex-grow":"2",width:"auto",height:"1px",margin:"10px","border-top":"1px dashed #dddddd"}})])])]),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.submitForm()}}},[e._v(" "+e._s(e.$translateTitle("developer.determine"))+" ")]),a("el-button",{on:{click:function(t){e.dialogFormVisible=!1}}},[e._v(" "+e._s(e.$translateTitle("developer.cancel"))+" ")])],1)])],1),a("div",{staticClass:"import-dialog"},[a("el-dialog",{attrs:{visible:e.importDialogShow,title:"导入产品",width:"25%"},on:{"update:visible":function(t){e.importDialogShow=t}}},[a("el-form",{ref:"uploadProForm",attrs:{model:e.formPro}},[a("el-upload",{ref:"fileUpload",staticClass:"upload-demo",attrs:{action:e.uploadAction,data:e.uploadData,headers:e.uploadHeaders,"file-list":e.fileList,"on-change":e.handleChange,"with-credentials":!0,"auto-upload":!1,"on-success":e.handleUploadSuccess,"on-error":e.handleUploadError,accept:".xls, .xlsx, .zip"}},[a("el-button",{attrs:{slot:"trigger",size:"small",type:"primary"},slot:"trigger"},[e._v(" 选泽文件 ")])],1)],1),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{staticClass:"btn-left",attrs:{size:"small",type:"primary"},on:{click:e.submitUpload}},[e._v(" 上 传 ")]),a("el-button",{staticClass:"btn-right",attrs:{size:"small"},on:{click:function(t){e.importDialogShow=!1}}},[e._v(" 取 消 ")])],1)],1)],1)],1)},n=[],r=a("2909"),o=a("1da1"),l=(a("96cf"),a("b0c0"),a("4de4"),a("1276"),a("ac1f"),a("c19f"),a("d3b7"),a("5cc6"),a("9a8c"),a("a975"),a("735e"),a("c1ac"),a("d139"),a("3a7b"),a("d5d6"),a("82f81"),a("e91f"),a("60bd"),a("5f96"),a("3280"),a("3fcc"),a("ca91"),a("25a1"),a("cd26"),a("3c5d"),a("2954"),a("649e"),a("219c"),a("170b"),a("b39a"),a("72f7"),a("5319"),a("6062"),a("3ca3"),a("ddb0"),a("d81d"),a("a9e3"),a("99af"),a("7212")),s=a("1285"),c=a("bc35"),d=a("e455"),u=a("5da9"),p=a("e0e9"),m=a("7497"),f={data:function(){return{listLoading:!1,custom_row:{},custom_status:"add",hashkey:"",defaultProps:{children:"children",label:"label"},length:10,total:0,start:0,activeName:"first",formInline:{productname:""},uploadHeaders:{sessionToken:Cookies.get("access_token")},uploadAction:"",uploadData:{},fileList:[],productIdentifier:"",proTableData:[],formLabelWidth:"80px",dialogFormVisible:!1,importDialogShow:!1,form:{name:"",category:[],nodeType:0,desc:"",netType:"",devType:"",productSecret:"",roles:[],relationApp:""},formPro:{name:"",url:""},rules:{name:[{required:!0,message:"请输入产品",trigger:"blur"}],devType:[{required:!0,message:"请输入产品标识，用于区分不同设备",trigger:"blur"}],category:[{required:!0,message:"请选择所属分类",trigger:"change"}],nodeType:[{required:!0,message:"请选择节点类型",trigger:"change"}],netType:[{required:!0,message:"请选择联网方式",trigger:"change"}],relationApp:[{required:!0,message:"请选择产品可见角色",trigger:"change"}]},option:[],ruleoptions:[],channel:[{label:"蜂窝(2G/3G/4G)(直连)",value:"CELLULAR"},{label:"NB-IOT通道",value:"NB-IOT"},{label:"BLE(低功耗蓝牙)",value:"Bluetooth"},{label:"5G通道(直连)",value:"5G"},{label:"WIFI通道(直连)",value:"WIFI"},{label:"ZigBee通道",value:"ZigBee"},{label:"Modbus",value:"Modbus"},{label:"LoRa(WAN)(直连)",value:"LoRaWAN"},{label:"OPC UA",value:" OPC UA"},{label:"ZETA通道",value:"ZETA"},{label:"网线连接(直连)",value:"网线连接"},{label:"自定义",value:"OTHER"}],imageUrl:"",productid:"",loading:!1,allApps:[],categoryList:[],categoryListOptions:[],fileServer:"",access_token:"",projectid:"",projectName:"",allTableDate:[],showTree:!1}},computed:{},mounted:function(){this.Industry(),this.searchProduct(0)},beforeDestroy:function(){this.projectName=""},methods:{handleNodeClick:function(e){this.$set(this.form,"relationApp",e.name),this.showTree=!this.showTree},changeNode:function(e,t){0!=t&&(this.form.netType=""),this.channel=0==e?[{label:"蜂窝(2G/3G/4G)",value:"CELLULAR"},{label:"NB-IOT通道",value:"NB-IOT"},{label:"BLE(低功耗蓝牙)",value:"Bluetooth"},{label:"5G通道",value:"5G"},{label:"WIFI通道",value:"WIFI"},{label:"ZigBee通道",value:"ZigBee"},{label:"LoRa(WAN)",value:"LoRaWAN"},{label:"Modbus",value:"Modbus"},{label:"OPC UA",value:" OPC UA"},{label:"ZETA通道",value:"ZETA"},{label:"网线连接",value:"网线连接"},{label:"自定义",value:"OTHER"}]:[{label:"蜂窝(2G/3G/4G)",value:"CELLULAR"},{label:"5G通道",value:"5G"},{label:"WIFI通道",value:"WIFI"},{label:"NB-IOT通道",value:"NB-IOT"},{label:"LoRaWAN",value:"LoRaWAN"},{label:"网线连接",value:"网线连接"},{label:"自定义",value:"OTHER"}]},selectApp:function(e){var t=this;e&&Object(u["getServer"])(e).then((function(e){e&&(t.fileServer=e.file,t.access_token=e.access_token)}))},treeData:function(e){var t=JSON.parse(JSON.stringify(e));return t.filter((function(e){var a=t.filter((function(t){return e.id==t.parentid}));return a.length>0&&(e.children=a),0==e.parentid}))},deleteImgsrc:function(){event.stopPropagation(),this.imageUrl=""},upload:function(e){if(this.loading=!0,e){var t=e.target.files[0],a=t.name,i=e.target.files[0].type,n=(t.type.split("/")[0],"image/jpeg"===i||"image/JPEG"===i||"image/png"===i||"image/PNG"===i||"image/bpm"===i||"image/BPM"===i);if(!n)return this.$message({message:"请上传图片",type:"error"}),!1;var r=new FileReader;r.readAsDataURL(t);var o=this;r.onloadend=function(){var e=r.result,t=o.dataURItoBlob(e);o.uploadFile(t,a)}}},dataURItoBlob:function(e){for(var t=atob(e.split(",")[1]),a=e.split(",")[0].split(":")[1].split(";")[0],i=new ArrayBuffer(t.length),n=new Uint8Array(i),r=0;r<t.length;r++)n[r]=t.charCodeAt(r);return new Blob([i],{type:a})},uploadFile:function(e,t){var a=this,i=new FormData;i.append("file",e,t),i.append("output","json"),i.append("path",this.form.relationApp),i.append("auth_token",this.access_token);this.$http.post(this.fileServer,i).then((function(e){e&&(a.imageUrl=e.body.url,a.loading=!1)})).catch((function(e){a.loading=!1,a.$message(e.bodyText)}))},submitUpload:function(){var e=this;this.uploadAction="/product",this.$nextTick((function(){e.uploadData.appid=Cookies.get("appids"),e.$refs.fileUpload.submit()}))},handleUploadSuccess:function(e,t,a){this.$message({type:"success",message:"产品导入成功"}),this.importDialogShow=!1,this.$refs["uploadProForm"].resetFields(),this.searchProduct()},handleUploadError:function(e,t,a){this.$message({showClose:!0,message:e})},handleChange:function(e,t){t.length>0&&(this.fileList=[t[t.length-1]])},utc2beijing:function(e){var t=new Date(+new Date(e)+288e5).toISOString().replace(/T/g," ").replace(/\.[\d]{3}Z/,"");return t},getDict:function(e){var t=this;return Object(o["a"])(regeneratorRuntime.mark((function a(){var i,n;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return e=Object(r["a"])(new Set(e)),i={limit:1e3,where:{"data.key":"category",type:e[0]}},a.next=4,t.$query_object("Dict",i);case 4:n=a.sent,t.allTableDate=n.results;case 6:case"end":return a.stop()}}),a)})))()},searchProduct:function(e){var t=this;return Object(o["a"])(regeneratorRuntime.mark((function a(){var i,n,r,o,l;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return t.listLoading=!0,0==e&&(t.start=0),i=[],n={keys:"count(*)",order:"-updatedAt",limit:t.length,skip:t.start,where:{}},""!=t.formInline.productname&&(n.where.name=t.formInline.productname),a.next=7,t.$query_object("Product",n);case 7:r=a.sent,o=r.results,l=r.count,o&&(o.map((function(e){""!=e.category&&e.category&&"report"!=e.devType&&i.push(e.category)})),t.listLoading=!1,t.proTableData=o,t.total=l),t.getApps();case 12:case"end":return a.stop()}}),a)})))()},getApps:function(){var e=this;return Object(o["a"])(regeneratorRuntime.mark((function t(){var a,i,n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,Object(c["Roletree"])();case 2:a=t.sent,i=a.results,n=void 0===i?[]:i,e.allApps=n;case 6:case"end":return t.stop()}}),t)})))()},handleClose:function(){this.dialogFormVisible=!1},addproduct:function(){this.form={name:"",category:[],nodeType:0,desc:"",netType:" ",devType:"",productSecret:"",roles:[],relationApp:""},this.custom_status="add",this.dialogFormVisible=!0},getParent:function(e,t,a){var i=this;return t.map((function(n){e==n.id?(a.unshift(n.value),i.getParent(n.parentid,t,a)):0==n.parentid&&n.id==e&&a.unshift(n.value)})),this.form.category=a[0],a},getIndustryParent:function(e,t){var a=this;t.map((function(i){i.value==e&&a.getParent(i.id,t,[])}))},editorProduct:function(e){for(var t in this.custom_status="edit",this.custom_row=e,this.form.relationApp="",this.dialogFormVisible=!0,this.productid=e.objectId,this.getIndustryParent(e.category,this.categoryList),this.form.desc=e.desc,this.form.name=e.name,this.form.nodeType=e.nodeType,this.form.netType=e.netType,this.form.devType=e.devType,this.form.productSecret=e.productSecret,this.changeNode(e.nodeType,0),e.icon&&(this.imageUrl=e.icon),e.ACL.permissionsById)this.form.relationApp=t?t.substr(5):"";this.selectApp(this.form.relationApp)},Industry:function(){var e=this;return Object(o["a"])(regeneratorRuntime.mark((function t(){var a,i,n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return a={limit:1e3,where:{"data.key":"category"}},t.next=3,e.$query_object("Dict",a);case 3:i=t.sent,n=i.results,n.map((function(t){var a={};a.value=t.type,a.label=t.data.CategoryName,a.id=t.data.Id,a.parentid=t.data.SuperId,e.categoryList.push(a)})),e.categoryListOptions=e.treeData(e.categoryList);case 7:case"end":return t.stop()}}),t)})))()},submitForm:function(){var e=this,t={},a={name:this.form.name,nodeType:this.form.nodeType,netType:this.form.netType,icon:this.imageUrl,devType:this.form.devType,desc:this.form.desc};this.$refs.form.validate((function(i){if(i)if("add"===e.custom_status){var n=Math.ceil(25*Math.random()),r=Base64.encode(String.fromCharCode(65+n)+Math.ceil(1e7*Math.random())+Number(new Date)),o="role:"+e.form.relationApp,l={};l[o]={read:!0,write:!0};var s={category:e.form.category[e.form.category.length-1],productSecret:r,ACL:l,topics:[],dynamicReg:!1};t=Object.assign(a,s),e.createProduct(t)}else{var c={};t=Object.assign(a,c),e.editProduct(t)}else e.$message("必填项未填")}))},createProduct:function(e){var t=this;return Object(o["a"])(regeneratorRuntime.mark((function a(){var i;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return a.next=2,t.$create_object("Product",e);case 2:i=a.sent,i.objectId?t.initQuery("产品创建成功","success"):t.$message({type:"error",message:i.error});case 4:case"end":return a.stop()}}),a)})))()},editProduct:function(e){var t=this;return Object(o["a"])(regeneratorRuntime.mark((function a(){var i;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return a.next=2,t.$update_object("Product",t.custom_row.objectId,e);case 2:i=a.sent,i.updatedAt?t.initQuery("产品修改成功","success"):t.$message({type:"error",message:i.error});case 4:case"end":return a.stop()}}),a)})))()},initQuery:function(e,t){this.$message({type:t||"info",message:e}),this.dialogFormVisible=!1,this.resetProductForm(),this.$refs["form"].resetFields(),this.searchProduct()},resetProductForm:function(){this.form={name:"",category:[],nodeType:0,desc:"",netType:"",devType:"",productSecret:"",roles:[],relationApp:""},this.imageUrl=""},deviceToDetail:function(e){this.$router.push({path:"/roles/detailproduct",query:{id:e.objectId}})},GoTodevices:function(e){this.$router.push({path:"/roles/thing",query:{productid:e.objectId}})},makeSure:function(e){var t=this,a={keys:"count(*)",skip:0,limit:1,where:{product:e.row.objectId}};Object(s["queryDevice"])(a).then((function(a){a.count>0?t.$message("请先删除该产品下设备"):Object(l["delProduct"])(e.row.objectId).then((function(a){a&&(t.$message({type:"success",message:"删除成功"}),e._self.$refs["popover-".concat(e.$index)].doClose(),t.searchProduct())}))}))},productSizeChange:function(e){this.length=e,this.searchProduct()},productCurrentChange:function(e){this.start=(e-1)*this.length,this.searchProduct()},blackDict:function(e,t){var a=this;return Object(o["a"])(regeneratorRuntime.mark((function i(){var n,r;return regeneratorRuntime.wrap((function(i){while(1)switch(i.prev=i.next){case 0:return n={data:t,key:e,type:"Product"},i.next=3,Object(p["postDict"])(n);case 3:r=i.sent,r?a.$message({type:"success",message:"备份成功"}):a.$message({type:"error",message:"备份失败"});case 5:case"end":return i.stop()}}),i)})))()},CloneData:function(e){var t=this;return Object(o["a"])(regeneratorRuntime.mark((function a(){var i,n,r,o;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return i={category:e.attributes.category,devType:e.attributes.devType,name:e.attributes.name,thing:e.attributes.thing},a.next=3,Object(m["getHashClass"])("Product",i);case 3:n=a.sent,r=n.objectId,o=n.code,200==o&&t.blackDict(r,i);case 7:case"end":return a.stop()}}),a)})))()},proudctClone:function(e){e.attributes.config.cloneState=!0,e.attributes.config.cloneState=!0;var t=e,a=Object(l["putProduct"])(e.id,t);a&&this.CloneData(e)},proudctEdit:function(e){var t=window.location.origin+"/spa",a="production";t="development"==a?this.$globalConfig.localTopoUrl:window.location.origin+"/spa";var i="".concat(t,"/#?drawProudctid=").concat(e.objectId,"&proudctid=").concat(e.objectId);localStorage.setItem("rowId",e.objectId),window.open(i,"__blank")},proudctView:function(e){var t=window.location.origin+"/spa",a="production";t="development"==a?this.$globalConfig.localTopoUrl:window.location.origin+"/spa";var i="".concat(t,"/#/views/").concat(e.objectId);window.open(i,"__blank")},goTopoview:function(){var e=window.location.origin+"/spa",t="production";e="development"==t?this.$globalConfig.localTopoUrl:window.location.origin+"/spa";var a="".concat(e,"/#/view");window.open(a,"__blank")},exportpro:function(){this.allTableDate?Object(d["export_txt_to_zip"])(JSON.stringify(this.allTableDate),"Dict","Dict"):this.$message({type:"warning",message:"数据为空,无法导出"})}}},h=f,v=(a("b35a"),a("5cd2"),a("2877")),g=Object(v["a"])(h,i,n,!1,null,"45444c51",null);t["default"]=g.exports},"7aea":function(e,t,a){},"7af0":function(e,t,a){"use strict";a.r(t);var i,n,r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"equipment"},[a("div",{staticClass:"equ_header"},[a("ul",[a("li",[a("p",[a("span",{staticClass:"svg-container"},[a("vab-icon",{attrs:{icon:"device-fill"}})],1),e._v(" "+e._s(e.$translateTitle("equipment.totalequipment"))+" "),a("el-tooltip",{attrs:{content:e.$translateTitle("equipment.totalequipment"),placement:"top"}},[a("i",{staticClass:"el-icon-question"})])],1),a("span",[e._v(e._s(e.devicetotal))])]),a("li",[a("p",[a("span",{staticClass:"svg-container"},[a("vab-icon",{attrs:{icon:"24-hours-line"}})],1),e._v(" "+e._s(e.$translateTitle("equipment.onlinedevices"))+" "),a("el-tooltip",{attrs:{content:e.$translateTitle("equipment.totalonline"),placement:"top"}},[a("i",{staticClass:"el-icon-question"})])],1),a("span",[e._v(e._s(e.onlineall))])])])]),a("div",{staticClass:"equtabs"},[a("div",{staticClass:"equdevices",staticStyle:{"margin-top":"20px"}},[a("el-select",{staticClass:"selectdetail",attrs:{disabled:!e.productenable,size:"small"},model:{value:e.equvalue,callback:function(t){e.equvalue=t},expression:"equvalue"}},e._l(e.proTableData,(function(e,t){return a("el-option",{key:t,attrs:{label:e.name,value:e.objectId}})})),1),a("el-select",{staticClass:"selectdetail",attrs:{placeholder:"请选择状态",size:"small",clearable:""},model:{value:e.onlinedevices,callback:function(t){e.onlinedevices=t},expression:"onlinedevices"}},[a("el-option",{attrs:{value:"在线"}}),a("el-option",{attrs:{value:"离线"}})],1),a("el-select",{staticClass:"selectdetail",attrs:{size:"small",clearable:""},model:{value:e.selectdevice,callback:function(t){e.selectdevice=t},expression:"selectdevice"}},[a("el-option",{attrs:{value:e.$translateTitle("equipment.devicename")}}),a("el-option",{attrs:{value:e.$translateTitle("equipment.devicenumber")}})],1),e.selectdevice==e.$translateTitle("equipment.devicename")?a("el-input",{staticClass:"selectdetail",attrs:{placeholder:e.$translateTitle("equipment.enterproductname"),size:"small"},model:{value:e.deviceinput,callback:function(t){e.deviceinput=t},expression:"deviceinput"}}):a("el-input",{staticClass:"selectdetail",attrs:{placeholder:e.$translateTitle("equipment.enterdevicenumber"),size:"small"},model:{value:e.deviceinput,callback:function(t){e.deviceinput=t},expression:"deviceinput"}}),a("el-button",{staticClass:"selectdetail",attrs:{size:"small",type:"primary"},on:{click:function(t){return e.getDevices(0)}}},[e._v(" "+e._s(e.$translateTitle("developer.search"))+" ")]),a("el-button",{staticClass:"selectdetail",attrs:{disabled:0==e.multipleTable.length,size:"small",type:"primary"},on:{click:e.deleteDevcie}},[e._v(" "+e._s(e.$translateTitle("developer.delete"))+" ")]),a("el-button",{staticClass:"selectdetail",attrs:{disabled:0==e.multipleTable.length,size:"small",type:"primary"},on:{click:function(t){return e.unactiveDevice(!1)}}},[e._v(" "+e._s(e.$translateTitle("developer.prohibit"))+" ")]),a("el-button",{staticClass:"selectdetail",attrs:{disabled:0==e.multipleTable.length,size:"small",type:"primary"},on:{click:function(t){return e.unactiveDevice(!0)}}},[e._v(" "+e._s(e.$translateTitle("developer.enable"))+" ")]),a("el-button",{attrs:{size:"small"}},[e._v(" "+e._s(e.$translateTitle("equipment.batchaddition"))+" ")]),a("el-button",{attrs:{type:"primary",size:"small"},on:{click:e.addDeviceForm}},[e._v(" "+e._s(e.$translateTitle("equipment.adddevice"))+" ")])],1),a("div",{staticClass:"tabstable"},[a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.listLoading,expression:"listLoading"}],ref:"filterTable",staticStyle:{width:"100%","margin-top":"20px","text-align":"center"},attrs:{data:e.tableData,"row-style":e.rowClass},on:{"selection-change":e.handleSelectionChange}},[a("el-table-column",{attrs:{type:"selection",align:"center",width:"55"}}),a("el-table-column",{attrs:{label:e.$translateTitle("equipment.devicenumber")+"/"+e.$translateTitle("equipment.name"),align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(t.row.devaddr))]),a("p",{staticStyle:{margin:"0",color:"green"}},[e._v(e._s(t.row.name))])]}}])}),a("el-table-column",{attrs:{label:e.$translateTitle("equipment.state"),align:"center",width:"200"},scopedSlots:e._u([{key:"default",fn:function(t){return["ONLINE"==t.row.status?a("span",{class:t.row.status},[e._v(" "+e._s(e.$translateTitle("product.online"))+" ")]):e._e(),"ONLINE"==t.row.status?a("el-tooltip",{attrs:{content:"设备已经上线",placement:"top"}},[a("i",{staticClass:"el-icon-question"})]):e._e(),"OFFLINE"==t.row.status?a("span",{class:t.row.status},[e._v(" "+e._s(e.$translateTitle("product.offline"))+" ")]):e._e(),"OFFLINE"==t.row.status?a("el-tooltip",{attrs:{content:"设备已经离线",placement:"top"}},[a("i",{staticClass:"el-icon-question"})]):e._e(),"OFFLINE"!=t.row.status&&"ONLINE"!=t.row.status?a("span",{class:t.row.status},[e._v(" 未注册 ")]):e._e()]}}])}),a("el-table-column",{attrs:{label:e.$translateTitle("equipment.product"),align:"center",width:"200"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(t.row.product.name))])]}}])}),"云寓智慧公寓平台"!=e.Default.title?a("el-table-column",{attrs:{label:e.$translateTitle("equipment.nodetype"),align:"center"},scopedSlots:e._u([{key:"default",fn:function(e){return[a("vab-icon",{staticStyle:{width:"2rem",height:"2rem"},attrs:{icon:0==e.row.nodeType?"hotel-bed-fill":"hotel-fill"}})]}}],null,!1,162072248)}):e._e(),a("el-table-column",{directives:[{name:"show",rawName:"v-show",value:"云寓智慧公寓平台"==e.Default.title,expression:"Default.title == '云寓智慧公寓平台'"}],attrs:{label:"授权码",align:"center",width:"200"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(" "+e._s(t.row.basedata&&t.row.basedata.auth?t.row.basedata.auth:"")+" ")])]}}])}),a("el-table-column",{attrs:{label:e.$translateTitle("developer.enable")+"/"+e.$translateTitle("developer.prohibit"),align:"center",width:"200"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-switch",{attrs:{"active-color":"#5eb058","inactive-color":"#cccccc"},on:{change:function(a){return e.handelUpdate(a,t.row,t.$index)}},model:{value:t.row.isEnable,callback:function(a){e.$set(t.row,"isEnable",a)},expression:"scope.row.isEnable"}})]}}])}),a("el-table-column",{attrs:{label:"创建时间",width:"200"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(e.utc2beijing(t.row.createdAt)))])]}}])}),a("el-table-column",{attrs:{label:e.$translateTitle("developer.operation"),align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return["云寓智慧公寓平台"!=e.Default.title?a("el-link",{attrs:{underline:!1,type:"primary",icon:"el-icon-view"},on:{click:function(a){return e.deviceToDetail(t.row)}}},[e._v(" "+e._s(e.$translateTitle("equipment.see"))+" ")]):e._e(),a("el-link",{attrs:{underline:!1,type:"primary",icon:"el-icon-edit"},on:{click:function(a){return e.editorDevice(t.row)}}},[e._v(" "+e._s(e.$translateTitle("concentrator.edit"))+" ")]),a("el-popover",{ref:"popover-"+t.$index,attrs:{placement:"top",width:"300"}},[a("p",[e._v("确定删除这个"+e._s(t.row.name)+"设备吗？")]),a("div",{staticStyle:{margin:"0","text-align":"right"}},[a("el-button",{attrs:{size:"mini"},on:{click:function(e){t._self.$refs["popover-"+t.$index].doClose()}}},[e._v(" "+e._s(e.$translateTitle("developer.cancel"))+" ")]),a("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(a){return e.makeSure(t)}}},[e._v(" "+e._s(e.$translateTitle("developer.determine"))+" ")])],1),a("el-link",{attrs:{slot:"reference",underline:!1,icon:"el-icon-delete",type:"danger"},slot:"reference"},[e._v(" "+e._s(e.$translateTitle("developer.delete"))+" ")])],1)]}}])})],1),a("div",{staticClass:"elpagination",staticStyle:{"margin-top":"20px"}},[a("el-pagination",{attrs:{"page-sizes":[10,20,30,50],"page-size":e.devicelength,total:e.devicetotal,layout:"total, sizes, prev, pager, next, jumper"},on:{"size-change":e.deviceSizeChange,"current-change":e.deviceCurrentChange}})],1)],1),a("el-dialog",{attrs:{title:"设备"+e.equipmentEditor,visible:e.devicedialogVisible,"close-on-click-modal":!1,"before-close":e.handleClose,width:"50%"},on:{"update:visible":function(t){e.devicedialogVisible=t}}},[a("div",{staticClass:"header-title",attrs:{slot:"title"},slot:"title"},[a("span",{staticClass:"title-name"},[e._v(" "+e._s("设备"+e.equipmentEditor)+" "),a("el-tooltip",{staticStyle:{"margin-left":"5px"},attrs:{content:e.$translateTitle("equipment.text"),placement:"top"}},[a("i",{staticClass:"el-icon-question"})])],1)]),a("div",{staticClass:"devicecontent"},[a("el-form",{ref:"deviceform",attrs:{model:e.deviceform,rules:e.rules,"label-width":"150px"}},[a("el-form-item",{attrs:{label:e.$translateTitle("equipment.devicename"),prop:"name"}},[a("el-input",{model:{value:e.deviceform.name,callback:function(t){e.$set(e.deviceform,"name",t)},expression:"deviceform.name"}})],1),a("el-form-item",{attrs:{label:e.$translateTitle("equipment.devicenumber"),prop:"devaddr"}},[a("el-input",{model:{value:e.deviceform.devaddr,callback:function(t){e.$set(e.deviceform,"devaddr",t)},expression:"deviceform.devaddr"}})],1),a("el-form-item",{attrs:{label:e.$translateTitle("product.productname"),prop:"productName"}},[a("el-select",{attrs:{placeholder:e.$translateTitle("equipment.entername"),disabled:!e.productenable||!e.changeproduct},model:{value:e.deviceform.productName,callback:function(t){e.$set(e.deviceform,"productName",t)},expression:"deviceform.productName"}},e._l(e.proTableData1,(function(e,t){return a("el-option",{key:t,attrs:{label:e.name,value:e.objectId}})})),1)],1),a("el-form-item",{attrs:{label:e.$translateTitle("equipment.assetnumber")}},[a("el-input",{model:{value:e.deviceform.assetNum,callback:function(t){e.$set(e.deviceform,"assetNum",t)},expression:"deviceform.assetNum"}})],1),a("el-form-item",{attrs:{label:e.$translateTitle("equipment.equipmenttype")}},[a("el-input",{model:{value:e.deviceform.devModel,callback:function(t){e.$set(e.deviceform,"devModel",t)},expression:"deviceform.devModel"}})],1),a("el-form-item",{attrs:{label:e.$translateTitle("equipment.equipmentbrand")}},[a("el-input",{model:{value:e.deviceform.brand,callback:function(t){e.$set(e.deviceform,"brand",t)},expression:"deviceform.brand"}})],1),"云寓智慧公寓平台"==e.Default.title?a("el-form-item",{attrs:{label:e.$translateTitle("equipment.auth")}},[a("el-input",{model:{value:e.deviceform.auth,callback:function(t){e.$set(e.deviceform,"auth",t)},expression:"deviceform.auth"}})],1):e._e(),"云寓智慧公寓平台"==e.Default.title?a("el-form-item",{attrs:{label:e.$translateTitle("equipment.application")}},[a("el-select",{attrs:{placeholder:e.$translateTitle("equipment.application")},model:{value:e.deviceform.yysId,callback:function(t){e.$set(e.deviceform,"yysId",t)},expression:"deviceform.yysId"}},e._l(e.yysSelect,(function(e,t){return a("el-option",{key:t,attrs:{label:e.name,value:e.key}})})),1)],1):e._e(),a("el-form-item",{attrs:{label:e.$translateTitle("equipment.installationlocation")}},[a("el-input",{on:{focus:e.updateLocation},model:{value:e.deviceform.address,callback:function(t){e.$set(e.deviceform,"address",t)},expression:"deviceform.address"}})],1),a("el-form-item",{attrs:{label:e.$translateTitle("developer.describe")}},[a("el-input",{attrs:{autosize:{minRows:4,maxRows:4},type:"textarea"},model:{value:e.deviceform.desc,callback:function(t){e.$set(e.deviceform,"desc",t)},expression:"deviceform.desc"}})],1)],1)],1),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.submitForm("deviceform")}}},[e._v(" "+e._s(e.$translateTitle("developer.determine"))+" ")]),a("el-button",{on:{click:e.handleClose}},[e._v(" "+e._s(e.$translateTitle("developer.cancel"))+" ")])],1)]),a("el-dialog",{directives:[{name:"drag-dialog",rawName:"v-drag-dialog"}],attrs:{visible:e.bmapdialogVisible,"close-on-click-modal":!1,"before-close":e.handleClosebmap,title:"设备安装地址",width:"50%"},on:{"update:visible":function(t){e.bmapdialogVisible=t}}},[a("div",[a("el-form",{attrs:{model:e.bmapform,inline:!0,size:"small"}},[a("el-form-item",{attrs:{label:"地址名称"}},[a("el-input",{model:{value:e.bmapform.keyword,callback:function(t){e.$set(e.bmapform,"keyword",t)},expression:"bmapform.keyword"}})],1),a("el-form-item",{attrs:{label:"选中地址"}},[a("el-input",{attrs:{readonly:""},model:{value:e.bmapform.address,callback:function(t){e.$set(e.bmapform,"address",t)},expression:"bmapform.address"}})],1)],1),a("baidu-map",{staticStyle:{height:"300px"},attrs:{center:e.center,zoom:e.zoom,"scroll-wheel-zoom":!0,"map-click":!1},on:{ready:e.handler,click:e.mapClick}},[a("bm-local-search",{staticStyle:{display:"none"},attrs:{keyword:e.bmapform.keyword,"auto-viewport":!0,location:e.bmapform.location,zoom:"12.8"}}),a("bm-navigation",{attrs:{anchor:"BMAP_ANCHOR_TOP_RIGHT"}}),a("bm-geolocation",{attrs:{"show-address-bar":!0,"auto-location":!0,anchor:"BMAP_ANCHOR_BOTTOM_RIGHT"}}),a("bm-city-list",{attrs:{anchor:"BMAP_ANCHOR_TOP_LEFT"}})],1)],1),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{type:"primary"},on:{click:e.addressSure}},[e._v("保 存")]),a("el-button",{on:{click:function(t){e.bmapdialogVisible=!1}}},[e._v("取 消")])],1)])],1)])},o=[],l=a("15fd"),s=a("1da1"),c=a("5530"),d=(a("96cf"),a("159b"),a("d81d"),a("99af"),a("841c"),a("ac1f"),a("b680"),a("b0c0"),a("4de4"),a("5319"),a("b64b"),a("caad"),a("2532"),a("5880")),u=a("0941"),p=a("a8be"),m=a("dcc6"),f=a("4be7"),h=a("be65"),v=a.n(h),g=a("7212"),b=a("cb88"),y=a("30f8"),w={components:{BaiduMap:b["BaiduMap"],BmLocalSearch:b["BmLocalSearch"],BmNavigation:b["BmNavigation"],BmGeolocation:b["BmGeolocation"],BmCityList:b["BmCityList"]},data:function(){var e=function(e,t,a){var i=/[0-9A-Za-z]$/;""==t?a(new Error("设备地址不能为空")):i.test(t)?a():a(new Error("设备地址必须为大小写字母数字"))};return{listLoading:!1,productimg:"",bmapdialogVisible:!1,onlineall:0,activeall:0,userId:"",batchid:"",pcdialogVisible:!0,devicedialogVisible:!1,equvalue:"0",cities:[],activeName:"first",selectdevice:"",onlinedevices:"",deviceinput:"",devicenumber:"",multipleTable:[],selectRow:[],devicelength:10,devicestart:0,devicetotal:0,visible2:!1,deviceform:{name:"",devaddr:"",batchId:"",desc:"",nodeType:0,devType:"",netType:"",assetNum:"",devModel:"",address:"",productName:"",status:"",isEnable:"",brand:"",auth:"",yysId:""},yysSelect:[],rules:{name:[{required:!0,message:"请输入设备名称",trigger:"blur"}],devaddr:[{required:!0,message:"请输入设备编号",trigger:"blur"},{validator:e}],batchId:[{required:!0,message:"请输入设备批次",trigger:"blur"}],nodeType:[{required:!0,message:"请输入设备类型",trigger:"blur"}],netType:[{required:!0,message:"请选择网络格式",trigger:"change"}],devType:[{required:!0,message:"请选择设备类型",trigger:"change"}],productName:[{required:!0,message:"请选择产品名称",trigger:"change"}]},pcformrule:{pcname:[{required:!0,message:"请输入批次名称",trigger:"blur"}],createdtime:[{type:"date",required:!0,message:"请选择创建时间",trigger:"change"}]},pcformInline:{pcnumber:"",pcname:"",createdtime:""},pctableData:[],equipmentEditor:"添加",tableData:[],options:[],proTableData:[],proTableData1:[],activelength:[],onlinelength:[],center:{lng:0,lat:0},zoom:13,bmapform:{keyword:"",location:"",address:""},deviceid:"",map:null,addresspointer:"",productenable:!0,changeproduct:!0,tagsid:"",productroleslist:[]}},computed:Object(c["a"])({},Object(d["mapGetters"])({Default:"acl/Default"})),watch:{multipleTable:function(e){var t=this;this.selectRow=[],e.length>0&&e.forEach((function(e,a){t.selectRow.push(t.tableData.indexOf(e))}))}},mounted:function(){this.searchProduct(),this.getDevices(0),this.queryYysId(),i=v.a.get("language")},methods:{queryYysId:function(){var e=this;return Object(s["a"])(regeneratorRuntime.mark((function t(){var a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:a={order:"-createdAt",limit:100,skip:0,where:{type:"b83b5d9fc0"}},Object(p["queryDict"])(a).then((function(t){e.yysSelect=[{name:"空",key:""}],t.results.map((function(t){e.yysSelect.push(t.data)}))}));case 2:case"end":return t.stop()}}),t)})))()},rolesSelect:function(e){var t=this;return Object(s["a"])(regeneratorRuntime.mark((function a(){var i;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return t.productroleslist=[],a.next=3,t.$get_object("Product",e);case 3:i=a.sent,i.results;case 5:case"end":return a.stop()}}),a)})))()},goEdit:function(e){var t=window.location.origin+"/spa",a="production";t="development"==a?this.$globalConfig.localTopoUrl:window.location.origin+"/spa";var i="".concat(t,"/#?devaddr=").concat(e.devaddr,"&proudctid=").concat(e.productid);window.open(i,"__blank"),localStorage.setItem("topoData",JSON.stringify(e.config))},addressSure:function(){var e=new BMap.LocalSearch(this.map);e.enableAutoViewport();""==this.bmapform.address&&(this.deviceform.address=this.bmapform.keyword),e.search(this.bmapform.keyword),this.bmapdialogVisible=!1},handler:function(e){e.BMap;var t=e.map;this.center.lng=120.2,this.center.lat=30.26667,this.zoom=this.zoom,this.map=t},mapClick:function(e){var t=this;this.center.lng=e.point.lng,this.center.lat=e.point.lat,this.addresspointer=e.point.lng.toFixed(6)+","+e.point.lat.toFixed(6);var a=new BMap.Geocoder;a.getLocation(e.point,(function(e){t.bmapform.address=e.address,t.deviceform.address=e.address}))},updateLocation:function(){this.bmapdialogVisible=!0},handleClosebmap:function(){this.bmapdialogVisible=!1},getOnlineDevices:function(){var e=this;return Object(s["a"])(regeneratorRuntime.mark((function t(){var a,i;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return a={limit:1,keys:"count(*)",where:{status:"ONLINE"}},""!=e.deviceinput&&("设备名称"==e.selectdevice?a.where.name=e.deviceinput:a.where.devaddr=e.deviceinput),""!=e.devicenumber&&(a.where.devaddr=e.devicenumber),0!=e.equvalue&&(a.where.product=e.equvalue),t.next=6,e.$queryDevice(a);case 6:i=t.sent,e.onlineall=i.count;case 8:case"end":return t.stop()}}),t)})))()},searchProduct:function(){var e=this;return Object(s["a"])(regeneratorRuntime.mark((function t(){var a,n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.proTableData=[],e.proTableData1=[],t.next=4,e.$query_object("Product",{});case 4:a=t.sent,n=a.results,e.proTableData=n,e.proTableData.unshift({name:"zh"==i?"全部产品":"All Products",objectId:"0"}),e.proTableData1=n.filter((function(e){return"0"!=e.objectId})),e.$route.query.productid&&(e.equvalue=e.$route.query.productid,e.productenable=!1);case 10:case"end":return t.stop()}}),t)})))()},getDevices:function(e){var t=this;return Object(s["a"])(regeneratorRuntime.mark((function a(){var i,n,r,o,l,s;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return t.listLoading=!0,t.tableData=[],i={limit:t.devicelength,skip:t.devicestart,order:"-createdAt",keys:"count(*)",include:"product",where:{}},""!=t.deviceinput&&("设备名称"==t.selectdevice?i.where.name=t.deviceinput:i.where.devaddr=t.deviceinput),""!=t.onlinedevices&&("在线"==t.onlinedevices?i.where.status="ONLINE":i.where.status="OFFLINE"),""!=t.devicenumber&&(i.where.devaddr=t.devicenumber),0!=t.equvalue&&(i.where.product=t.equvalue),0==e&&(t.devicestart=0),a.next=10,t.$queryDevice(i);case 10:n=a.sent,r=n.results,o=void 0===r?[]:r,l=n.count,s=void 0===l?0:l,t.listLoading=!1,t.tableData=o,t.devicetotal=s,t.getOnlineDevices();case 19:case"end":return a.stop()}}),a)})))()},handelUpdate:function(e,t,a){var i=this;return Object(s["a"])(regeneratorRuntime.mark((function e(){var n,r;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:for(r in n={},i,t)n[r]=t[r];n.isEnable=1!=n.isEnable,i.tableData[a]=n,i.$confirm("是否修改此设备状态?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(Object(s["a"])(regeneratorRuntime.mark((function e(){var a,n,r,o,s;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,Object(u["get_object"])("Device",t.objectId);case 2:return a=e.sent,n=a.isEnable,n=void 0!=n&&!n,a.isEnable=n,a.createdAt,r=Object(l["a"])(a,["createdAt"]),r.updatedAt,o=Object(l["a"])(r,["updatedAt"]),e.next=10,i.$update_object("Device",t.objectId,o);case 10:s=e.sent,void 0!=s?(i.$message({type:"success",message:"状态修改成功"}),i.getDevices()):Object(y["returnLogin"])(error);case 12:case"end":return e.stop()}}),e)})))).catch(Object(s["a"])(regeneratorRuntime.mark((function e(){var n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:i.$message({type:"info",message:"已取消修改"}),n=t,n.isEnable=1!=n.isEnable,i.tableData[a]=n;case 4:case"end":return e.stop()}}),e)}))));case 6:case"end":return e.stop()}}),e)})))()},timestampToTime:function(e){var t=new Date(1e3*e),a=t.getFullYear()+"-",i=(t.getMonth()+1<10?"0"+(t.getMonth()+1):t.getMonth()+1)+"-",n=(t.getDate()+1<=10?"0"+t.getDate():t.getDate())+" ",r=(t.getHours()+1<=10?"0"+t.getHours():t.getHours())+":",o=(t.getMinutes()+1<=10?"0"+t.getMinutes():t.getMinutes())+":",l=t.getSeconds()+1<=10?"0"+t.getSeconds():t.getSeconds();return a+i+n+r+o+l},utc2beijing:function(e){var t=new Date(+new Date(e)+288e5).toISOString().replace(/T/g," ").replace(/\.[\d]{3}Z/,"");return t},filterTag:function(e,t){return t.tag===e},handleSelectionChange:function(e){this.multipleTable=e},deleteDevcie:function(e){var t=this;return Object(s["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:t.multipleTable.map(function(){var e=Object(s["a"])(regeneratorRuntime.mark((function e(a){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,t.$del_object("Device",a.objectId);case 2:e.sent;case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),t.$message({message:"删除成功",type:"success"}),t.getDevices();case 3:case"end":return e.stop()}}),e)})))()},editDevice:function(){var e=this;return Object(s["a"])(regeneratorRuntime.mark((function t(){var a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.$update_object("Device",item.objectId,params);case 2:a=t.sent,a.updatedAt?e.initQuery("设备修改成功","success"):e.$message({type:"error",message:a.error});case 4:case"end":return t.stop()}}),t)})))()},unactiveDevice:function(e){var t=this;return Object(s["a"])(regeneratorRuntime.mark((function a(){var i,n,r,o;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return i=[],n=[],t.multipleTable.map((function(e){i.push(e.objectId)})),r={isEnable:e},a.next=6,Object(m["Batchdelete"])("PUT","Device",i,r);case 6:o=a.sent,o&&(o.forEach((function(e,t){e.objectId=i[t],e.sortIndex=t+1,"success"==Object.keys(o[t])[0]?(e.msg="edit success",e.dangerouslyUseHTMLString=!1):(e.msg="<ol>\n            edit error <br>\n            message: ".concat(e.error.error," <br>\n            code: ").concat(e.error.code," <ol>"),e.dangerouslyUseHTMLString=!0),n.push({type:Object.keys(o[t])[0],message:e.msg,dangerouslyUseHTMLString:e.dangerouslyUseHTMLString})})),n.forEach((function(e,a){t.$baseNotify(e.message,"".concat(i[a]),e.type,"top-right",5e3*e.sortIndex,e.dangerouslyUseHTMLString)})),t.getDevices());case 8:case"end":return a.stop()}}),a)})))()},rowClass:function(e){e.row;var t=e.rowIndex;if(this.selectRow.includes(t))return{"background-color":"rgba(185, 221, 249, 0.3)"}},deviceSizeChange:function(e){this.devicelength=e,this.getDevices()},deviceCurrentChange:function(e){this.devicestart=(e-1)*this.devicelength,this.getDevices()},handleClose:function(){this.deviceid="",this.deviceform={name:"",devaddr:"",batchId:"",desc:"",nodeType:0,devType:"",netType:"",assetNum:"",devModel:"",address:"",productName:"",status:"",isEnable:"",brand:"",auth:"",yysId:""},this.$refs["deviceform"].resetFields(),this.devicedialogVisible=!1,this.equipmentEditor="添加"},addDeviceForm:function(){this.devicedialogVisible=!0,this.equipmentEditor="添加",this.$route.query.productid?this.deviceform.productName=this.$route.query.productid:0!=this.equvalue?(this.changeproduct=!1,this.deviceform.productName=this.equvalue):this.deviceform.productName=""},handleClose1:function(){this.pcdialogVisible=!1,this.batchid="",this.pcformInline={pcname:"",createdtime:""}},makeSure:function(e){var t=this;return Object(s["a"])(regeneratorRuntime.mark((function a(){var i;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return a.next=2,t.$del_object("Device",e.row.objectId);case 2:i=a.sent,i.error?t.$message({type:"error",message:"删除失败"}):(t.$message({type:"success",message:"删除成功"}),t.getDevices()),e._self.$refs["popover-".concat(e.$index)].doClose();case 5:case"end":return a.stop()}}),a)})))()},editorDevice:function(e){var t=this;return Object(s["a"])(regeneratorRuntime.mark((function a(){var i,n,r,o,l,s,c,d,u,p,m;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:i=e.devaddr,n=e.detail,e.ip,r=e.isEnable,o=e.name,l=e.objectId,s=e.product,c=e.status,e.updatedAt,d=e.basedata,u=void 0===d?{auth:"",yysId:""}:d,p=e.location,m=void 0===p?{latitude:"30.307102168533543",longitude:"120.1703918503909"}:p,t.deviceform={},t.deviceid=l,t.devicedialogVisible=!0,t.deviceform={devaddr:i,name:o,assetNum:n.assetNum,devModel:n.devModel,desc:n.desc,productid:s.objectId,brand:n.brand,productName:s.objectId,status:c,isEnable:r,address:n.address,auth:u.auth,yysId:u.yysId},t.bmapform={address:n.address},t.center={lat:m.latitude,lng:m.longitude},t.addresspointer=void 0==n||void 0==m||m.latitude+e.detail==void 0?"":m.longitude,t.equipmentEditor="编辑";case 9:case"end":return a.stop()}}),a)})))()},getBatch:function(){return new f["Promise"]((function(e,t){n.length>0?e(n):t(!1)}))},initQuery:function(e,t){this.$message({type:t||"info",message:e}),this.dialogFormVisible=!1,this.getDevices()},updateDevice:function(e){var t=this;return Object(s["a"])(regeneratorRuntime.mark((function a(){var i;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return a.next=2,t.$update_object("Device",t.deviceid,e);case 2:i=a.sent,i.updatedAt?t.initQuery("设备更新成功","success"):t.$message({type:"error",message:i.error});case 4:case"end":return a.stop()}}),a)})))()},createDevice:function(e){var t=this;return Object(s["a"])(regeneratorRuntime.mark((function a(){var i;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return a.next=2,t.$create_object("Device",e);case 2:i=a.sent,i.objectId?t.initQuery("设备创建成功","success"):t.$message({type:"error",message:i.error});case 4:case"end":return a.stop()}}),a)})))()},submitForm:function(e){var t=this;return Object(s["a"])(regeneratorRuntime.mark((function a(){return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:t.$refs[e].validate(function(){var e=Object(s["a"])(regeneratorRuntime.mark((function e(a){var i,n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(!a){e.next=6;break}i={__type:"GeoPoint",latitude:t.center.lat?t.center.lat:0,longitude:t.center.lng?t.center.lng:0},n={assetNum:t.deviceform.assetNum,devModel:t.deviceform.devModel,brand:t.deviceform.brand,address:t.bmapform.address,desc:t.deviceform.desc},Object(g["getProduct"])(t.deviceform.productName).then((function(e){if(e)if(""!=t.deviceid){var a={name:t.deviceform.name,devaddr:t.deviceform.devaddr,product:{__type:"Pointer",className:"Product",objectId:e.objectId},detail:n,location:i,basedata:{auth:t.deviceform.auth,yysId:t.deviceform.yysId}};t.updateDevice(a),t.handleClose(),t.getDevices()}else{var r={keys:"count(*)",where:{name:{$in:[t.deviceform.name]},devaddr:{$in:[t.deviceform.devaddr]}}};t.$query_object("Device",r).then((function(a){if(a.count>0)t.$message("此设备已被创建");else{var r={product:{__type:"Pointer",className:"Product",objectId:t.deviceform.productName},status:"OFFLINE",isEnable:!1,ACL:e.ACL,name:t.deviceform.name,devaddr:t.deviceform.devaddr,objectId:t.deviceform.devaddr,lastOnlineTime:0,detail:n,location:i,basedata:{auth:t.deviceform.auth,yysId:t.deviceform.yysId}};t.createDevice(r),t.deviceform={},t.handleClose(),t.getDevices()}}))}})),e.next=8;break;case 6:return t.$message({type:"error",message:"请按照要求填写参数"}),e.abrupt("return",!1);case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 1:case"end":return a.stop()}}),a)})))()},deviceToDetail:function(e){this.$router.push({path:"/roles/editdevices",query:{deviceid:e.objectId,nodeType:e.nodeType,ischildren:"false"}})},handleClick:function(e,t){"second"==e.name&&this.queryDict()},queryDict:function(){var e=this;return Object(s["a"])(regeneratorRuntime.mark((function t(){var a,i;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.$getBatchNumer();case 2:a=t.sent,i=a.results,e.pctableData=i;case 5:case"end":return t.stop()}}),t)})))()},deviceToChildren:function(e){this.$router.push({path:"/roles/editdevices",query:{deviceid:e.objectId,nodeType:e.nodeType,ischildren:"true"}})}}},_=w,T=(a("ab01"),a("b9e5"),a("2877")),$=Object(T["a"])(_,r,o,!1,null,"45b5d0ea",null);t["default"]=$.exports},"7e10":function(e,t,a){"use strict";a.r(t);var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"group"},[a("el-container",[a("el-container",[a("el-main",[a("div",{staticClass:"main"},[a("el-drawer",{attrs:{visible:e.drawer,direction:"ltr"},on:{"update:visible":function(t){e.drawer=t}}},[e.showTree?a("div",{staticClass:"tree"},[e._v(" 搜索 : "),a("el-input",{staticStyle:{width:"80%"},attrs:{placeholder:"输入关键字进行过滤"},model:{value:e.filterText,callback:function(t){e.filterText=t},expression:"filterText"}}),a("el-tree",{ref:"tree",staticClass:"treeitems",attrs:{data:e.treeData,props:e.defaultProps,"allow-drop":e.allowDrop,"allow-drag":e.allowDrag,"filter-node-method":e.filterNode,"default-expand-all":"","node-key":"id",draggable:""},on:{"node-drop":e.handleDrop},scopedSlots:e._u([{key:"default",fn:function(t){var i=t.node,n=t.data;return a("span",{staticClass:"custom-tree-node"},[1==n.roles.seen?a("span",[a("el-input",{staticStyle:{width:"80%"},model:{value:e.editLabel,callback:function(t){e.editLabel=t},expression:"editLabel"}})],1):a("span",{staticStyle:{color:"#409eff"}},[e._v(e._s(i.label))]),0==n.roles.seen?a("span",{staticStyle:{"margin-left":"5px"}},[a("i",{staticClass:"el-icon-plus",staticStyle:{color:"#67c23a"},attrs:{title:"新增"},on:{click:function(t){return t.stopPropagation(),e.append(n)}}}),a("i",{staticClass:"el-icon-delete",staticStyle:{color:"red"},attrs:{title:"删除"},on:{click:function(t){return t.stopPropagation(),e.deletes(n)}}}),a("i",{staticClass:"el-icon-edit",staticStyle:{color:"#909399"},attrs:{title:"编辑"},on:{click:function(t){return t.stopPropagation(),e.rename(n)}}})]):a("span",[a("i",{staticClass:"el-icon-check",attrs:{slot:"suffix",title:"保存"},on:{click:function(t){return t.stopPropagation(),e.savename(n)}},slot:"suffix"})])])}}],null,!1,3055715610)})],1):e._e()]),a("el-tabs",{staticStyle:{display:"none"},on:{"tab-click":e.goTo},model:{value:e.activeName,callback:function(t){e.activeName=t},expression:"activeName"}},e._l(e.tabsNav,(function(e){return a("el-tab-pane",{key:e.url,attrs:{label:e.label,name:e.url}})})),1),a("router-view")],1),a("div",{staticClass:"setting"},[a("i",{class:[e.drawer?"el-icon-s-fold":"el-icon-s-unfold"],on:{click:function(t){return e.toggleTree()}}})])])],1)],1),a("el-dialog",{attrs:{visible:e.centerDialogRole,title:"添加角色",width:"35%",center:""},on:{close:e.closeDialogRole}},[a("addroles",{ref:"addRoleRef"})],1)],1)},n=[],r=a("53ca"),o=(a("5319"),a("ac1f"),a("4de4"),a("b0c0"),a("5da9")),l=a("5638"),s=a("3858"),c={name:"Group",components:{addroles:s["default"]},data:function(){return{drawer:!1,tabsNav:[{label:"统计预览",url:"platform"},{label:"虚拟分组",url:"devproduct"},{label:"通道列表",url:"resourcechannel"},{label:"设备列表",url:"devicelist"},{label:"产品列表",url:"productlist"},{label:"规则列表",url:"engine"}],numberValidateForm:{name:""},centerDialogRole:!1,editLabel:"",filterText:"",addForm:{seen:!1,date:"",name:"",address:""},treeData:[],defaultProps:{children:"children",label:"alias",isLeaf:"leaf"},showTree:!0}},computed:{activeName:{get:function(){return""!=this.$route.path.replace("/dashboard/","")?this.$route.path.replace("/dashboard/",""):"platform"},set:function(){}}},watch:{filterText:function(e){this.$refs.tree.filter(e)}},mounted:function(){var e=this;this.$baseEventBus.$on("dialogHide",(function(){e.centerDialogRole=!1,e.getTree()})),this.getTree()},methods:{goTo:function(e){this.$router.push({path:"/dashboard/"+e.name})},toggleTree:function(){this.drawer=!this.drawer},getTree:function(){var e=this;function t(e){var a=Array.isArray(e)?[]:{};if(e&&"object"===Object(r["a"])(e))for(var i in e)e.roles&&(e.roles.seen=!1),e.hasOwnProperty(i)&&(e[i]&&"object"===Object(r["a"])(e[i])?a[i]=t(e[i]):a[i]=e[i]);return a}Object(o["roletree"])().then((function(a){e.treeData=t(a.results)})).catch((function(t){e.treeData=[]}))},submitForm:function(e){var t=this;this.$refs[e].validate((function(e){if(!e)return!1;Object(l["addGroup"])(t.numberValidateForm.name).then((function(e){t.$message({message:"新建设备分组成功",type:"success"})})).catch((function(e){t.$message({message:"新建设备分组失败"+e.computed,type:"error"})}))}))},resetForm:function(e){this.$refs[e].resetFields()},append:function(e){var t=this;this.centerDialogRole=!0,this.$nextTick((function(){t.$refs["addRoleRef"].getData(e)}))},closeDialogRole:function(){this.centerDialogRole=!1,this.getTree()},deletes:function(e){var t=this;this.$confirm("此操作将永久删除该节点,包括其子节点","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){Object(o["delRole"])(e.objectId).then((function(e){t.getTree(),t.$message({type:"success",message:"删除成功!"})})).catch((function(e){t.$message({type:"error",message:"删除失败"+e.error})}))})).catch((function(){t.$message({type:"info",message:"已取消删除"})}))},rename:function(e){this.editLabel=e.alias,e.roles.seen=!0},savename:function(e){var t=this;e.alias!=this.editLabel&&Object(o["putRole"])(e.objectId,this.editLabel).then((function(a){t.$message({type:"success",message:"编辑成功"}),e.alias=t.editLabel})).catch((function(e){})),e.roles.seen=!1},allowDrop:function(e,t,a){return e.level===t.level&&(e.data.parentId===t.data.parentId?"prev"===a||"next"===a:void 0)},allowDrag:function(e){return 1!==e.level},handleDrop:function(e,t,a,i){var n=[],r=t.parent.childNodes;for(var o in r)n.push({id:r[o].data.id})},filterNode:function(e,t){return!e||-1!==t.label.indexOf(e)}}},d=c,u=(a("1bc4"),a("2877")),p=Object(u["a"])(d,i,n,!1,null,"0af06a76",null);t["default"]=p.exports},8446:function(e,t,a){"use strict";a("079a")},"848a":function(e,t,a){},"87da":function(e,t,a){},"8a2b":function(e,t,a){"use strict";a("87da")},"9df7":function(e,t,a){"use strict";a.r(t);var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("el-tab-pane",{attrs:{label:"物解析",name:"fourth"}},[a("div",{staticClass:"protolheader"},[a("el-form",{ref:"formInline",staticClass:"demo-form-inline",attrs:{inline:!0,model:e.formInline,rules:e.addRules}},[a("el-form-item",{attrs:{label:e.$translateTitle("product.protocolname"),prop:"name"}},[a("el-input",{attrs:{placeholder:e.$translateTitle("product.protocolname")},model:{value:e.formInline.name,callback:function(t){e.$set(e.formInline,"name",t)},expression:"formInline.name"}})],1),a("el-form-item",{attrs:{label:e.$translateTitle("plugins.version")}},[a("el-input",{attrs:{placeholder:e.$translateTitle("plugins.version")},model:{value:e.formInline.version,callback:function(t){e.$set(e.formInline,"version",t)},expression:"formInline.version"}})],1),a("el-form-item",{attrs:{label:e.$translateTitle("developer.describe")}},[a("el-input",{attrs:{placeholder:e.$translateTitle("developer.describe")},model:{value:e.formInline.desc,callback:function(t){e.$set(e.formInline,"desc",t)},expression:"formInline.desc"}})],1),a("el-form-item",[a("el-button",{attrs:{type:"primary",size:"small"},on:{click:function(t){return e.subAce("formInline",!0)}}},[e._v(" "+e._s(e.$translateTitle("product.preservation"))+" ")]),a("el-button",{attrs:{type:"primary",size:"small"},on:{click:function(t){return e.subAce1("formInline")}}},[e._v(" 设为公共 ")]),a("el-button",{attrs:{type:"primary",size:"small"},on:{click:e.chaxun}},[e._v(" "+e._s(e.$translateTitle("product.publicagreementlibrary"))+" ")])],1),a("el-form-item",{staticStyle:{display:"block"}},[a("el-button",{attrs:{type:"primary",size:"small"},on:{click:e.protol}},[e._v(" "+e._s(e.$translateTitle("product.compile"))+" ")]),a("el-button",{attrs:{type:"success",size:"small"},on:{click:e.updatesubdialog}},[e._v(" 热加载 ")])],1)],1)],1),a("el-dialog",{attrs:{visible:e.protoldialog,"close-on-click-modal":!1,title:"通道热加载",width:"50%"},on:{"update:visible":function(t){e.protoldialog=t}}},[a("el-table",{ref:"multipleTable",staticStyle:{width:"100%"},attrs:{data:e.protolchannel,"row-class-name":e.getChannelEnable},on:{"selection-change":e.handleSelectionChange}},[a("el-table-column",{attrs:{type:"selection",width:"55"}}),a("el-table-column",{attrs:{label:e.$translateTitle("developer.channelnumber")},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(t.row.objectId))])]}}])}),a("el-table-column",{attrs:{label:e.$translateTitle("developer.channelname")},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(t.row.name))])]}}])}),a("el-table-column",{attrs:{label:e.$translateTitle("developer.channeladdr")},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s("channel/"+t.row.objectId))])]}}])}),a("el-table-column",{attrs:{label:e.$translateTitle("developer.channeltype")},scopedSlots:e._u([{key:"default",fn:function(t){return[1==t.row.type?a("span",[e._v(" "+e._s(e.$translateTitle("developer.collectionchannel"))+" ")]):a("span",[e._v(" "+e._s(e.$translateTitle("developer.resourcechannel"))+" ")])]}}])}),a("el-table-column",{attrs:{label:e.$translateTitle("developer.servicetype")},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(t.row.cType))])]}}])})],1),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{type:"primary"},on:{click:e.updateAllChannel}},[e._v("确定")])],1)],1),a("el-dialog",{attrs:{title:e.$translateTitle("product.publicagreementlibrary"),visible:e.dialogTableVisible,"close-on-click-modal":!1,width:"50%"},on:{"update:visible":function(t){e.dialogTableVisible=t}}},[a("el-table",{staticStyle:{width:"100%","margin-top":"20px","text-align":"center"},attrs:{data:e.gridData}},[a("el-table-column",{attrs:{label:e.$translateTitle("product.protocolname"),align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(t.row.data.name))])]}}])}),a("el-table-column",{attrs:{label:e.$translateTitle("plugins.version"),align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(t.row.data.version))])]}}])}),a("el-table-column",{attrs:{label:e.$translateTitle("developer.describe"),align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(t.row.data.desc))])]}}])}),a("el-table-column",{attrs:{label:"创建时间",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(e.utc2beijing(t.row.createdAt)))])]}}])}),a("el-table-column",{attrs:{label:e.$translateTitle("developer.operation"),align:"center",width:"200"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(a){return e.editordata(t.row)}}},[e._v(" "+e._s(e.$translateTitle("product.clone"))+" ")]),a("el-button",{attrs:{type:"danger",size:"mini"},on:{click:function(a){return e.deletedata(t.row.objectId)}}},[e._v(" "+e._s(e.$translateTitle("developer.delete"))+" ")])]}}])})],1),a("div",{staticClass:"elpagination",staticStyle:{padding:"20px 0"}},[a("el-pagination",{attrs:{"page-sizes":[10,20,30,50],"page-size":e.decoderlength,total:e.decodertotal,layout:"total, sizes, prev, pager, next, jumper"},on:{"size-change":e.decoderSizeChange,"current-change":e.devicerCurrentChange}})],1)],1),a("div",[a("div",{staticStyle:{background:"#ffffff"}},[a("label",{attrs:{id:"plug-name"}})]),a("pre",{staticClass:"ace_editor",staticStyle:{"min-height":"600px","margin-bottom":"0"},attrs:{id:"editor"}},[a("textarea",{staticClass:"ace_text-input"})]),a("div",{staticStyle:{background:"#ffffff"}},[a("label",{attrs:{id:"plug-name"}})]),a("div",{staticStyle:{padding:"5px",color:"#c2be9e",background:"#272822","border-top":"1px solid #dddddd"}},[a("span",[e._v(e._s(e.$translateTitle("product.controloutput")))])]),a("pre",{staticClass:"ace_editor",staticStyle:{"min-height":"300px","margin-top":"0","margin-bottom":"0"},attrs:{id:"editor2"}},[a("textarea",{staticClass:"ace_text-input"})])])],1)],1)},n=[],r={components:{},data:function(){return{formInline:{name:"",version:"",desc:"",resource:!1}}},computed:{},methods:{}},o=r,l=(a("31dc"),a("2877")),s=Object(l["a"])(o,i,n,!1,null,"5519991f",null);t["default"]=s.exports},a7dd:function(e,t,a){"use strict";a("3684")},ab01:function(e,t,a){"use strict";a("e36f")},ac26:function(e,t,a){},af0c:function(e,t,a){"use strict";a("ac26")},b35a:function(e,t,a){"use strict";a("7aea")},b9e5:function(e,t,a){"use strict";a("32b6")},ba9b:function(e,t,a){},bcb5:function(e,t,a){},d361:function(e,t,a){"use strict";a("3152")},d60d:function(e,t,a){"use strict";a.r(t);var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"devproduct"},[a("h3",[e._v(" "+e._s(e.$translateTitle("route.产品管理"))+" "),e.projectName?a("span",[e._v(e._s("(所属应用:"+e.projectName+")"))]):e._e()]),a("el-tabs",{model:{value:e.activeName,callback:function(t){e.activeName=t},expression:"activeName"}},[a("el-tab-pane",{attrs:{label:e.$translateTitle("product.myproduct")+"("+e.total+")",name:"first"}},[a("div",{staticClass:"prosecond"},[a("el-form",{staticClass:"demo-form-inline",attrs:{inline:!0,model:e.formInline,size:"small"}},[a("el-form-item",[a("el-input",{attrs:{placeholder:e.$translateTitle("product.searchproductname")},model:{value:e.formInline.productname,callback:function(t){e.$set(e.formInline,"productname",t)},expression:"formInline.productname"}})],1),a("el-form-item",[a("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.searchProduct(0)}}},[e._v(" "+e._s(e.$translateTitle("developer.search"))+" ")])],1),a("el-form-item",{staticStyle:{float:"right","text-align":"right"}},[a("el-button",{directives:[{name:"show",rawName:"v-show",value:""!=e.projectid,expression:"projectid != ''"}],attrs:{type:"primary"},on:{click:e.addproduct}},[e._v(" "+e._s(e.$translateTitle("product.createproduct"))+" ")]),a("el-button",{attrs:{type:"primary"},on:{click:e.goTopoview}},[e._v(" "+e._s(e.$translateTitle("product.topoview"))+" ")]),a("el-button",{attrs:{type:"primary"},on:{click:e.exportpro}},[e._v(" "+e._s(e.$translateTitle("product.exportpro"))+" ")]),a("el-button",{attrs:{type:"primary"},on:{click:function(t){e.importDialogShow=!0}}},[e._v(" "+e._s(e.$translateTitle("product.importpro"))+" ")])],1)],1),a("div",{staticClass:"protable"},[a("el-table",{staticStyle:{width:"100%"},attrs:{data:e.proTableData}},[a("el-table-column",{attrs:{prop:"objectId",label:"ProductID"}}),a("el-table-column",{attrs:{label:e.$translateTitle("product.productname")},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(t.row.name))])]}}])}),a("el-table-column",{attrs:{label:e.$translateTitle("product.productgrouping")},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(t.row.devType))])]}}])}),a("el-table-column",{attrs:{label:e.$translateTitle("product.nodetype")},scopedSlots:e._u([{key:"default",fn:function(t){return[0==t.row.nodeType?a("span",[e._v(" "+e._s(e.$translateTitle("product.equipment"))+" ")]):a("span",[e._v(e._s(e.$translateTitle("product.gateway")))])]}}])}),a("el-table-column",{attrs:{label:e.$translateTitle("product.classification")},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(t.row.CategoryKey))])]}}])}),a("el-table-column",{attrs:{label:e.$translateTitle("product.addingtime")},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(e.utc2beijing(t.row.createdAt)))])]}}])}),a("el-table-column",{attrs:{label:e.$translateTitle("developer.operation"),width:"320"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-link",{attrs:{underline:!1,type:"primary",icon:"el-icon-view"},on:{click:function(a){return e.deviceToDetail(t.row)}}},[e._v(" 配置 ")]),a("el-popover",{ref:"popover-"+t.$index,attrs:{placement:"top",width:"300"}},[a("p",[e._v("确定删除这个"+e._s(t.row.name)+"产品吗？")]),a("div",{staticStyle:{margin:"0","text-align":"right"}},[a("el-button",{attrs:{size:"mini"},on:{click:function(e){t._self.$refs["popover-"+t.$index].doClose()}}},[e._v(" "+e._s(e.$translateTitle("developer.cancel"))+" ")]),a("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(a){return e.makeSure(t)}}},[e._v(" "+e._s(e.$translateTitle("developer.determine"))+" ")])],1),a("el-link",{attrs:{slot:"reference",underline:!1,icon:"el-icon-delete",type:"danger"},slot:"reference"},[e._v(" "+e._s(e.$translateTitle("developer.delete"))+" ")])],1),a("el-link",{attrs:{underline:!1,icon:"el-icon-attract",type:"primary"},on:{click:function(a){return e.GoTodevices(t.row)}}},[e._v(" "+e._s(e.$translateTitle("product.equipment"))+" ")]),a("el-link",{attrs:{underline:!1,icon:"el-icon-edit",type:"success"},on:{click:function(a){return e.editorProduct(t.row)}}},[e._v(" 编 辑 ")]),a("el-link",{attrs:{underline:!1,icon:"el-icon-s-promotion",type:"primary"},on:{click:function(a){return e.proudctView(t.row)}}},[e._v(" 运行组态 ")])]}}])})],1)],1),a("div",{staticClass:"elpagination",staticStyle:{"margin-top":"20px"}},[a("el-pagination",{attrs:{"page-sizes":[10,20,30,50],"page-size":e.length,total:e.total,layout:"total, sizes, prev, pager, next, jumper"},on:{"size-change":e.productSizeChange,"current-change":e.productCurrentChange}})],1)],1)])],1),a("div",{staticClass:"prodialog"},[a("el-dialog",{attrs:{title:e.$translateTitle("product.createproduct"),visible:e.dialogFormVisible,"close-on-click-modal":!1,"before-close":e.handleClose,width:"40%",top:"5vh"},on:{"update:visible":function(t){e.dialogFormVisible=t}}},[a("div",{staticClass:"content"},[a("div",{staticClass:"contentone"},[a("div",{staticStyle:{display:"flex"}},[a("span",[e._v(e._s(e.$translateTitle("product.productinformation")))]),a("p",{staticStyle:{"flex-grow":"2",width:"auto",height:"1px",margin:"10px","border-top":"1px dashed #dddddd"}})]),a("el-form",{ref:"ruleForm",attrs:{model:e.form,rules:e.rules}},[a("el-form-item",{attrs:{label:e.$translateTitle("product.productname"),prop:"name"}},[a("el-input",{attrs:{autocomplete:"off"},model:{value:e.form.name,callback:function(t){e.$set(e.form,"name",t)},expression:"form.name"}})],1),a("el-form-item",{attrs:{label:"产品分组",prop:"devType"}},[a("el-input",{attrs:{autocomplete:"off"},model:{value:e.form.devType,callback:function(t){e.$set(e.form,"devType",t)},expression:"form.devType"}})],1),a("el-form-item",{attrs:{label:e.$translateTitle("product.classification")}},[a("el-cascader",{attrs:{options:e.categoryListOptions},model:{value:e.form.category,callback:function(t){e.$set(e.form,"category",t)},expression:"form.category"}})],1),a("el-form-item",{attrs:{rules:[{required:!0,message:"请选择所属应用",trigger:"blur"}],label:"所属应用"}},[a("el-select",{attrs:{disabled:""},on:{change:e.selectApp},model:{value:e.form.relationApp,callback:function(t){e.$set(e.form,"relationApp",t)},expression:"form.relationApp"}},e._l(e.allApps,(function(e,t){return a("el-option",{key:t,attrs:{label:e.title,value:e.title}})})),1)],1)],1)],1),a("div",{staticClass:"contenttwo",staticStyle:{"margin-top":"20px"}},[a("div",{staticStyle:{display:"flex"}},[a("span",[e._v(e._s(e.$translateTitle("product.nodetype")))]),a("p",{staticStyle:{"flex-grow":"2",width:"auto",height:"1px",margin:"10px","border-top":"1px dashed #dddddd"}})]),a("el-form",{ref:"ruleForm",attrs:{model:e.form,rules:e.rules}},[a("el-form-item",{attrs:{label:e.$translateTitle("product.nodetype"),prop:"nodeType"}},[a("el-radio-group",{on:{change:e.changeNode},model:{value:e.form.nodeType,callback:function(t){e.$set(e.form,"nodeType",t)},expression:"form.nodeType"}},[a("el-radio",{attrs:{label:0}},[e._v(" "+e._s(e.$translateTitle("product.equipment"))+" ")]),a("el-radio",{attrs:{label:1}},[e._v(" "+e._s(e.$translateTitle("product.gateway"))+" ")])],1)],1)],1)],1),a("div",{staticClass:"contentthird",staticStyle:{"margin-top":"20px"}},[a("div",{staticStyle:{display:"flex"}},[a("span",[e._v(" "+e._s(e.$translateTitle("product.networkinganddescription"))+" ")]),a("p",{staticStyle:{"flex-grow":"2",width:"auto",height:"1px",margin:"10px","border-top":"1px dashed #dddddd"}})]),a("el-form",{ref:"ruleForm",attrs:{model:e.form,rules:e.rules}},[a("el-form-item",{attrs:{label:e.$translateTitle("product.networking")+"(共"+e.channel.length+"项)",prop:"netType"}},[a("el-select",{attrs:{placeholder:e.$translateTitle("product.selectgateway")},model:{value:e.form.netType,callback:function(t){e.$set(e.form,"netType",t)},expression:"form.netType"}},e._l(e.channel,(function(e,t){return a("el-option",{key:t,attrs:{label:t+1+":"+e.label,value:e.value,title:"当前第"+(t+1)+"项"}})})),1)],1),a("el-form-item",{attrs:{label:"产品模型"}},[e.imageUrl?a("img",{staticClass:"avatar",attrs:{src:e.imageUrl}}):a("i",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"el-icon-plus avatar-uploader-icon"}),a("form",{ref:"uploadform",staticStyle:{position:"absolute"},attrs:{method:"POST",enctype:"multipart/form-data"}},[a("input",{staticStyle:{position:"relative",top:"-100px","z-index":"5",width:"100px",height:"100px",cursor:"pointer",opacity:"0"},attrs:{type:"file"},on:{change:function(t){return e.upload(t)}}})]),e.imageUrl?a("el-button",{staticStyle:{"vertical-align":"text-bottom"},attrs:{type:"danger",size:"mini"},on:{click:e.deleteImgsrc}},[e._v(" 删除 ")]):e._e()],1),a("el-form-item",{attrs:{label:e.$translateTitle("developer.describe"),prop:"desc"}},[a("el-input",{attrs:{type:"textarea"},model:{value:e.form.desc,callback:function(t){e.$set(e.form,"desc",t)},expression:"form.desc"}})],1)],1)],1)]),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.submitForm("ruleForm")}}},[e._v(" "+e._s(e.$translateTitle("developer.determine"))+" ")]),a("el-button",{on:{click:function(t){e.dialogFormVisible=!1}}},[e._v(" "+e._s(e.$translateTitle("developer.cancel"))+" ")])],1)])],1),a("div",{staticClass:"import-dialog"},[a("el-dialog",{attrs:{visible:e.importDialogShow,title:"导入产品",width:"25%"},on:{"update:visible":function(t){e.importDialogShow=t}}},[a("el-form",{ref:"uploadProForm",attrs:{model:e.formPro}},[a("el-upload",{ref:"fileUpload",staticClass:"upload-demo",attrs:{action:e.uploadAction,data:e.uploadData,headers:e.uploadHeaders,"file-list":e.fileList,"on-change":e.handleChange,"with-credentials":!0,"auto-upload":!1,"on-success":e.handleUploadSuccess,"on-error":e.handleUploadError,accept:".xls, .xlsx, .zip"}},[a("el-button",{attrs:{slot:"trigger",size:"small",type:"primary"},slot:"trigger"},[e._v(" 选泽文件 ")])],1)],1),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{staticClass:"btn-left",attrs:{size:"small",type:"primary"},on:{click:e.submitUpload}},[e._v(" 上 传 ")]),a("el-button",{staticClass:"btn-right",attrs:{size:"small"},on:{click:function(t){e.importDialogShow=!1}}},[e._v(" 取 消 ")])],1)],1)],1)],1)},n=[],r=a("1da1"),o=(a("4de4"),a("b0c0"),a("1276"),a("ac1f"),a("c19f"),a("d3b7"),a("5cc6"),a("9a8c"),a("a975"),a("735e"),a("c1ac"),a("d139"),a("3a7b"),a("d5d6"),a("82f81"),a("e91f"),a("60bd"),a("5f96"),a("3280"),a("3fcc"),a("ca91"),a("25a1"),a("cd26"),a("3c5d"),a("2954"),a("649e"),a("219c"),a("170b"),a("b39a"),a("72f7"),a("5319"),a("d81d"),a("a9e3"),a("99af"),a("96cf"),a("e0e9")),l=a("58dd"),s=a("1285"),c=a("7212"),d=(a("5118"),a("30f8")),u=a("e455"),p=a("be65"),m=a.n(p),f=a("5da9"),h=(a("0b16"),a("f43e").Base64),v={data:function(){return{length:10,total:0,start:0,activeName:"first",formInline:{productname:""},uploadHeaders:{sessionToken:m.a.get("access_token")},uploadAction:"",uploadData:{},fileList:[],productIdentifier:"",proTableData:[],formLabelWidth:"80px",dialogFormVisible:!1,importDialogShow:!1,form:{name:"",category:[],nodeType:0,desc:"",netType:"",devType:"",productSecret:"",roles:[],relationApp:""},formPro:{name:"",url:""},rules:{roles:[{required:!0,message:"请选择所属应用",trigger:"blur"}],name:[{required:!0,message:"请输入产品",trigger:"blur"}],devType:[{required:!0,message:"请输入产品标识，用于区分不同设备",trigger:"blur"}],category:[{required:!0,message:"请选择所属分类",trigger:"change"}],nodeType:[{required:!0,message:"请选择节点类型",trigger:"change"}],netType:[{required:!0,message:"请选择联网方式",trigger:"change"}],relationApp:[{required:!0,message:"请选择产品可见角色",trigger:"change"}]},option:[],ruleoptions:[],channel:[{label:"蜂窝(2G/3G/4G)(直连)",value:"CELLULAR"},{label:"NB-IOT通道",value:"NB-IOT"},{label:"BLE(低功耗蓝牙)",value:"Bluetooth"},{label:"5G通道(直连)",value:"5G"},{label:"WIFI通道(直连)",value:"WIFI"},{label:"ZigBee通道",value:"ZigBee"},{label:"Modbus",value:"Modbus"},{label:"LoRa(WAN)(直连)",value:"LoRaWAN"},{label:"OPC UA",value:" OPC UA"},{label:"ZETA通道",value:"ZETA"},{label:"网线连接(直连)",value:"网线连接"},{label:"自定义",value:"OTHER"}],imageUrl:"",productid:"",loading:!1,allApps:[],categoryList:[],categoryListOptions:[],fileServer:"",access_token:"",projectid:"",projectName:"",allTableDate:[]}},computed:{},mounted:function(){this.Industry(),this.searchProduct(0)},beforeDestroy:function(){this.projectName=""},methods:{changeNode:function(e,t){0!=t&&(this.form.netType=""),this.channel=0==e?[{label:"蜂窝(2G/3G/4G)",value:"CELLULAR"},{label:"NB-IOT通道",value:"NB-IOT"},{label:"BLE(低功耗蓝牙)",value:"Bluetooth"},{label:"5G通道",value:"5G"},{label:"WIFI通道",value:"WIFI"},{label:"ZigBee通道",value:"ZigBee"},{label:"LoRa(WAN)",value:"LoRaWAN"},{label:"Modbus",value:"Modbus"},{label:"OPC UA",value:" OPC UA"},{label:"ZETA通道",value:"ZETA"},{label:"网线连接",value:"网线连接"},{label:"自定义",value:"OTHER"}]:[{label:"蜂窝(2G/3G/4G)",value:"CELLULAR"},{label:"5G通道",value:"5G"},{label:"WIFI通道",value:"WIFI"},{label:"NB-IOT通道",value:"NB-IOT"},{label:"LoRaWAN",value:"LoRaWAN"},{label:"网线连接",value:"网线连接"},{label:"自定义",value:"OTHER"}]},getRoles:function(){return Object(r["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,Object(l["app_count"])({where:{}});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})))()},selectApp:function(e){var t=this;e&&Object(f["getServer"])(e).then((function(e){e&&(t.fileServer=e.file,t.access_token=e.access_token)}))},treeData:function(e){var t=JSON.parse(JSON.stringify(e));return t.filter((function(e){var a=t.filter((function(t){return e.id==t.parentid}));return a.length>0&&(e.children=a),0==e.parentid}))},deleteImgsrc:function(){event.stopPropagation(),this.imageUrl=""},upload:function(e){if(this.loading=!0,e){var t=e.target.files[0],a=t.name,i=e.target.files[0].type,n=(t.type.split("/")[0],"image/jpeg"===i||"image/JPEG"===i||"image/png"===i||"image/PNG"===i||"image/bpm"===i||"image/BPM"===i);if(!n)return this.$message({message:"请上传图片",type:"error"}),!1;var r=new FileReader;r.readAsDataURL(t);var o=this;r.onloadend=function(){var e=r.result,t=o.dataURItoBlob(e);o.uploadFile(t,a)}}},dataURItoBlob:function(e){for(var t=atob(e.split(",")[1]),a=e.split(",")[0].split(":")[1].split(";")[0],i=new ArrayBuffer(t.length),n=new Uint8Array(i),r=0;r<t.length;r++)n[r]=t.charCodeAt(r);return new Blob([i],{type:a})},uploadFile:function(e,t){var a=this,i=new FormData;i.append("file",e,t),i.append("output","json"),i.append("path",this.form.relationApp),i.append("auth_token",this.access_token);this.$http.post(this.fileServer,i).then((function(e){e&&(a.imageUrl=e.body.url,a.loading=!1)})).catch((function(e){a.loading=!1,a.$message(e.bodyText)}))},submitUpload:function(){var e=this;this.uploadAction="/product",this.$nextTick((function(){e.uploadData.appid=m.a.get("appids"),e.$refs.fileUpload.submit()}))},handleUploadSuccess:function(e,t,a){this.$message({type:"success",message:"产品导入成功"}),this.importDialogShow=!1,this.$refs["uploadProForm"].resetFields(),this.searchProduct()},handleUploadError:function(e,t,a){this.$message({showClose:!0,message:e})},handleChange:function(e,t){t.length>0&&(this.fileList=[t[t.length-1]])},utc2beijing:function(e){var t=new Date(+new Date(e)+288e5).toISOString().replace(/T/g," ").replace(/\.[\d]{3}Z/,"");return t},getDict:function(e,t){var a=this;return Object(r["a"])(regeneratorRuntime.mark((function i(){var n,r;return regeneratorRuntime.wrap((function(i){while(1)switch(i.prev=i.next){case 0:return i.next=2,a.$query_object("Dict",{limit:1e3,where:{type:{$in:t}}});case 2:n=i.sent,r=n.results,a.allTableDate=r,e.map((function(e){r.map((function(t){e.category==t.type&&(e.CategoryKey=t.data.CategoryName)}))})),a.proTableData=e;case 7:case"end":return i.stop()}}),i)})))()},searchProduct:function(e){var t=this;return Object(r["a"])(regeneratorRuntime.mark((function a(){var i,n,r,o,l;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return 0==e&&(t.start=0),i=[],n={order:"-updatedAt",skip:t.start,limit:t.length,count:1,where:{devType:{$ne:"report"}}},""!=t.formInline.productname&&(n.where.name=t.formInline.productname),a.next=6,Object(c["queryProduct"])(n);case 6:r=a.sent,o=r.results,l=r.count,o.map((function(e,t){""!=e.category&&e.category&&i.push(e.category)})),t.getDict(o,i),t.total=l,t.getRoles().then((function(e){t.allApps=e.results})).catch((function(e){Object(d["returnLogin"])(e)}));case 13:case"end":return a.stop()}}),a)})))()},handleClose:function(){this.dialogFormVisible=!1},addproduct:function(){this.dialogFormVisible=!0},getParent:function(e,t,a){var i=this;return t.map((function(n){e==n.id?(a.unshift(n.value),i.getParent(n.parentid,t,a)):0==n.parentid&&n.id==e&&a.unshift(n.value)})),this.form.category=a,a},getIndustryParent:function(e,t){var a=this;t.map((function(i){i.value==e&&a.getParent(i.id,t,[])}))},editorProduct:function(e){for(var t in this.form.relationApp="",this.dialogFormVisible=!0,this.productid=e.objectId,this.getIndustryParent(e.category,this.categoryList),this.form.desc=e.desc,this.form.name=e.name,this.form.nodeType=e.nodeType,this.form.netType=e.netType,this.form.devType=e.devType,this.form.productSecret=e.productSecret,this.changeNode(e.nodeType,0),e.icon&&(this.imageUrl=e.icon),e.ACL)this.form.relationApp=t?t.substr(5):"";this.selectApp(this.form.relationApp)},Industry:function(){var e=this;return Object(r["a"])(regeneratorRuntime.mark((function t(){var a,i,n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.categoryList=[],a={limit:1e3,where:{"data.key":"category"}},t.next=4,Object(o["queryDict"])(a);case 4:i=t.sent,n=i.results,n.map((function(t){var a={};a.value=t.type,a.label=t.data.CategoryName,a.id=t.data.Id,a.parentid=t.data.SuperId,e.categoryList.push(a)})),e.categoryListOptions=e.treeData(e.categoryList);case 8:case"end":return t.stop()}}),t)})))()},addProduct:function(){this.$message("新增产品")},editProduct:function(e){var t=this;return Object(r["a"])(regeneratorRuntime.mark((function a(){var i,n;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return i={productSecret:t.form.productSecret,nodeType:t.form.nodeType,netType:t.form.netType,dynamicReg:!1,category:t.form.category[t.form.category.length-1],icon:t.imageUrl,name:t.form.name,devType:t.form.devType,desc:t.form.desc,topics:[]},a.next=3,Object(c["putProduct"])(e,i);case 3:n=a.sent,n&&(t.$message({type:"success",message:"编辑成功"}),t.dialogFormVisible=!1,t.$refs["ruleForm"].resetFields(),t.searchProduct(),t.productid="");case 5:case"end":return a.stop()}}),a)})))()},submitForm:function(e){var t=this;this.$Cookies.get("userId");this.$refs[e].validate((function(e){if(!e)return!1;var a=Math.ceil(25*Math.random());h.encode(String.fromCharCode(65+a)+Math.ceil(1e7*Math.random())+Number(new Date));""==t.productid?t.addProduct():t.editProduct(t.productid)}))},resetProductForm:function(){this.form={name:"",category:[],nodeType:0,desc:"",netType:"",devType:"",productSecret:"",roles:[],relationApp:""},this.imageUrl=""},deviceToDetail:function(e){this.$router.push({path:"/roles/detailproduct",query:{id:e.objectId}})},GoTodevices:function(e){this.$router.push({path:"/roles/thing",query:{productid:e.objectId}})},makeSure:function(e){var t=this,a={keys:"count(*)",skip:0,limit:1,where:{product:e.row.objectId}};Object(s["queryDevice"])(a).then((function(a){a.count>0?t.$message("请先删除该产品下设备"):Object(c["getProduct"])(e.row.objectId).then((function(a){Object(c["delProduct"])(e.row.objectId).then((function(a){a&&(t.$message({type:"success",message:"删除成功"}),e._self.$refs["popover-".concat(e.$index)].doClose(),t.searchProduct())})).catch((function(e){}))})).catch((function(e){}))})).catch((function(e){}))},productSizeChange:function(e){this.length=e,this.searchProduct()},productCurrentChange:function(e){this.start=(e-1)*this.length,this.searchProduct()},proudctView:function(e){var t=window.location.origin+"/spa",a="production";t="development"==a?this.$globalConfig.localTopoUrl:window.location.origin+"/spa";var i="".concat(t,"/#/views/").concat(e.objectId);window.open(i,"__blank")},goTopoview:function(){var e=window.location.origin+"/spa",t="production";e="development"==t?this.$globalConfig.localTopoUrl:window.location.origin+"/spa";var a="".concat(e,"/#/view");window.open(a,"__blank")},exportpro:function(){this.allTableDate?Object(u["export_txt_to_zip"])(JSON.stringify(this.allTableDate),"Dict","Dict"):this.$message({type:"warning",message:"数据为空,无法导出"})}}},g=v,b=(a("8a2b"),a("5d5b"),a("2877")),y=Object(b["a"])(g,i,n,!1,null,"10f6c6a4",null);t["default"]=y.exports},d7da:function(e,t,a){},da86:function(e,t,a){"use strict";a.r(t);var i,n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"resourcechannel"},[a("h3",[e._v("通道管理")]),a("el-tabs",{model:{value:e.activeName,callback:function(t){e.activeName=t},expression:"activeName"}},[a("el-tab-pane",{attrs:{label:"通道管理("+e.total+")",name:"first"}},[a("div",{staticClass:"firsttable"},[a("el-form",{staticClass:"demo-form-inline",attrs:{inline:!0,model:e.channelformsearch,size:"small"}},[a("el-form-item",[a("el-input",{attrs:{placeholder:e.$translateTitle("resource.name")},model:{value:e.channelformsearch.name,callback:function(t){e.$set(e.channelformsearch,"name",t)},expression:"channelformsearch.name"}})],1),a("el-form-item",[a("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.Get_Re_Channel(0)}}},[e._v(" "+e._s(e.$translateTitle("developer.search"))+" ")])],1),a("el-form-item",[a("el-button",{attrs:{type:"primary"},on:{click:e.addchanneltype}},[e._v(" "+e._s(e.$translateTitle("developer.selectchannel"))+" ")])],1)],1),a("el-table",{staticStyle:{width:"100%"},attrs:{data:e.tableData,"row-class-name":e.getChannelEnable}},[a("el-table-column",{attrs:{label:e.$translateTitle("developer.channelnumber")},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(t.row.objectId))])]}}])}),a("el-table-column",{attrs:{label:e.$translateTitle("developer.channelname")},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(t.row.name))])]}}])}),a("el-table-column",{attrs:{label:e.$translateTitle("developer.channeltype")},scopedSlots:e._u([{key:"default",fn:function(t){return[1==t.row.type?a("span",[e._v(" "+e._s(e.$translateTitle("developer.collectionchannel"))+" ")]):2==t.row.type?a("span",[e._v(" "+e._s(e.$translateTitle("developer.resourcechannel"))+" ")]):a("span",[e._v("任务通道")])]}}])}),a("el-table-column",{attrs:{label:e.$translateTitle("developer.servicetype")},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(t.row.cType))])]}}])}),a("el-table-column",{attrs:{label:e.$translateTitle("developer.channelstatus")},scopedSlots:e._u([{key:"default",fn:function(t){return["ONLINE"==t.row.status?a("span",{staticStyle:{color:"green"}},[e._v(" 在线 ")]):a("span",{staticStyle:{color:"red"}},[e._v("离线")])]}}])}),a("el-table-column",{attrs:{label:e.$translateTitle("developer.channeladdr"),width:"200"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s("channel/"+t.row.objectId))])]}}])}),a("el-table-column",{attrs:{label:e.$translateTitle("developer.describe")},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(t.row.desc))])]}}])}),a("el-table-column",{attrs:{label:e.$translateTitle("developer.operation"),width:"350"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{slot:"reference",type:"primary",size:"mini"},on:{click:function(a){return e.editorChannel(t.row)}},slot:"reference"},[e._v(" 编辑 ")]),0==t.row.isEnable?a("el-button",{attrs:{type:"success",size:"mini"},on:{click:function(a){return e.qyChannel(t.row,"enable")}}},[e._v(" "+e._s(e.$translateTitle("developer.enable"))+" ")]):a("el-button",{attrs:{type:"danger",size:"mini"},on:{click:function(a){return e.qyChannel(t.row,"disable")}}},[e._v(" "+e._s(e.$translateTitle("developer.prohibit"))+" ")]),a("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(a){return e.updateChannel(t.row)}}},[e._v(" 详情 ")]),a("el-popover",{ref:"popover-"+t.$index,attrs:{placement:"top",width:"300"}},[a("p",[e._v("确定删除这个"+e._s(t.row.name)+"通道吗？")]),a("div",{staticStyle:{margin:"0","text-align":"right"}},[a("el-button",{attrs:{size:"mini"},on:{click:function(e){t._self.$refs["popover-"+t.$index].doClose()}}},[e._v(" "+e._s(e.$translateTitle("developer.cancel"))+" ")]),a("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(a){return e.deleteChannel(t)}}},[e._v(" "+e._s(e.$translateTitle("developer.determine"))+" ")])],1),a("el-button",{attrs:{slot:"reference",type:"danger",size:"mini"},slot:"reference"},[e._v(" "+e._s(e.$translateTitle("developer.delete"))+" ")])],1),a("el-tooltip",{staticClass:"item",attrs:{disabled:"OFFLINE"!=t.row.status,effect:"dark",content:"请先启用通道",placement:"top"}},[a("el-button",{staticStyle:{position:"absolute",width:"100px",height:"10px",opacity:"0"},attrs:{type:"primary",size:"mini"},on:{click:function(a){return e.subProTopic(t.row)}}})],1),a("el-button",{attrs:{disabled:"OFFLINE"==t.row.status,type:"primary",size:"mini"},on:{click:function(a){return e.subProTopic(t.row)}}},[e._v(" 订阅日志 ")])]}}])})],1),a("div",{staticClass:"elpagination",staticStyle:{"margin-top":"20px"}},[a("el-pagination",{attrs:{"page-sizes":[10,20,30,50],"page-size":e.length,total:e.total,layout:"total, sizes, prev, pager, next, jumper"},on:{"size-change":e.channelSizeChange,"current-change":e.channelCurrentChange}})],1)],1)]),a("el-dialog",{attrs:{title:e.channelupdated+"通道",visible:e.channelForm,"close-on-click-modal":!1,"before-close":e.handleClose,width:"50%",top:"0"},on:{"update:visible":function(t){e.channelForm=t}}},[a("el-form",{ref:"addchannel",attrs:{model:e.addchannel,rules:e.addrules,"label-width":"120px"}},[a("el-form-item",{attrs:{label:"通道类型",prop:"region"}},[a("el-select",{attrs:{disabled:"",placeholder:"通道类型"},on:{change:e.removeauto},model:{value:e.addchannel.region,callback:function(t){e.$set(e.addchannel,"region",t)},expression:"addchannel.region"}},e._l(e.channelregion,(function(e,t){return a("el-option",{key:t,attrs:{label:e.title.zh,value:e.cType}})})),1),a("el-row",{staticStyle:{width:"100%",height:"500px","overflow-x":"hidden","overflow-y":"scroll","line-height":"30px","text-align":"center"},attrs:{gutter:24}},e._l(e.channelregion,(function(t,i){return a("el-col",{key:i,staticStyle:{margin:"20px 0",cursor:"pointer"},attrs:{span:8}},[a("el-card",{staticClass:"box-card",style:{color:e.addchannel.region==t.cType?"#00bad0":"#c0c4cc"},attrs:{shadow:e.addchannel.region==t.cType?"always":"hover",size:"mini"}},[a("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[a("span",[e._v(e._s(t.title.zh))]),a("el-button",{staticStyle:{float:"right"},attrs:{disabled:""!=e.resourceid,type:e.addchannel.region==t.cType?"success":"primary",size:"mini"},on:{click:function(a){return e.setCard(t.cType)}}},[e._v(" "+e._s(e.addchannel.region==t.cType?"已选择":"选择")+" ")])],1),a("div",{staticClass:"text item"},[a("el-row",{attrs:{gutter:24}},[a("el-col",{attrs:{span:12}},[a("img",{staticClass:"image",staticStyle:{width:"50px",height:"50px"},attrs:{src:"https://imgs.iotku.com/2020/2/21/23efecea9bfdbbf8a132089e251fc6e7.png"}})]),a("el-col",{attrs:{span:12}},[a("el-tag",[e._v(e._s(t.cType))])],1)],1)],1)])],1)})),1)],1),a("el-form-item",{attrs:{label:e.$translateTitle("developer.channelname"),prop:"name"}},[a("el-input",{attrs:{placeholder:e.$translateTitle("developer.channelname"),autocomplete:"off"},model:{value:e.addchannel.name,callback:function(t){e.$set(e.addchannel,"name",t)},expression:"addchannel.name"}})],1),a("el-form-item",{attrs:{rules:[{required:!0,message:"请选择所属应用",trigger:"blur"}],label:"所属应用"}},[a("el-input",{attrs:{placeholder:"请选择所属应用"},model:{value:e.addchannel.applicationtText,callback:function(t){e.$set(e.addchannel,"applicationtText",t)},expression:"addchannel.applicationtText"}},[a("template",{slot:"append"},[a("i",{class:[e.showTree?"el-icon-arrow-up":"el-icon-arrow-down"],staticStyle:{cursor:"pointer"},on:{click:function(t){e.showTree=!e.showTree}}})])],2),e.showTree?a("div",[a("el-tree",{attrs:{data:e.allApps,props:e.defaultProps},on:{"node-click":e.handleNodeClick}})],1):e._e()],1),e._l(e.arrlist,(function(t,i){return a("el-col",{key:i,attrs:{span:12}},[a("el-form-item",{attrs:{label:t.title.zh,required:t.required,prop:t.showname}},["string"==t.type?a("el-input",{model:{value:e.addchannel[t.showname],callback:function(a){e.$set(e.addchannel,t.showname,a)},expression:"addchannel[item.showname]"}}):"integer"==t.type?a("el-input",{model:{value:e.addchannel[t.showname],callback:function(a){e.$set(e.addchannel,t.showname,e._n(a))},expression:"addchannel[item.showname]"}}):"boolean"==t.type?a("el-select",{staticClass:"notauto",attrs:{readonly:""},model:{value:e.addchannel[t.showname],callback:function(a){e.$set(e.addchannel,t.showname,a)},expression:"addchannel[item.showname]"}},[a("el-option",{attrs:{value:!0,label:"是"}}),a("el-option",{attrs:{value:!1,label:"否"}})],1):e._e()],1)],1)})),a("el-form-item",{attrs:{label:e.$translateTitle("developer.describe")}},[a("el-input",{attrs:{rows:3,placeholder:e.$translateTitle("developer.describe"),autocomplete:"off",type:"textarea"},on:{change:e.inputChange},model:{value:e.addchannel.desc,callback:function(t){e.$set(e.addchannel,"desc",t)},expression:"addchannel.desc"}})],1)],2),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:e.handleClose}},[e._v(" "+e._s(e.$translateTitle("developer.cancel"))+" ")]),a("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.addchannelForm("addchannel")}}},[e._v(" "+e._s(e.$translateTitle("developer.determine"))+" ")])],1)],1),a("el-dialog",{attrs:{visible:e.dialogVisible,title:"通道详情",width:"50%"},on:{"update:visible":function(t){e.dialogVisible=t}}},[a("div",[a("el-row",[a("el-col",{attrs:{span:12}},[e._v("ID:")]),a("el-col",{attrs:{span:12}},[e._v(e._s(e.resourceid))])],1),a("el-row",[a("el-col",{attrs:{span:12}},[e._v("Resource Type:")]),a("el-col",{attrs:{span:12}},[e._v(e._s(e.resoucetype))])],1),a("el-row",[a("el-col",{attrs:{span:12}},[e._v("Description:")]),a("el-col",{attrs:{span:12}},[e._v(e._s(e.description))])],1),e._l(e.detailchannel,(function(t,i){return a("el-row",{key:t},[a("el-col",{attrs:{span:12}},[e._v(e._s(i))]),a("el-col",{attrs:{span:12}},[e._v(e._s(t))])],1)}))],2),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{type:"primary"},on:{click:function(t){e.dialogVisible=!1}}},[e._v(" 确 定 ")])],1)]),a("el-dialog",{attrs:{title:e.channelname+"日志",visible:e.subdialog,"before-close":e.handleCloseSubdialog,width:"85%"},on:{"update:visible":function(t){e.subdialog=t}}},[a("div",{staticStyle:{"margin-top":"20px"}},[a("pre",{staticClass:"ace_editor",staticStyle:{width:"100%","min-height":"300px"},attrs:{id:"subdialog"}},[e._v("                    "),a("textarea",{staticClass:"ace_text-input",staticStyle:{overflow:"scroll"}}),e._v("        ")])]),a("span",{staticClass:"dialog-footer",staticStyle:{height:"30px"},attrs:{slot:"footer"},slot:"footer"},[a("el-switch",{staticStyle:{display:"inline-block","margin-right":"10px"},attrs:{"active-color":"#13ce66","inactive-color":"#ff4949","inactive-text":"自动刷新"},on:{change:e.stopsub},model:{value:e.value4,callback:function(t){e.value4=t},expression:"value4"}})],1)])],1)],1)},r=[],o=a("1da1"),l=(a("96cf"),a("b0c0"),a("d81d"),a("a4d3"),a("e01a"),a("4d63"),a("ac1f"),a("25f0"),a("89e8")),s=a("bb22"),c=a("5da9"),d=a("1b07"),u=a("30f8"),p=a("bc35"),m=a("c620"),f={inject:["reload"],data:function(){return{dialogVisible:!1,isopen:"suo",pwdType:"password",tableData:[],channelForm:!1,channelupdated:"新增",activeName:"first",channelId:"",channelformsearch:{name:""},channelregion:[],addchannel:{region:"",desc:"",applicationtText:""},applicationList:[],addrules:{roles:[{required:!0,message:"请选择所属应用",trigger:"blur"}],name:[{required:!0,message:"请输入通道名称",trigger:"blur"}],region:[{required:!0,message:"请选择服务类型",trigger:"change"}]},length:10,start:0,total:0,selectregion:{},resourceid:"",resoucetype:"",description:"",detailchannel:"",subdialog:!1,value4:"",subdialogid:"",subdialogtimer:null,channelname:"",arrlist:[],channelrow:[],showTree:!1,allApps:[],defaultProps:{children:"children",label:"label"}}},mounted:function(){this.Get_Re_Channel(0),this.dialogType(),this.getApplication()},methods:{setCard:function(e){this.removeauto(e)},inputChange:function(e){},validUrl:function(e,t,a){var i=/^[A-Za-z0-9]+\.[A-Za-z0-9]+[\/=\?%\-&_~`@[\]\':+!]*([^<>\"\"])*$/;i.test(t)?a():a(new Error("需要输入正确的url"))},validPort:function(e,t,a){var i=/^([0-9]|[1-9]\d|[1-9]\d{2}|[1-9]\d{3}|[1-5]\d{4}|6[0-4]\d{3}|65[0-4]\d{2}|655[0-2]\d|6553[0-5])$/;i.test(t)?a():a(new Error("需要输入正确的端口号"))},Get_Re_Channel:function(e){var t=this;0==e&&(this.start=0);var a={keys:"count(*)",order:"-createdAt",limit:this.length,skip:this.start,where:{}};""!=this.channelformsearch.name&&(a.where.name=this.channelformsearch.name),this.$query_object("Channel",a).then((function(e){e&&(t.total=e.count,t.tableData=e.results)})).catch((function(e){"209"==e.code?(t.$message({type:"warning",message:"登陆权限过期，请重新登录"}),t.$router.push({path:"/login"})):119==e.code&&t.$message({type:"error",message:"没有操作权限"})}))},getApplication:function(){var e=this;return Object(o["a"])(regeneratorRuntime.mark((function t(){var a,i,n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return a={limit:100},t.next=3,Object(c["queryRole"])(a);case 3:i=t.sent,n=i.results,n.map((function(t){var a={};a.id=t.id,a.name=t.desc,e.applicationList.push(a)}));case 6:case"end":return t.stop()}}),t)})))()},handleNodeClick:function(e){this.showTree=!this.showTree,this.addchannel.applicationtText=e.name},dialogType:function(){var e=this;return Object(o["a"])(regeneratorRuntime.mark((function t(){var a,i,n,r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,Object(p["Roletree"])();case 2:return a=t.sent,i=a.results,n=void 0===i?[]:i,e.allApps=n,t.next=8,Object(d["resourceTypes"])();case 8:r=t.sent,e.channelregion=r;case 10:case"end":return t.stop()}}),t)})))()},qyChannel:function(e,t){var a=this;Object(s["subupadte"])(e.objectId,t).then((function(e){e&&a.$message({type:"success",message:"".concat("enable"==t?"启用成功":"禁用成功")}),a.Get_Re_Channel(0)})).catch((function(e){a.$message(e.error)}))},updateChannel:function(e){this.dialogVisible=!0,this.resourceid=e.objectId,this.detailchannel=e.config,this.resoucetype=e.cType,this.description=e.desc},addchannelForm:function(e){var t=this;this.$refs[e].validate((function(e){if(e){var a={};for(var i in t.addchannel)a[i]=t.addchannel[i];delete a.region,delete a.desc,delete a.type,delete a.isEnable,delete a.name;var n="role:"+t.addchannel.applicationtText,r={};r[n]={read:!0,write:!0};var o={ACL:r,config:a,name:t.addchannel.name,cType:t.addchannel.region,desc:t.addchannel.desc};t.addchannelaxios(o)}}),(function(e){Object(u["returnLogin"])(e)}))},addchannelaxios:function(e){var t=this;return Object(o["a"])(regeneratorRuntime.mark((function a(){return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return a.next=2,Object(l["postChannel"])(e).then((function(e){e&&(t.$message({type:"success",message:"编辑"==t.channelupdated?"编辑成功":"创建成功"}),t.$refs["addchannel"].resetFields(),t.addchannel={},t.channelForm=!1,t.resourceid="",t.Get_Re_Channel(0))}));case 2:case"end":return a.stop()}}),a)})))()},deleteChannel:function(e){var t=this;Object(l["delChannel"])(e.row.objectId).then((function(a){t.$message({type:"success",message:"删除成功"}),e._self.$refs["popover-".concat(e.$index)].doClose(),t.Get_Re_Channel(0)})).catch((function(e){}))},addchanneltype:function(){this.channelForm=!0,this.channelupdated="新增"},handleClose:function(){this.addchannel={},this.channelForm=!1,this.$refs["addchannel"].resetFields(),this.resourceid=""},getChannelEnable:function(e,t){return 1==e.row.isEnable?"green_active":"red_active"},channelSizeChange:function(e){this.length=e,this.Get_Re_Channel()},channelCurrentChange:function(e){this.start=(e-1)*this.length,this.Get_Re_Channel()},arrSort:function(e,t){var a=e.order,i=t.order;return a<i?-1:a>i?1:0},orderObject:function(e){var t=[];for(var a in e)e[a].showname=a,t.push(e[a]);return t.sort(this.arrSort)},removeauto:function(e){var t=this,a={},i={name:[{required:!0,message:"请输入通道名称",trigger:"blur"}],region:[{required:!0,message:"请选择服务类型",trigger:"change"}]};if(""==this.resourceid?this.channelregion.map((function(n){n.cType==e&&(t.selectregion=n,t.arrlist=t.orderObject(t.selectregion.params),t.arrlist.map((function(e){e.default?a[e.showname]=e.default:a[e.showname]="",e.required&&("string"==e.type||"integer"==e.type?i[e.showname]=[{required:!0,trigger:"blur"}]:i[e.showname]=[{required:!0,trigger:"change"}])})),a.region=e,a.desc="",a.name="",a.type=t.selectregion.type,a.isEnable=!1)})):this.channelregion.map((function(n){n.cType==e&&(t.selectregion=n,t.arrlist=t.orderObject(t.selectregion.params),t.arrlist.map((function(n){for(var r in t.channelrow.config)n.showname==r&&(a[n.showname]=t.channelrow.config[r]),n.required&&("string"==n.type||"integer"==n.type?i[n.showname]=[{required:!0,trigger:"blur"}]:i[n.showname]=[{required:!0,trigger:"change"}]),a.region=e,a.desc=t.channelrow.desc,a.name=t.channelrow.name,a.type=t.selectregion.type,a.isEnable=t.channelrow.isEnable})))})),this.channelrow.length>0)for(var n in this.channelrow.ACL.permissionsById)a.applicationtText=n?n.substr(5):"";this.addchannel=a,this.addchannel.region=e,this.addrules=i},editorChannel:function(e){this.channelrow=e,this.resourceid=e.objectId,this.channelForm=!0,this.channelupdated="编辑",this.removeauto(e.cType)},nowtime:function(){var e=Date.parse(new Date),t=new Date(e),a=(t.getFullYear(),t.getMonth()+1<=10?t.getMonth():t.getMonth(),t.getDate()+1<=10?t.getDate():t.getDate(),(t.getHours()+1<=10?"0"+t.getHours():t.getHours())+":"),i=(t.getMinutes()+1<=10?"0"+t.getMinutes():t.getMinutes())+":",n=t.getSeconds()+1<=10?"0"+t.getSeconds():t.getSeconds();return a+i+n+" "},subProTopic:function(e){this.subdialog=!0,this.subdialogid=e.objectId,this.channelname=e.objectId,setTimeout((function(){i=ace.edit("subdialog"),i.session.setMode("ace/mode/text"),i.setTheme("ace/theme/gob"),i.setReadOnly(!0),i.setOptions({enableBasicAutocompletion:!1,enableSnippets:!0,enableLiveAutocompletion:!0})}));var t={topic:"log/channel/"+e.objectId,qos:2},a=new RegExp("log/channel/"+e.objectId),n="",r=this;m["Websocket"].add_hook(a,(function(e){i.session.getLength()>=1e3?n="":n+=r.nowtime()+e+"\n",i.setValue(n),i.gotoLine(i.session.getLength())}));var o=JSON.stringify({action:"start_logger"});m["Websocket"].subscribe(t,(function(t){if(t.result){var a={topic:"channel/"+e.objectId,text:o,retained:!0,qos:2};m["Websocket"].sendMessage(a),r.subdialogtimer=window.setInterval((function(){m["Websocket"].sendMessage(a)}),6e5)}}))},stopsub:function(e){var t;t=0==e?JSON.stringify({action:"stop_logger"}):JSON.stringify({action:"start_logger"});var a={topic:"channel/"+this.subdialogid,text:t,retained:!0,qos:2};m["Websocket"].sendMessage(a)},handleCloseSubdialog:function(){var e=JSON.stringify({action:"stop_logger"}),t={topic:"channel/"+this.subdialogid,text:e,retained:!0,qos:2};m["Websocket"].sendMessage(t),this.subdialog=!1,window.clearInterval(this.subdialogtimer),this.subdialogtimer=null}}},h=f,v=(a("8446"),a("2877")),g=Object(v["a"])(h,n,r,!1,null,"c6b356f0",null);t["default"]=g.exports},dc8a:function(e,t,a){"use strict";a.r(t);var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"application"},[a("div",{staticClass:"addApplication"}),a("div",{staticClass:"appcontent",staticStyle:{position:"relative",display:"flex","flex-direction":"column","align-items":"center"}},[e._l(e.appdata,(function(t,i){return a("el-card",{key:i,staticClass:"box-card",staticStyle:{width:"80%","margin-bottom":"10px",border:"1px solid #cccccc"}},[a("el-row",{attrs:{gutter:24}},[a("el-col",{attrs:{span:4}},[a("div",{staticClass:"grid-content bg-purple"},[a("i",{staticClass:"iconfont icon-yingyong",staticStyle:{color:"#666666"}}),a("p",[e._v(e._s(t.name))])])]),a("el-col",{attrs:{span:16}},[a("div",{staticClass:"grid-content bg-purple"},[a("dl",[a("dt",[e._v(" App ID "),a("el-tooltip",{attrs:{content:"在SDK调用过程中唯一的一个应用标识",placement:"bottom"}},[a("i",{staticClass:"el-icon-question"})])],1),a("dd",[e._v(e._s(t.objectId))]),a("dt",[e._v(" App Secret "),a("el-tooltip",{attrs:{content:"调用API时的Token,用来验证请求合法性,请注意保密",placement:"bottom"}},[a("i",{staticClass:"el-icon-question"})])],1),t.isshow?a("dd",[e._v(e._s(t.tag.appconfig.secret))]):e._e(),t.isshow?e._e():a("dd",[t.tag.appconfig.secret?a("i",[e._v(" "+e._s(t.tag.appconfig.secret.substr(0,4)+"********************"+t.tag.appconfig.secret.substr(24))+" "),a("el-button",{staticStyle:{position:"absolute",top:"30px","margin-left":"10px"},attrs:{size:"samll",round:""},on:{click:function(a){return e.xianshi(t.objectId)}}},[e._v(" 完整密钥 ")])],1):e._e()]),a("dt",[e._v("应用名称")]),t.name?a("dd",[e._v(e._s(t.name))]):a("dd",[e._v("-")])])])]),a("el-col",{attrs:{span:4}},[a("div",{staticClass:"grid-content bg-purple"},[a("p",{staticClass:"editor"},[a("strong",[e._v("操作:")])]),a("p",{staticClass:"editor"},[a("el-link",{attrs:{type:"primary"},on:{click:function(a){return e.updateapp(t)}}},[e._v(" 修改应用 ")])],1),a("p",{staticClass:"editor"},[a("el-link",{attrs:{type:"primary"},on:{click:function(a){return e.nodeDeployment(t)}}},[e._v(" 节点部署 ")])],1),a("p",{staticClass:"editor"},[a("el-link",{attrs:{type:"primary"},on:{click:function(a){return e.applicationDeployment(t)}}},[e._v(" 应用部署 ")])],1)])])],1)],1)})),a("el-pagination",{attrs:{"page-sizes":[1,5,10],"page-size":e.pagesize,total:e.total,layout:"total, sizes, prev, pager, next, jumper"},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}})],2),a("el-dialog",{attrs:{visible:e.dialogVisible,"close-on-click-modal":!1,title:"添加应用",width:"55%"},on:{"update:visible":function(t){e.dialogVisible=t}}},[a("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"block",attrs:{"element-loading-text":"正在等待返回","element-loading-spinner":"el-icon-loading","element-loading-background":"rgba(0, 0, 0, 0.8)"}},[a("el-form",{ref:"form",attrs:{rules:e.Rule,model:e.form,"label-width":"120px"}},[a("el-form-item",{attrs:{label:"应用名称",prop:"desc"}},[a("el-input",{staticStyle:{width:"80%"},attrs:{placheholder:"请输入应用名称"},model:{value:e.form.desc,callback:function(t){e.$set(e.form,"desc",t)},expression:"form.desc"}})],1),a("el-form-item",{attrs:{label:"Token有效时间"}},[a("el-input",{staticStyle:{width:"80%"},attrs:{type:"number",placheholder:"请输入应用时间"},model:{value:e.form.time,callback:function(t){e.$set(e.form,"time",t)},expression:"form.time"}}),a("span",{staticStyle:{"margin-left":"5px"}},[e._v("秒")])],1),a("el-form-item",{attrs:{label:"word预览服务器"}},[a("el-input",{staticStyle:{width:"80%"},attrs:{placheholder:"请输入word预览服务器地址"},model:{value:e.form.wordpreview,callback:function(t){e.$set(e.form,"wordpreview",t)},expression:"form.wordpreview"}})],1),a("el-form-item",{attrs:{label:"word生产服务器"}},[a("el-input",{staticStyle:{width:"80%"},attrs:{placheholder:"请输入word生产服务器地址"},model:{value:e.form.wordproduct,callback:function(t){e.$set(e.form,"wordproduct",t)},expression:"form.wordproduct"}})],1),a("el-form-item",{attrs:{label:"文件资源",prop:"file"}},[a("el-input",{staticStyle:{width:"80%"},attrs:{placheholder:"请输入url"},model:{value:e.form.file,callback:function(t){e.$set(e.form,"file",t)},expression:"form.file"}})],1),a("el-form-item",{attrs:{label:"组态资源",prop:"topo"}},[a("el-input",{staticStyle:{width:"80%"},attrs:{placheholder:"请输入url"},model:{value:e.form.topo,callback:function(t){e.$set(e.form,"topo",t)},expression:"form.topo"}})],1),a("el-form-item",{attrs:{label:"Graphql API",prop:"graphql"}},[a("el-input",{staticStyle:{width:"80%"},attrs:{placheholder:"请输入url"},model:{value:e.form.graphql,callback:function(t){e.$set(e.form,"graphql",t)},expression:"form.graphql"}})],1),a("el-form-item",{attrs:{label:"Restful API",prop:"rest"}},[a("el-input",{staticStyle:{width:"80%"},attrs:{placheholder:"请输入url"},model:{value:e.form.rest,callback:function(t){e.$set(e.form,"rest",t)},expression:"form.rest"}})],1),a("el-form-item",{attrs:{label:"home"}},[a("el-input",{staticStyle:{width:"80%"},attrs:{placheholder:"请输入路径"},model:{value:e.form.home,callback:function(t){e.$set(e.form,"home",t)},expression:"form.home"}})],1)],1)],1),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){e.dialogVisible=!1}}},[e._v("取 消")]),a("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.Define("form")}}},[e._v("确 定")])],1)]),a("el-dialog",{attrs:{visible:e.update,"close-on-click-modal":!1,title:"修改应用信息",width:"55%"},on:{"update:visible":function(t){e.update=t}}},[a("div",{staticClass:"block"},[a("el-form",{ref:"form1",attrs:{rules:e.Rule,model:e.form1,"label-width":"120px"}},[a("el-form-item",{attrs:{label:"访问密钥"}},[a("el-input",{staticStyle:{width:"80%"},attrs:{readonly:""},model:{value:e.form1.secret,callback:function(t){e.$set(e.form1,"secret",t)},expression:"form1.secret"}},[a("el-button",{attrs:{slot:"append",icon:"el-icon-refresh-right"},on:{click:e.handleClickRefresh},slot:"append"})],1)],1),a("el-form-item",{attrs:{label:"Token有效时间"}},[a("el-input",{staticStyle:{width:"80%"},attrs:{type:"number",placheholder:"请输入应用时间"},model:{value:e.form1.time,callback:function(t){e.$set(e.form1,"time",t)},expression:"form1.time"}}),a("span",{staticStyle:{"margin-left":"5px"}},[e._v("秒")])],1),a("el-form-item",{attrs:{label:"word预览服务器"}},[a("el-input",{staticStyle:{width:"80%"},attrs:{placheholder:"请输入word预览服务器地址"},model:{value:e.form1.wordpreview,callback:function(t){e.$set(e.form1,"wordpreview",t)},expression:"form1.wordpreview"}})],1),a("el-form-item",{attrs:{label:"word生产服务器"}},[a("el-input",{staticStyle:{width:"80%"},attrs:{placheholder:"请输入word生产服务器地址"},model:{value:e.form1.wordproduct,callback:function(t){e.$set(e.form1,"wordproduct",t)},expression:"form1.wordproduct"}})],1),a("el-form-item",{attrs:{label:"文件资源",prop:"file"}},[a("el-input",{staticStyle:{width:"80%"},attrs:{placheholder:"请输入url"},model:{value:e.form1.file,callback:function(t){e.$set(e.form1,"file",t)},expression:"form1.file"}})],1),a("el-form-item",{attrs:{label:"组态资源",prop:"topo"}},[a("el-input",{staticStyle:{width:"80%"},attrs:{placheholder:"请输入url"},model:{value:e.form1.topo,callback:function(t){e.$set(e.form1,"topo",t)},expression:"form1.topo"}})],1),a("el-form-item",{attrs:{label:"Graphql API",prop:"graphql"}},[a("el-input",{staticStyle:{width:"80%"},attrs:{placheholder:"请输入url"},model:{value:e.form1.graphql,callback:function(t){e.$set(e.form1,"graphql",t)},expression:"form1.graphql"}})],1),a("el-form-item",{attrs:{label:"Restful API",prop:"rest"}},[a("el-input",{staticStyle:{width:"80%"},attrs:{placheholder:"请输入url"},model:{value:e.form1.rest,callback:function(t){e.$set(e.form1,"rest",t)},expression:"form1.rest"}})],1),a("el-form-item",{attrs:{label:"home"}},[a("el-input",{staticStyle:{width:"80%"},attrs:{placheholder:"请输入路径"},model:{value:e.form1.home,callback:function(t){e.$set(e.form1,"home",t)},expression:"form1.home"}})],1)],1)],1),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){e.update=!1}}},[e._v("取 消")]),a("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.updatedDefine("form1")}}},[e._v(" 确 定 ")])],1)])],1)},n=[],r=a("1da1"),o=(a("96cf"),a("a9e3"),a("d81d"),a("b0c0"),a("5da9")),l=a("f43e").Base64,s={data:function(){var e=function(e,t,a){var i=/^(((ht|f)tps?):\/\/)?[\w-]+(\.[\w-]+)+([\w.,@?^=%&:/~+#-]*[\w@?^=%&/~+#-])?$/;""===t||null===t?a(new Error("请输入url地址")):i.test(t)?a():a(new Error("请输入正确的url地址"))};return{total:0,pagesize:10,start:0,update:!1,form1:{name:"",product:"",time:"",file:"",graphql:"",rest:"",topo:"",secret:"",desc:"",home:"",wordpreview:"http://pump.iotn2n.com:8012",wordproduct:"http://pump.iotn2n.com"},dialogVisible:!1,form:{name:"",product:"",time:"18000",file:"http://file.iotn2n.com/shapes/upload",graphql:"http://cad.iotn2n.com:5080/graphql",rest:"http://cad.iotn2n.com:5080/iotapi",topo:"http://shapes.iotn2n.com/",secret:"",home:"D:/shuwa/shuwa_data_center",wordpreview:"http://pump.iotn2n.com:8012",wordproduct:"http://pump.iotn2n.com/"},Rule:{desc:[{required:!0,message:"请输入应用名称",trigger:"blur"},{validator:function(e,t,a){0===t.length?a(new Error("应用名称不能为空")):a()}}],file:[{trigger:"blur",validator:e}],topo:[{trigger:"blur",validator:e}],graphql:[{trigger:"blur",validator:e}],rest:[{trigger:"blur",validator:e}]},appdata:[],objectid:"",selectapp:[],arr:[],loading:!1}},created:function(){},mounted:function(){this.getAppdetail(this.pagesize,this.start),this.$route.query&&this.$route.query.projectName&&(this.dialogVisible=!0,this.form.desc=this.$route.query.projectName)},methods:{Define:function(e){var t=this;this.$refs[e].validate((function(e){if(!e)return!1;t.submit()}))},submit:function(){this.loading=!0;var e=Math.ceil(25*Math.random());l.encode(String.fromCharCode(65+e)+Math.ceil(1e7*Math.random())+Number(new Date)),this.form.file,this.form.graphql,this.form.rest,this.form.topo,this.form.home},getAppdetail:function(e,t){var a=this;return Object(r["a"])(regeneratorRuntime.mark((function i(){var n;return regeneratorRuntime.wrap((function(i){while(1)switch(i.prev=i.next){case 0:n={skip:t,limit:e,keys:"tag,name,desc,count(*)",order:"updatedAt"},Object(o["queryRole"])(n).then((function(e){a.appdata=e.results,a.appdata.map((function(e){e.tag.appconfig.secret&&(e.isshow=!1)})),a.total=e.count})).catch((function(e){}));case 2:case"end":return i.stop()}}),i)})))()},handleClickRefresh:function(){this.randomSecret()},randomSecret:function(){var e=Math.ceil(25*Math.random());this.form1.secret=l.encode(String.fromCharCode(65+e)+Math.ceil(1e7*Math.random())+Number(new Date))},handleSizeChange:function(e){this.pagesize=e,this.getAppdetail(this.pagesize,this.start)},handleCurrentChange:function(e){this.start=Number(e-1)*Number(this.pagesize),this.getAppdetail(this.pagesize,this.start)},updateapp:function(e){this.update=!0,this.form1.objectId=e.objectId,this.form1.time=e.tag.appconfig.expires,this.form1.file=e.tag.appconfig.file,this.form1.rest=e.tag.appconfig.rest,this.form1.topo=e.tag.appconfig.topo,this.form1.graphql=e.tag.appconfig.graphql,this.form1.home=e.tag.appconfig.home,this.form1.secret=e.tag.appconfig.secret,this.form1.desc=e.tag.appconfig.desc},updatedDefine:function(e){var t=this;this.$refs[e].validate((function(e){if(!e)return!1;t.updateObj(t.form1.objectId)}))},updateObj:function(e){var t=this;return Object(r["a"])(regeneratorRuntime.mark((function a(){var i,n;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return i={expires:t.form1.time,file:t.form1.file,graphql:t.form1.graphql,rest:t.form1.rest,topo:t.form1.topo,home:t.form1.home,secret:t.form1.secret,wordpreview:t.form1.home,wordproduct:t.form1.secret},n={appconfig:{}},n.appconfig=i,a.next=5,Object(o["putRole"])(e,n).then((function(e){t.$message({type:"success",message:"应用修改成功"}),t.getAppdetail(10,0),t.update=!1})).catch((function(e){t.$message({type:"error",message:"应用修改失败"+e.error})}));case 5:case"end":return a.stop()}}),a)})))()},nodeDeployment:function(e){this.$router.push({path:"/roles/server_control",query:{appid:e.objectId,appsecret:e.tag.appconfig.secret}})},applicationDeployment:function(e){this.$router.push({path:"/applicationManagement/addApp",query:{actionType:"add",title:"新增应用",appObjectId:e.objectId,desc:e.desc,name:e.name}})},xianshi:function(e){for(var t,a=0;a<this.appdata.length;a++)this.appdata[a].objectId==e&&(t=this.appdata[a],this.appdata[a].isshow=!0,this.$set(this.appdata,a,t))}}},c=s,d=(a("6727"),a("05cc"),a("2877")),u=Object(d["a"])(c,i,n,!1,null,"dba3154c",null);t["default"]=u.exports},e36f:function(e,t,a){},e815:function(e,t,a){},e94a:function(e,t,a){},eaf2:function(e,t,a){},f0db:function(e,t,a){"use strict";a.r(t);var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"gateway"},[a("el-card",{staticClass:"wayheader",attrs:{shadow:"always"}},[a("div",{staticClass:"wayheaderone"},[a("span",{staticClass:"oneheader"},[e._v("网络设备")]),a("span",{staticClass:"twoheader"},[e._v("网络层级:"+e._s(e.cengji))]),a("span",{staticClass:"threeheader"})])])],1)},n=[],r={data:function(){return{cengji:2}},mounted:function(){},methods:{}},o=r,l=(a("6a57"),a("2877")),s=Object(l["a"])(o,i,n,!1,null,"00d52856",null);t["default"]=s.exports},f16d:function(e,t,a){},f7ea:function(e,t,a){"use strict";a.r(t);var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{attrs:{id:"application"}},[a("el-tabs",{model:{value:e.activeName,callback:function(t){e.activeName=t},expression:"activeName"}},[a("el-tab-pane",{attrs:{label:"应用管理",name:"app"}},[a("div",{staticClass:"form"},[a("div",{staticClass:"search"},[a("el-input",{attrs:{placeholder:e.$translateTitle("application.applicationname"),size:"small"},model:{value:e.name,callback:function(t){e.name=t},expression:"name"}}),a("el-button",{attrs:{type:"primary",size:"small"},on:{click:function(t){return e.getAppMange(0)}}},[e._v(" "+e._s(e.$translateTitle("application.search"))+" ")])],1)]),a("el-table",{staticStyle:{width:"100%"},attrs:{data:e.tableData}},[a("el-table-column",{attrs:{label:e.$translateTitle("application.applicationidentification"),prop:"productIdentifier"}}),a("el-table-column",{attrs:{label:e.$translateTitle("application.applicationname"),prop:"title"}}),a("el-table-column",{attrs:{prop:"userUnit",label:"应用单位"}}),a("el-table-column",{attrs:{label:e.$translateTitle("application.scaleofservice"),prop:"scale",sortable:""}}),a("el-table-column",{attrs:{label:e.$translateTitle("application.industrytype"),prop:"category"}}),a("el-table-column",{attrs:{label:e.$translateTitle("application.createtime"),prop:"creation_time"}}),a("el-table-column",{attrs:{label:e.$translateTitle("developer.operation"),prop:"operation",width:"350"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-popover",{ref:"popover-"+t.$index,attrs:{placement:"top",width:"300"}},[a("p",[e._v("确定删除这个"+e._s(t.row.name)+"应用吗？")]),a("div",{staticStyle:{margin:"0","text-align":"right"}},[a("el-button",{attrs:{size:"mini"},on:{click:function(e){t._self.$refs["popover-"+t.$index].doClose()}}},[e._v(" "+e._s(e.$translateTitle("developer.cancel"))+" ")]),a("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(a){return e.makeSure(t)}}},[e._v(" "+e._s(e.$translateTitle("developer.determine"))+" ")])],1),a("el-link",{attrs:{slot:"reference",underline:!1,icon:"el-icon-delete",type:"danger"},slot:"reference"},[e._v(" "+e._s(e.$translateTitle("developer.delete"))+" ")])],1),a("el-button",{attrs:{type:"text",size:"small",icon:"el-icon-edit"},on:{click:function(a){return e.handleClickUpdate(t)}}},[e._v(" "+e._s(e.$translateTitle("developer.edit"))+" ")]),a("el-button",{attrs:{type:"text",size:"small"},on:{click:function(a){return e.Gotoproduct(t)}}},[a("i",{staticClass:"el-icon-s-management"}),e._v(" 管理 ")]),a("el-link",{attrs:{underline:!1,type:"primary"},on:{click:function(a){return e.applicationDeployment(t.row)}}},[e._v(" 部署 ")])]}}])})],1),a("el-pagination",{attrs:{"current-page":e.page.currentPage,"page-sizes":e.page.pageSizes,"page-size":e.page.pageSize,total:e.page.total,layout:"total, sizes, prev, pager, next, jumper"},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}})],1)],1)],1)},n=[],r=(a("b0c0"),a("a4d3"),a("e01a"),a("99af"),a("1285")),o=a("7212"),l=a("ed08"),s=a("1c4e"),c={data:function(){return{label:"我的应用",activeName:"app",dialogVisible:!1,name:"",page:{currentPage:0,pageSizes:[10,20,30],pageSize:10,total:0},description:"暂无数据",tableData:[],isShow:!1,arr:[]}},created:function(){this.getAppMange()},methods:{handleClickVisit:function(e){var t=e.$index,a=this.tableData[t].productIdentifier,i=window.location.origin+"/iot/"+a+"#/login";window.open(i,"__blank")},getAppMange:function(e){var t=this;0==e&&(this.page.currentPage=0),this.tableData=[];var a={};this.name&&(a.title=this.name),Object(s["getProject"])({limit:this.page.pageSize,skip:this.page.currentPage,keys:"count(*)",where:a}).then((function(e){var a=e.results;t.label="我的应用(".concat(e.count,")"),t.description="获取".concat(a.length,"条数据"),t.page.total=e.count;for(var i=0;i<a.length;i++){var n={};n.name=a[i].title,n.objectId=a[i].objectId,n.productIdentifier=a[i].productIdentifier,n.scale=Object(s["handleZero"])(a[i].scale),n.creation_time=Object(l["utc2beijing"])(a[i].createdAt),n.end_time=Object(l["utc2beijing"])(a[i].updatedAt),n.category=a[i].category,n.secret=a[i].secret,n.logo=a[i].logo,n.title=a[i].title,n.userUnit=a[i].userUnit,n.dashboard=a[i].dashboard,n.background=a[i].background,n.acl=a[i].ACL,n.desc=a[i].desc,n.copyright=a[i].copyright,t.tableData.push(n)}}))},handleSizeChange:function(e){this.page.pageSize=e,this.getAppMange()},handleCurrentChange:function(e){this.page.currentPage=(e-1)*this.page.pageSize,this.getAppMange()},handleClickLook:function(e){e.$index;var t='\n          <table\n              class="mailtable"\n              style="width:100%;"\n              border="0"\n              cellspacing="0"\n              cellpadding="0"\n            >\n              <tr>\n                  <td style="text-align:left;\n                  color: #74777a;\n                  font-weight: 400;\n                  background: #fafafc;\n                  width:200px;\n                  font-weight:bold;">App Id:</td>\n                  <td>'.concat(e.row.objectId,'</td>\n              </tr>\n              <tr ">\n                   <td style="color: #74777a;\n                  font-weight: 400;\n                  background: #fafafc;\n                  width:200px;\n                  padding-top:20px;\n                  font-weight:bold;">App Secret:\n                  </td>\n                  <td style="padding-top:20px;">').concat(e.row.secret,"</td>\n              </tr>\n              </table>\n          ");this.$alert(t,"应用详情",{dangerouslyUseHTMLString:!0})},handleClickUpdate:function(e){var t=e.row;this.$router.push({path:"/applicationManagement/addApp",query:{actionType:"update",title:"修改应用",name:t.name,scale:t.scale,creation_time:t.creation_time,end_time:t.end_time,category:t.category,productIdentifier:t.productIdentifier,secret:t.secret,objectId:t.objectId,logo:t.logo,userUnit:t.userUnit,dashboard:t.dashboard,background:t.background,desc:t.desc,copyright:t.copyright}})},makeSure:function(e){var t=this,a={keys:"count(*)",skip:0,limit:1,where:{product:e.row.objectId}};Object(r["queryDevice"])(a).then((function(a){a.count>0?t.$message("请先删除该产品下设备"):Object(o["getProduct"])(e.row.objectId).then((function(a){Object(o["delProduct"])(e.row.objectId).then((function(a){a&&(t.$message({type:"success",message:"删除成功"}),e._self.$refs["popover-".concat(e.$index)].doClose(),t.getAppMange())})).catch((function(e){}))})).catch((function(e){}))})).catch((function(e){}))},Gotoproduct:function(e){var t=[];for(var a in e.row.acl)t.push(a.substring(5));this.$store.dispatch("setProjectRole",t),this.$router.push({path:"/roles/product",query:{project:e.row.objectId}})},serverlictool:function(e){this.$router.push({path:"/roles/server_control",query:{appid:e.objectId,appsecret:e.secret}})},applicationDeployment:function(e){var t=this;e.name?Object(s["setUpLictool"])(e.name).then((function(e){e&&t.$message("正在部署中")})).catch((function(e){t.$message(e)})):this.$message("没有应用名")}}},d=c,u=(a("af0c"),a("2877")),p=Object(u["a"])(d,i,n,!1,null,"1721bf24",null);t["default"]=p.exports},f91d:function(e,t,a){},fcbb:function(e,t,a){"use strict";a.r(t);var i,n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"resourcechannel"},[a("div",{staticClass:"firsttable"},[a("el-form",{staticClass:"demo-form-inline",attrs:{inline:!0,model:e.channelformsearch,size:"small"}},[a("el-form-item",[a("el-input",{attrs:{placeholder:e.$translateTitle("resource.name")},model:{value:e.channelformsearch.name,callback:function(t){e.$set(e.channelformsearch,"name",t)},expression:"channelformsearch.name"}})],1),a("el-form-item",[a("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.Get_Re_Channel(0)}}},[e._v(" "+e._s(e.$translateTitle("developer.search"))+" ")])],1),a("el-form-item",[a("el-button",{attrs:{type:"primary"},on:{click:e.addchanneltype}},[e._v(" "+e._s(e.$translateTitle("developer.selectchannel"))+" ")])],1)],1),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.listLoading,expression:"listLoading"}],staticStyle:{width:"100%"},attrs:{data:e.tableData,"row-class-name":e.getChannelEnable}},[a("el-table-column",{attrs:{label:e.$translateTitle("developer.channelnumber")},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(t.row.objectId))])]}}])}),a("el-table-column",{attrs:{label:e.$translateTitle("developer.channelname")},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(t.row.name))])]}}])}),a("el-table-column",{attrs:{label:e.$translateTitle("developer.channeltype")},scopedSlots:e._u([{key:"default",fn:function(t){return[1==t.row.type?a("span",[e._v(" "+e._s(e.$translateTitle("developer.collectionchannel"))+" ")]):2==t.row.type?a("span",[e._v(" "+e._s(e.$translateTitle("developer.resourcechannel"))+" ")]):a("span",[e._v("任务通道")])]}}])}),a("el-table-column",{attrs:{label:e.$translateTitle("developer.servicetype")},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(t.row.cType))])]}}])}),a("el-table-column",{attrs:{label:e.$translateTitle("developer.channelstatus")},scopedSlots:e._u([{key:"default",fn:function(t){return["ONLINE"==t.row.status?a("span",{staticStyle:{color:"green"}},[e._v(" 在线 ")]):a("span",{staticStyle:{color:"red"}},[e._v("离线")])]}}])}),a("el-table-column",{attrs:{label:e.$translateTitle("developer.channeladdr"),width:"200"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s("channel/"+t.row.objectId))])]}}])}),a("el-table-column",{attrs:{label:e.$translateTitle("developer.describe")},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(t.row.desc))])]}}])}),a("el-table-column",{attrs:{label:e.$translateTitle("developer.operation"),width:"350"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{slot:"reference",type:"primary",size:"mini"},on:{click:function(a){return e.editorChannel(t.row)}},slot:"reference"},[e._v(" 编辑 ")]),0==t.row.isEnable?a("el-button",{attrs:{type:"success",size:"mini"},on:{click:function(a){return e.qyChannel(t.row,"enable")}}},[e._v(" "+e._s(e.$translateTitle("developer.enable"))+" ")]):a("el-button",{attrs:{type:"danger",size:"mini"},on:{click:function(a){return e.qyChannel(t.row,"disable")}}},[e._v(" "+e._s(e.$translateTitle("developer.prohibit"))+" ")]),a("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(a){return e.updateChannel(t.row)}}},[e._v(" 详情 ")]),a("el-popover",{ref:"popover-"+t.$index,attrs:{placement:"top",width:"300"}},[a("p",[e._v("确定删除这个"+e._s(t.row.name)+"通道吗？")]),a("div",{staticStyle:{margin:"0","text-align":"right"}},[a("el-button",{attrs:{size:"mini"},on:{click:function(e){t._self.$refs["popover-"+t.$index].doClose()}}},[e._v(" "+e._s(e.$translateTitle("developer.cancel"))+" ")]),a("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(a){return e.deleteChannel(t)}}},[e._v(" "+e._s(e.$translateTitle("developer.determine"))+" ")])],1),a("el-button",{attrs:{slot:"reference",type:"danger",size:"mini"},slot:"reference"},[e._v(" "+e._s(e.$translateTitle("developer.delete"))+" ")])],1),a("el-tooltip",{staticClass:"item",attrs:{disabled:"OFFLINE"!=t.row.status,effect:"dark",content:"请先启用通道",placement:"top"}},[a("el-button",{staticStyle:{position:"absolute",width:"100px",height:"10px",opacity:"0"},attrs:{type:"primary",size:"mini"},on:{click:function(a){return e.subProTopic(t.row)}}})],1),a("el-button",{attrs:{disabled:"OFFLINE"==t.row.status,type:"primary",size:"mini"},on:{click:function(a){return e.subProTopic(t.row)}}},[e._v(" 订阅日志 ")])]}}])})],1),a("div",{staticClass:"elpagination",staticStyle:{"margin-top":"20px"}},[a("el-pagination",{attrs:{"page-sizes":[10,20,30,50],"page-size":e.length,total:e.total,layout:"total, sizes, prev, pager, next, jumper"},on:{"size-change":e.channelSizeChange,"current-change":e.channelCurrentChange}})],1)],1),a("el-dialog",{attrs:{title:e.channelupdated+"通道",visible:e.channelForm,"close-on-click-modal":!1,"before-close":e.handleClose,width:"30%",top:"10vh"},on:{"update:visible":function(t){e.channelForm=t}}},[a("el-form",{ref:"addchannel",attrs:{model:e.addchannel,rules:e.addrules,"label-width":"auto"}},[a("el-form-item",{attrs:{label:"通道类型",prop:"region"}},[a("el-select",{attrs:{disabled:"",placeholder:"通道类型"},on:{change:e.removeauto},model:{value:e.addchannel.region,callback:function(t){e.$set(e.addchannel,"region",t)},expression:"addchannel.region"}},e._l(e.channelregion,(function(e,t){return a("el-option",{key:t,attrs:{label:e.title.zh,value:e.cType}})})),1),a("el-row",{staticStyle:{width:"100%","min-height":"0","max-height":"100px","margin-top":"20px","text-align":"center"},attrs:{gutter:24}},e._l(e.channelregion,(function(t,i){return a("el-col",{key:i,staticStyle:{cursor:"pointer"},attrs:{span:24}},[t.params.ico&&t.params.ico.default?a("el-card",{directives:[{name:"show",rawName:"v-show",value:e.addchannel.region==t.cType,expression:"addchannel.region == item.cType"}],staticClass:"box-card",style:{display:e.addchannel.region==t.cType?"block":"none",color:e.addchannel.region==t.cType?"#00bad0":"#c0c4cc"},attrs:{shadow:e.addchannel.region==t.cType?"always":"hover",size:"mini"}},[a("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[a("span",[e._v(e._s(t.title.zh))]),a("el-button",{staticStyle:{float:"right"},attrs:{disabled:""!=e.resourceid,type:"success",size:"mini"},on:{click:function(a){return e.setCard(t.cType)}}},[e._v(" 已选 ")])],1),a("div",{staticClass:"text item"},[a("el-row",{attrs:{gutter:24}},[a("el-col",{attrs:{span:12}},[a("img",{staticClass:"image",staticStyle:{width:"50px",height:"50px"},attrs:{src:t.params.ico.default?t.params.ico.default:""}})]),a("el-col",{attrs:{span:12}},[a("el-tag",[e._v(e._s(t.cType))])],1)],1)],1)]):e._e()],1)})),1)],1),a("el-form-item",{attrs:{label:e.$translateTitle("developer.channelname"),prop:"name"}},[a("el-input",{attrs:{placeholder:e.$translateTitle("developer.channelname"),autocomplete:"off"},model:{value:e.addchannel.name,callback:function(t){e.$set(e.addchannel,"name",t)},expression:"addchannel.name"}})],1),a("el-form-item",{attrs:{prop:"applicationtText",label:"所属应用"}},[a("el-input",{attrs:{placeholder:"请选择所属应用",readonly:""},on:{focus:function(t){e.showTree=!e.showTree}},model:{value:e.addchannel.applicationtText,callback:function(t){e.$set(e.addchannel,"applicationtText",t)},expression:"addchannel.applicationtText"}}),e.showTree?a("div",[a("el-tree",{attrs:{data:e.allApps,props:e.defaultProps},on:{"node-click":e.handleNodeClick}})],1):e._e()],1),e._l(e.arrlist,(function(t,i){return a("el-col",{key:i,attrs:{span:12}},[a("el-form-item",{attrs:{label:t.title.zh,required:t.required,prop:t.showname}},["string"==t.type?a("el-input",{model:{value:e.addchannel[t.showname],callback:function(a){e.$set(e.addchannel,t.showname,a)},expression:"addchannel[item.showname]"}}):"integer"==t.type?a("el-input",{model:{value:e.addchannel[t.showname],callback:function(a){e.$set(e.addchannel,t.showname,e._n(a))},expression:"addchannel[item.showname]"}}):"boolean"==t.type?a("el-select",{staticClass:"notauto",attrs:{readonly:""},model:{value:e.addchannel[t.showname],callback:function(a){e.$set(e.addchannel,t.showname,a)},expression:"addchannel[item.showname]"}},[a("el-option",{attrs:{value:!0,label:"是"}}),a("el-option",{attrs:{value:!1,label:"否"}})],1):e._e()],1)],1)})),a("el-form-item",{attrs:{label:e.$translateTitle("developer.describe")}},[a("el-input",{attrs:{rows:3,placeholder:e.$translateTitle("developer.describe"),autocomplete:"off",type:"textarea"},on:{change:e.inputChange},model:{value:e.addchannel.desc,callback:function(t){e.$set(e.addchannel,"desc",t)},expression:"addchannel.desc"}})],1)],2),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{staticStyle:{"margin-right":"20px"},on:{click:e.handleClose}},[e._v(" "+e._s(e.$translateTitle("developer.cancel"))+" ")]),a("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.addchannelForm("addchannel")}}},[e._v(" "+e._s(e.$translateTitle("developer.determine"))+" ")])],1)],1),a("el-dialog",{attrs:{visible:e.dialogVisible,title:"通道详情",width:"50%"},on:{"update:visible":function(t){e.dialogVisible=t}}},[a("div",[a("el-row",[a("el-col",{attrs:{span:12}},[e._v("ID:")]),a("el-col",{attrs:{span:12}},[e._v(e._s(e.resourceid))])],1),a("el-row",[a("el-col",{attrs:{span:12}},[e._v("Resource Type:")]),a("el-col",{attrs:{span:12}},[e._v(e._s(e.resoucetype))])],1),a("el-row",[a("el-col",{attrs:{span:12}},[e._v("Description:")]),a("el-col",{attrs:{span:12}},[e._v(e._s(e.description))])],1),e._l(e.detailchannel,(function(t,i){return a("el-row",{key:t},[a("el-col",{attrs:{span:12}},[e._v(e._s(i))]),a("el-col",{attrs:{span:12}},[e._v(e._s(t))])],1)}))],2),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{type:"primary"},on:{click:function(t){e.dialogVisible=!1}}},[e._v(" 确 定 ")])],1)]),a("el-dialog",{attrs:{title:e.channelname+"日志",visible:e.subdialog,"before-close":e.handleCloseSubdialog,width:"85%"},on:{"update:visible":function(t){e.subdialog=t}}},[a("div",{staticStyle:{"margin-top":"20px"}},[a("pre",{staticClass:"ace_editor",staticStyle:{width:"100%","min-height":"300px"},attrs:{id:"subdialog"}},[e._v("                    "),a("textarea",{staticClass:"ace_text-input",staticStyle:{overflow:"scroll"}}),e._v("      ")])]),a("span",{staticClass:"dialog-footer",staticStyle:{height:"30px"},attrs:{slot:"footer"},slot:"footer"},[a("el-switch",{staticStyle:{display:"inline-block","margin-right":"10px"},attrs:{"active-color":"#13ce66","inactive-color":"#ff4949","inactive-text":"自动刷新"},on:{change:e.stopsub},model:{value:e.value4,callback:function(t){e.value4=t},expression:"value4"}})],1)])],1)},r=[],o=a("1da1"),l=(a("96cf"),a("b0c0"),a("d3b7"),a("25f0"),a("d81d"),a("159b"),a("a4d3"),a("e01a"),a("4d63"),a("ac1f"),a("89e8")),s=a("bc35"),c=a("5da9"),d=a("bb22"),u=a("1b07"),p=(a("30f8"),a("c620")),m={data:function(){return{listLoading:!1,dialogVisible:!1,isopen:"suo",pwdType:"password",tableData:[],channelForm:!1,channelupdated:"新增",activeName:"first",channelformsearch:{name:""},channelregion:[],addchannel:{region:"",desc:"",applicationtText:""},applicationList:[],addrules:{applicationtText:[{required:!0,message:"请选择所属应用",trigger:"change"}],roles:[{required:!0,message:"请选择所属应用",trigger:"blur"}],name:[{required:!0,message:"请输入通道名称",trigger:"blur"}],region:[{required:!0,message:"请选择服务类型",trigger:"change"}]},length:10,start:0,total:0,selectregion:{},resourceid:"",resoucetype:"",description:"",detailchannel:"",subdialog:!1,value4:"",subdialogid:"",subdialogtimer:null,channelname:"",arrlist:[],channelId:"",channelrow:[],showTree:!1,allApps:[],defaultProps:{children:"children",label:"label"}}},mounted:function(){this.Get_Re_Channel(0),this.dialogType(),this.getApplication()},methods:{addchannelForm:function(e){var t=this;this.resourceid?this.editChannel(this.resourceid,e):this.$refs[e].validate((function(e){if(e&&t.addchannel.applicationtText){var a={};for(var i in t.addchannel)a[i]=t.addchannel[i];delete a.region,delete a.desc,delete a.type,delete a.isEnable,delete a.name;var n="role:"+t.addchannel.applicationtText,r={};r[n]={read:!0,write:!0};var o={ACL:r,config:a,name:t.addchannel.name,cType:t.addchannel.region,desc:t.addchannel.desc,isEnable:!1,status:"OFFLINE",type:t.addchannel.type.toString()};t.addchannelaxios(o)}else t.$message("有必填项未填")}))},addchannelaxios:function(e){var t=this;return Object(o["a"])(regeneratorRuntime.mark((function a(){return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return a.next=2,Object(l["postChannel"])(e).then((function(e){e&&(t.$message({type:"success",message:"编辑"==t.channelupdated?"编辑成功":"创建成功"}),t.$refs["addchannel"].resetFields(),t.addchannel={},t.channelForm=!1,t.resourceid="")}));case 2:case"end":return a.stop()}}),a)})))()},handleNodeClick:function(e){this.showTree=!this.showTree,this.$set(this.addchannel,"applicationtText",e.name)},inputChange:function(e){},validUrl:function(e,t,a){var i=/^[A-Za-z0-9]+\.[A-Za-z0-9]+[\/=\?%\-&_~`@[\]\':+!]*([^<>\"\"])*$/;i.test(t)?a():a(new Error("需要输入正确的url"))},validPort:function(e,t,a){var i=/^([0-9]|[1-9]\d|[1-9]\d{2}|[1-9]\d{3}|[1-5]\d{4}|6[0-4]\d{3}|65[0-4]\d{2}|655[0-2]\d|6553[0-5])$/;i.test(t)?a():a(new Error("需要输入正确的端口号"))},Get_Re_Channel:function(e){var t=this;return Object(o["a"])(regeneratorRuntime.mark((function a(){var i,n,r;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return t.listLoading=!0,0==e&&(t.start=0),i={skip:t.start,limit:t.length,order:"-createdAt"},a.next=5,Object(l["queryChannel"])(i);case 5:n=a.sent,r=n.results,t.total=r.length,t.tableData=r,t.listLoading=!1;case 10:case"end":return a.stop()}}),a)})))()},getApplication:function(){var e=this;return Object(o["a"])(regeneratorRuntime.mark((function t(){var a,i,n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return a={limit:100},t.next=3,Object(c["queryRole"])(a);case 3:i=t.sent,n=i.results,n.map((function(t){var a={};a.id=t.id,a.name=t.desc,e.applicationList.push(a)}));case 6:case"end":return t.stop()}}),t)})))()},dialogType:function(){var e=this;return Object(o["a"])(regeneratorRuntime.mark((function t(){var a,i,n,r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,Object(s["Roletree"])();case 2:return a=t.sent,i=a.results,n=void 0===i?[]:i,e.allApps=n,t.next=8,Object(u["resourceTypes"])();case 8:r=t.sent,r.forEach((function(e){e.params.ico||(e.params.ico={title:{en:"channel ICO",zh:"通道ICO"},description:{en:"channel ICO",zh:"通道ICO"},default:"http://dgiot-1253666439.cos.ap-shanghai-fsi.myqcloud.com/logo/logo.png"})})),e.channelregion=r;case 11:case"end":return t.stop()}}),t)})))()},qyChannel:function(e,t){var a=this;Object(d["subupadte"])(e.objectId,t).then((function(e){e&&a.$message({type:"success",message:"".concat("enable"==t?"启用成功":"禁用成功")}),a.Get_Re_Channel(0)})).catch((function(e){a.$message(e.error)}))},updateChannel:function(e){this.dialogVisible=!0,this.resourceid=e.objectId,this.detailchannel=e.config,this.resoucetype=e.cType,this.description=e.desc},editChannel:function(e,t){var a=this;return Object(o["a"])(regeneratorRuntime.mark((function t(){var i,n,r,o;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:for(n in i={},a.addchannel)i[n]=a.addchannel[n];return delete i.region,delete i.desc,delete i.type,delete i.isEnable,delete i.name,r={config:i,name:a.addchannel.name,cType:a.addchannel.region,desc:a.addchannel.desc},t.next=10,Object(l["putChannel"])(e,r);case 10:o=t.sent,o.updatedAt&&(a.$message({type:"success",message:"编辑成功"}),a.$refs["addchannel"].resetFields(),a.addchannel={},a.channelForm=!1,a.resourceid="",a.Get_Re_Channel(0));case 12:case"end":return t.stop()}}),t)})))()},deleteChannel:function(e){this.delchannelaxios(e)},delchannelaxios:function(e){var t=this;Object(l["delChannel"])(e.row.objectId).then((function(a){t.$message({type:"success",message:"删除成功"}),e._self.$refs["popover-".concat(e.$index)].doClose(),t.Get_Re_Channel(0)})).catch((function(e){}))},addchanneltype:function(){this.$router.push({path:"/CreateResourcechannel",query:{type:"create"}})},handleClose:function(){this.addchannel={},this.channelForm=!1,this.$refs["addchannel"].resetFields(),this.resourceid=""},getChannelEnable:function(e,t){return 1==e.row.isEnable?"green_active":"red_active"},channelSizeChange:function(e){this.length=e,this.Get_Re_Channel()},channelCurrentChange:function(e){this.start=(e-1)*this.length,this.Get_Re_Channel()},arrSort:function(e,t){var a=e.order,i=t.order;return a<i?-1:a>i?1:0},orderObject:function(e){var t=[];for(var a in e)e[a].showname=a,t.push(e[a]);return t.sort(this.arrSort)},setCard:function(e){this.removeauto(e)},removeauto:function(e){var t=this,a={},i={applicationtText:[{required:!0,message:"请选择所属应用",trigger:"change"}],roles:[{required:!0,message:"请选择所属应用",trigger:"blur"}],name:[{required:!0,message:"请输入通道名称",trigger:"blur"}],region:[{required:!0,message:"请选择服务类型",trigger:"change"}]};if(""==this.resourceid?this.channelregion.map((function(n){n.cType==e&&(t.$forceUpdate(),t.selectregion=n,t.arrlist=t.orderObject(t.selectregion.params),t.arrlist.map((function(e){e.default?a[e.showname]=e.default:a[e.showname]="",e.required&&("string"==e.type||"integer"==e.type?i[e.showname]=[{required:!0,trigger:"blur"}]:i[e.showname]=[{required:!0,trigger:"change"}])})),a.region=e,a.desc="",a.name="",a.type=t.selectregion.type,a.isEnable=!1)})):this.channelregion.map((function(n){n.cType==e&&(t.selectregion=n,t.$forceUpdate(),t.arrlist=t.orderObject(t.selectregion.params),t.arrlist.map((function(n){for(var r in t.channelrow.config)n.showname==r&&(a[n.showname]=t.channelrow.config[r]),n.required&&("string"==n.type||"integer"==n.type?i[n.showname]=[{required:!0,trigger:"blur"}]:i[n.showname]=[{required:!0,trigger:"change"}]),a.region=e,a.desc=t.channelrow.desc,a.name=t.channelrow.name,a.type=t.selectregion.type,a.isEnable=t.channelrow.isEnable})))})),this.channelrow)for(var n in this.channelrow.ACL)a.applicationtText=n?n.substr(5):"";this.addchannel=a,this.addchannel.region=e,this.addrules=i},editorChannel:function(e){this.channelrow=e,this.resourceid=e.objectId,this.channelForm=!0,this.channelupdated="编辑",this.removeauto(e.cType)},nowtime:function(){var e=Date.parse(new Date),t=new Date(e),a=(t.getFullYear(),t.getMonth()+1<=10?t.getMonth():t.getMonth(),t.getDate()+1<=10?t.getDate():t.getDate(),(t.getHours()+1<=10?"0"+t.getHours():t.getHours())+":"),i=(t.getMinutes()+1<=10?"0"+t.getMinutes():t.getMinutes())+":",n=t.getSeconds()+1<=10?"0"+t.getSeconds():t.getSeconds();return a+i+n+" "},subProTopic:function(e){this.subdialog=!0,this.subdialogid=e.objectId,this.channelname=e.objectId,setTimeout((function(){i=ace.edit("subdialog"),i.session.setMode("ace/mode/text"),i.setTheme("ace/theme/gob"),i.setReadOnly(!0),i.setOptions({enableBasicAutocompletion:!1,enableSnippets:!0,enableLiveAutocompletion:!0})}));var t={topic:"log/channel/"+e.objectId,qos:2},a=new RegExp("log/channel/"+e.objectId),n="",r=this;p["Websocket"].add_hook(a,(function(e){i.session.getLength()>=1e3?n="":n+=r.nowtime()+e+"\n",i.setValue(n),i.gotoLine(i.session.getLength())}));var o=JSON.stringify({action:"start_logger"});p["Websocket"].subscribe(t,(function(t){if(t.result){var a={topic:"channel/"+e.objectId,text:o,retained:!0,qos:2};p["Websocket"].sendMessage(a),r.subdialogtimer=window.setInterval((function(){p["Websocket"].sendMessage(a)}),6e5)}}))},stopsub:function(e){var t;t=0==e?JSON.stringify({action:"stop_logger"}):JSON.stringify({action:"start_logger"});var a={topic:"channel/"+this.subdialogid,text:t,retained:!0,qos:2};p["Websocket"].sendMessage(a)},handleCloseSubdialog:function(){this.subdialog=!1;var e=JSON.stringify({action:"stop_logger"}),t={topic:"channel/"+this.subdialogid,text:e,retained:!0,qos:2};p["Websocket"].sendMessage(t),window.clearInterval(this.subdialogtimer),this.subdialogtimer=null}}},f=m,h=(a("0bff"),a("2877")),v=Object(h["a"])(f,n,r,!1,null,"4ba6311e",null);t["default"]=v.exports},fdec:function(e,t,a){"use strict";a.r(t);var i,n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"equipment"},[a("div",{staticClass:"equ_header"},[a("ul",[a("li",[a("p",[a("span",{staticClass:"svg-container"},[a("vab-icon",{attrs:{icon:"device-line"}})],1),e._v(" "+e._s(e.$translateTitle("equipment.totalequipment"))+" "),a("el-tooltip",{attrs:{content:e.$translateTitle("equipment.totalequipment"),placement:"top"}},[a("i",{staticClass:"el-icon-question"})])],1),a("span",[e._v(e._s(e.devicetotal))])]),a("li",[a("p",[a("span",{staticClass:"svg-container"},[a("vab-icon",{attrs:{icon:"numbers-line"}})],1),e._v(" "+e._s(e.$translateTitle("equipment.activationdevice"))+" "),a("el-tooltip",{attrs:{content:e.$translateTitle("equipment.totalactive"),placement:"top"}},[a("i",{staticClass:"el-icon-question"})])],1),a("span",[e._v(e._s(e.activeall))])]),a("li",[a("p",[a("span",{staticClass:"svg-container"},[a("vab-icon",{attrs:{icon:"contrast-drop-fill"}})],1),e._v(" "+e._s(e.$translateTitle("equipment.onlinedevices"))+" "),a("el-tooltip",{attrs:{content:e.$translateTitle("equipment.totalonline"),placement:"top"}},[a("i",{staticClass:"el-icon-question"})])],1),a("span",[e._v(e._s(e.onlineall))])]),a("li",[a("div",{staticClass:"block"},[e.productimg?a("el-image",{staticStyle:{position:"relative",top:"-55px",width:"250px",height:"200px","line-height":"200px","text-align":"center"},attrs:{src:e.productimg}},[a("div",{staticClass:"image-slot",attrs:{slot:"error"},slot:"error"},[a("i",{staticClass:"el-icon-picture-outline"})])]):e._e()],1)])])]),a("div",{staticClass:"equtabs"},[a("el-tabs",{on:{"tab-click":e.handleClick},model:{value:e.activeName,callback:function(t){e.activeName=t},expression:"activeName"}},[a("el-tab-pane",{attrs:{label:e.$translateTitle("route.设备管理"),name:"first"}},[a("div",[a("div",[a("el-button",{attrs:{size:"small"}},[e._v(" "+e._s(e.$translateTitle("equipment.batchaddition"))+" ")]),a("el-button",{attrs:{type:"primary",size:"small"},on:{click:e.addDeviceForm}},[e._v(" "+e._s(e.$translateTitle("equipment.adddevice"))+" ")])],1)]),a("div",{staticClass:"equdevices",staticStyle:{"margin-top":"20px"}},[a("el-select",{staticClass:"selectdetail",attrs:{size:"small"},model:{value:e.selectdevice,callback:function(t){e.selectdevice=t},expression:"selectdevice"}},[a("el-option",{attrs:{value:e.$translateTitle("equipment.devicename")}}),a("el-option",{attrs:{value:e.$translateTitle("equipment.devicenumber")}})],1),e.selectdevice==e.$translateTitle("equipment.devicename")?a("el-input",{staticClass:"selectdetail",attrs:{placeholder:e.$translateTitle("equipment.enterproductname"),size:"small"},model:{value:e.deviceinput,callback:function(t){e.deviceinput=t},expression:"deviceinput"}}):a("el-input",{staticClass:"selectdetail",attrs:{placeholder:e.$translateTitle("equipment.enterdevicenumber"),size:"small"},model:{value:e.deviceinput,callback:function(t){e.deviceinput=t},expression:"deviceinput"}}),a("el-button",{staticClass:"selectdetail",attrs:{size:"small",type:"primary"},on:{click:function(t){return e.getDevices(0)}}},[e._v(" "+e._s(e.$translateTitle("developer.search"))+" ")]),a("el-button",{staticClass:"selectdetail",attrs:{disabled:0==e.multipleTable.length,size:"small",type:"primary"},on:{click:e.deleteDevcie}},[e._v(" "+e._s(e.$translateTitle("developer.delete"))+" ")]),a("el-button",{staticClass:"selectdetail",attrs:{disabled:0==e.multipleTable.length,size:"small",type:"primary"},on:{click:function(t){return e.unactiveDevice(!1)}}},[e._v(" "+e._s(e.$translateTitle("developer.prohibit"))+" ")]),a("el-button",{staticClass:"selectdetail",attrs:{disabled:0==e.multipleTable.length,size:"small",type:"primary"},on:{click:function(t){return e.unactiveDevice(!0)}}},[e._v(" "+e._s(e.$translateTitle("developer.enable"))+" ")])],1),a("div",{staticClass:"tabstable"},[a("el-table",{ref:"filterTable",staticStyle:{width:"100%","margin-top":"20px","text-align":"center"},attrs:{data:e.tableData,"row-style":e.rowClass},on:{"selection-change":e.handleSelectionChange}},[a("el-table-column",{attrs:{type:"selection",align:"center",width:"55"}}),a("el-table-column",{attrs:{label:e.$translateTitle("equipment.devicenumber")+"/"+e.$translateTitle("equipment.name"),align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(t.row.name))]),a("p",{staticStyle:{margin:"0",color:"green"}},[e._v(e._s(t.row.devaddr))])]}}])}),a("el-table-column",{attrs:{label:e.$translateTitle("equipment.state"),align:"center",width:"200"},scopedSlots:e._u([{key:"default",fn:function(t){return["ONLINE"==t.row.status?a("span",{class:t.row.status},[e._v(" "+e._s(e.$translateTitle("product.online"))+" ")]):e._e(),"ONLINE"==t.row.status?a("el-tooltip",{attrs:{content:"设备已经上线",placement:"top"}},[a("i",{staticClass:"el-icon-question"})]):e._e(),"OFFLINE"==t.row.status?a("span",{class:t.row.status},[e._v(" "+e._s(e.$translateTitle("product.offline"))+" ")]):e._e(),"OFFLINE"==t.row.status?a("el-tooltip",{attrs:{content:"设备已经离线",placement:"top"}},[a("i",{staticClass:"el-icon-question"})]):e._e(),"OFFLINE"!=t.row.status&&"ONLINE"!=t.row.status?a("span",{class:t.row.status},[e._v(" 未注册 ")]):e._e()]}}])}),a("el-table-column",{attrs:{label:e.$translateTitle("equipment.product"),align:"center",width:"200"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(t.row.product.name))])]}}])}),a("el-table-column",{attrs:{label:e.$translateTitle("equipment.nodetype"),align:"center",width:"200"},scopedSlots:e._u([{key:"default",fn:function(e){return[a("vab-icon",{staticStyle:{width:"2rem",height:"2rem"},attrs:{icon:0==e.row.nodeType?"hotel-bed-fill":"hotel-fill"}})]}}])}),a("el-table-column",{attrs:{label:e.$translateTitle("developer.enable")+"/"+e.$translateTitle("developer.prohibit"),align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-switch",{attrs:{"active-color":"#5eb058","inactive-color":"#cccccc"},on:{change:function(a){return e.handelUpdate(a,t.row,t.$index)}},model:{value:t.row.isEnable,callback:function(a){e.$set(t.row,"isEnable",a)},expression:"scope.row.isEnable"}})]}}])}),a("el-table-column",{attrs:{label:"创建时间"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(e.utc2beijing(t.row.createdAt)))])]}}])}),a("el-table-column",{attrs:{label:e.$translateTitle("developer.operation"),align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-link",{attrs:{underline:!1,type:"primary",icon:"el-icon-edit"},on:{click:function(a){return e.editorDevice(t.row)}}},[e._v(" 编辑 ")]),a("el-popover",{ref:"popover-"+t.$index,attrs:{placement:"top",width:"300"}},[a("p",[e._v("确定删除这个"+e._s(t.row.name)+"设备吗？")]),a("div",{staticStyle:{margin:"0","text-align":"right"}},[a("el-button",{attrs:{size:"mini"},on:{click:function(e){t._self.$refs["popover-"+t.$index].doClose()}}},[e._v(" "+e._s(e.$translateTitle("developer.cancel"))+" ")]),a("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(a){return e.makeSure(t)}}},[e._v(" "+e._s(e.$translateTitle("developer.determine"))+" ")])],1),a("el-link",{attrs:{slot:"reference",underline:!1,icon:"el-icon-delete",type:"danger"},slot:"reference"},[e._v(" "+e._s(e.$translateTitle("developer.delete"))+" ")])],1)]}}])})],1),a("div",{staticClass:"elpagination",staticStyle:{"margin-top":"20px"}},[a("el-pagination",{attrs:{"page-sizes":[10,20,30,50],"page-size":e.devicelength,total:e.devicetotal,layout:"total, sizes, prev, pager, next, jumper"},on:{"size-change":e.deviceSizeChange,"current-change":e.deviceCurrentChange}})],1)],1)]),a("el-tab-pane",{attrs:{label:e.$translateTitle("equipment.batchmanagement"),name:"second"}},[a("el-table",{staticStyle:{width:"100%","text-align":"center"},attrs:{data:e.pctableData}},[a("el-table-column",{attrs:{label:e.$translateTitle("equipment.serialnumber"),type:"index",align:"center",width:"200"}}),a("el-table-column",{attrs:{label:e.$translateTitle("equipment.batchname"),align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(t.row.data.batch_name))])]}}])}),a("el-table-column",{attrs:{label:e.$translateTitle("equipment.createdAt"),align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(e.utc2beijing(t.row.createdAt)))])]}}])}),a("el-table-column",{attrs:{label:"操作",align:"center",width:"300"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(a){return e.updatebatch(t.row,t.row.objectId)}}},[e._v(" 编辑 ")]),a("el-button",{attrs:{type:"danger",size:"mini"},on:{click:function(a){return e.deletebatch(t.row.objectId)}}},[e._v(" 删除 ")]),a("el-button",{attrs:{type:"success",size:"mini"},on:{click:function(a){return e.selectbatch(t.row,t.row.objectId)}}},[e._v(" 选择 ")])]}}])})],1)],1)],1),a("el-dialog",{attrs:{title:"设备"+e.equipmentEditor,visible:e.devicedialogVisible,"close-on-click-modal":!1,"before-close":e.handleClose,width:"50%"},on:{"update:visible":function(t){e.devicedialogVisible=t}}},[a("div",{staticClass:"header-title",attrs:{slot:"title"},slot:"title"},[a("span",{staticClass:"title-name"},[e._v(" "+e._s("设备"+e.equipmentEditor)+" "),a("el-tooltip",{staticStyle:{"margin-left":"5px"},attrs:{content:e.$translateTitle("equipment.text"),placement:"top"}},[a("i",{staticClass:"el-icon-question"})])],1)]),a("div",{staticClass:"devicecontent"},[a("el-form",{ref:"deviceform",attrs:{model:e.deviceform,rules:e.rules,"label-width":"150px"}},[a("el-form-item",{attrs:{label:e.$translateTitle("equipment.devicename"),prop:"name"}},[a("el-input",{model:{value:e.deviceform.name,callback:function(t){e.$set(e.deviceform,"name",t)},expression:"deviceform.name"}})],1),a("el-form-item",{attrs:{label:e.$translateTitle("equipment.devicenumber"),prop:"devaddr"}},[a("el-input",{model:{value:e.deviceform.devaddr,callback:function(t){e.$set(e.deviceform,"devaddr",t)},expression:"deviceform.devaddr"}})],1),a("el-form-item",{attrs:{label:e.$translateTitle("equipment.batchname"),prop:"batchId"}},[a("el-input",{attrs:{disabled:""},model:{value:e.deviceform.batchId,callback:function(t){e.$set(e.deviceform,"batchId",t)},expression:"deviceform.batchId"}},[a("i",{staticClass:"el-icon-plus",attrs:{slot:"suffix"},on:{click:e.addDeviceBatch},slot:"suffix"})])],1),a("el-form-item",{attrs:{label:e.$translateTitle("product.productname"),prop:"productName"}},[a("el-input",{attrs:{readonly:""},model:{value:e.deviceform.productName,callback:function(t){e.$set(e.deviceform,"productName",t)},expression:"deviceform.productName"}})],1),a("el-form-item",{attrs:{label:e.$translateTitle("equipment.assetnumber")}},[a("el-input",{model:{value:e.deviceform.assetNum,callback:function(t){e.$set(e.deviceform,"assetNum",t)},expression:"deviceform.assetNum"}})],1),a("el-form-item",{attrs:{label:e.$translateTitle("equipment.equipmenttype")}},[a("el-input",{model:{value:e.deviceform.devModel,callback:function(t){e.$set(e.deviceform,"devModel",t)},expression:"deviceform.devModel"}})],1),a("el-form-item",{attrs:{label:e.$translateTitle("equipment.equipmentbrand")}},[a("el-input",{model:{value:e.deviceform.brand,callback:function(t){e.$set(e.deviceform,"brand",t)},expression:"deviceform.brand"}})],1),a("el-form-item",{attrs:{label:e.$translateTitle("equipment.installationlocation")}},[a("el-input",{on:{focus:e.updateLocation},model:{value:e.deviceform.address,callback:function(t){e.$set(e.deviceform,"address",t)},expression:"deviceform.address"}})],1),a("el-form-item",{attrs:{label:e.$translateTitle("developer.describe")}},[a("el-input",{attrs:{autosize:{minRows:4,maxRows:4},type:"textarea"},model:{value:e.deviceform.desc,callback:function(t){e.$set(e.deviceform,"desc",t)},expression:"deviceform.desc"}})],1)],1)],1),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.submitForm("deviceform")}}},[e._v(" "+e._s(e.$translateTitle("developer.determine"))+" ")]),a("el-button",{on:{click:e.handleClose}},[e._v(" "+e._s(e.$translateTitle("developer.cancel"))+" ")])],1)]),a("el-dialog",{attrs:{visible:e.pcdialogVisible,"close-on-click-modal":!1,"before-close":e.handleClose1,title:"批次添加",width:"50%"},on:{"update:visible":function(t){e.pcdialogVisible=t}}},[a("div",{staticClass:"pccontent"},[a("el-form",{ref:"pcformInline",staticClass:"demo-form-inline",attrs:{inline:!0,model:e.pcformInline,rules:e.pcformrule}},[a("el-form-item",{attrs:{label:e.$translateTitle("equipment.batchname"),prop:"pcname"}},[a("el-input",{attrs:{placeholder:e.$translateTitle("equipment.batchname")},model:{value:e.pcformInline.pcname,callback:function(t){e.$set(e.pcformInline,"pcname",t)},expression:"pcformInline.pcname"}})],1),a("el-form-item",{attrs:{label:e.$translateTitle("equipment.createdAt"),prop:"createdtime"}},[a("el-date-picker",{attrs:{type:"datetime"},model:{value:e.pcformInline.createdtime,callback:function(t){e.$set(e.pcformInline,"createdtime",t)},expression:"pcformInline.createdtime"}})],1),a("el-form-item",[a("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.addbatch("pcformInline")}}},[e._v(" "+e._s(e.$translateTitle("equipment.addbatch"))+" ")])],1)],1),a("el-table",{staticStyle:{width:"100%","text-align":"center"},attrs:{data:e.pctableData,height:"450"}},[a("el-table-column",{attrs:{label:e.$translateTitle("equipment.serialnumber"),type:"index",align:"center",width:"50"}}),a("el-table-column",{attrs:{label:e.$translateTitle("equipment.batchname"),align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(t.row.data.batch_name))])]}}])}),a("el-table-column",{attrs:{label:e.$translateTitle("equipment.createdAt"),align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(e.utc2beijing(t.row.createdAt)))])]}}])}),a("el-table-column",{attrs:{label:e.$translateTitle("developer.operation"),align:"center",width:"300"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(a){return e.updatebatch(t.row,t.row.objectId)}}},[e._v(" "+e._s(e.$translateTitle("developer.edit"))+" ")]),a("el-button",{attrs:{type:"danger",size:"mini"},on:{click:function(a){return e.deletebatch(t.row.objectId)}}},[e._v(" "+e._s(e.$translateTitle("developer.delete"))+" ")]),a("el-button",{attrs:{type:"success",size:"mini"},on:{click:function(a){return e.selectbatch(t.row,t.row.objectId)}}},[e._v(" 选择 ")])]}}])})],1)],1)]),a("el-dialog",{directives:[{name:"drag-dialog",rawName:"v-drag-dialog"}],attrs:{visible:e.bmapdialogVisible,"close-on-click-modal":!1,"before-close":e.handleClosebmap,title:"设备安装地址",width:"50%"},on:{"update:visible":function(t){e.bmapdialogVisible=t}}},[a("div",[a("el-form",{attrs:{model:e.bmapform,inline:!0,size:"small"}},[a("el-form-item",{attrs:{label:"地址名称"}},[a("el-input",{model:{value:e.bmapform.keyword,callback:function(t){e.$set(e.bmapform,"keyword",t)},expression:"bmapform.keyword"}})],1),a("el-form-item",{attrs:{label:"选中地址"}},[a("el-input",{attrs:{readonly:""},model:{value:e.bmapform.address,callback:function(t){e.$set(e.bmapform,"address",t)},expression:"bmapform.address"}})],1)],1),a("baidu-map",{staticStyle:{height:"300px"},attrs:{center:e.center,zoom:e.zoom,"scroll-wheel-zoom":!0,"map-click":!1},on:{ready:e.handler,click:e.mapClick}},[a("bm-local-search",{staticStyle:{display:"none"},attrs:{keyword:e.bmapform.keyword,"auto-viewport":!0,location:e.bmapform.location,zoom:"12.8"}}),a("bm-navigation",{attrs:{anchor:"BMAP_ANCHOR_TOP_RIGHT"}}),a("bm-geolocation",{attrs:{"show-address-bar":!0,"auto-location":!0,anchor:"BMAP_ANCHOR_BOTTOM_RIGHT"}}),a("bm-city-list",{attrs:{anchor:"BMAP_ANCHOR_TOP_LEFT"}})],1)],1),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{type:"primary"},on:{click:e.addressSure}},[e._v("保 存")]),a("el-button",{on:{click:function(t){e.bmapdialogVisible=!1}}},[e._v("取 消")])],1)])],1)])},r=[],o=a("1da1"),l=(a("96cf"),a("159b"),a("d81d"),a("caad"),a("2532"),a("99af"),a("841c"),a("ac1f"),a("b680"),a("b0c0"),a("5319"),a("4be7")),s=a("dcc6"),c=a("a8be"),d=a("cb88"),u=a("7212"),p=a("30f8"),m=a("e0e9"),f={components:{BmNavigation:d["BmNavigation"],BaiduMap:d["BaiduMap"],BmLocalSearch:d["BmLocalSearch"],BmGeolocation:d["BmGeolocation"],BmCityList:d["BmCityList"]},data:function(){var e=function(e,t,a){var i=/[0-9A-Za-z]$/;""==t?a(new Error("设备地址不能为空")):i.test(t)?a():a(new Error("设备地址必须为大小写字母数字"))};return{productimg:"",bmapdialogVisible:!1,onlineall:"",activeall:"",userId:"",batchid:"",pcdialogVisible:!1,devicedialogVisible:!1,equvalue:"0",cities:[],activeName:"first",selectdevice:"",deviceinput:"",devicenumber:"",multipleTable:[],selectRow:[],devicelength:10,devicestart:0,devicetotal:0,visible2:!1,deviceform:{name:"",devaddr:"",batchId:"",desc:"",nodeType:0,devType:"",netType:"",assetNum:"",devModel:"",address:"",productName:"",status:"",isEnable:"",brand:"",auth:12345678,yysId:"09"},yysSelect:[],rules:{name:[{required:!0,message:"请输入设备名称",trigger:"blur"}],devaddr:[{required:!0,message:"请输入设备编号",trigger:"blur"},{validator:e}],batchId:[{required:!0,message:"请输入设备批次",trigger:"blur"}],nodeType:[{required:!0,message:"请输入设备类型",trigger:"blur"}],netType:[{required:!0,message:"请选择网络格式",trigger:"change"}],devType:[{required:!0,message:"请选择设备类型",trigger:"change"}],productName:[{required:!0,message:"请选择产品名称",trigger:"change"}]},pcformrule:{pcname:[{required:!0,message:"请输入批次名称",trigger:"blur"}],createdtime:[{type:"date",required:!0,message:"请选择创建时间",trigger:"change"}]},pcformInline:{pcnumber:"",pcname:"",createdtime:""},pctableData:[],equipmentEditor:"添加",tableData:[],proTableData:[],proTableData1:[],activelength:[],onlinelength:[],center:{lng:0,lat:0},zoom:13,bmapform:{keyword:"",location:"",address:""},deviceid:"",map:null,addresspointer:"",productenable:!0,changeproduct:!0,tagsid:"",productroleslist:[]}},watch:{multipleTable:function(e){var t=this;this.selectRow=[],e.length>0&&e.forEach((function(e,a){t.selectRow.push(t.tableData.indexOf(e))}))}},mounted:function(){this.getDevices(0),this.addDeviceBatch(0),this.queryYysId(),Cookies.get("language"),this.$route.query.productid&&(this.equvalue=this.$route.query.productid,this.searchProduct(this.equvalue))},methods:{queryYysId:function(){var e=this;return Object(o["a"])(regeneratorRuntime.mark((function t(){var a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:a={order:"-createdAt",limit:100,skip:0,where:{type:"b83b5d9fc0"}},Object(c["queryDict"])(a).then((function(t){e.yysSelect=[{name:"空",key:""}],t.results.map((function(t){e.yysSelect.push(t.data)}))}));case 2:case"end":return t.stop()}}),t)})))()},rolesSelect:function(e){var t=this;this.productroleslist=[],this.$queryProduct({}).then((function(e){if(e)for(var a in e.results[0].ACL)a.includes("role")&&t.productroleslist.push(a.substr(5))}),(function(e){Object(p["returnLogin"])(e)}))},goEdit:function(e){var t=window.location.origin+"/spa",a="production";t="development"==a?this.$globalConfig.localTopoUrl:window.location.origin+"/spa";var i="".concat(t,"/#?devaddr=").concat(e.devaddr,"&proudctid=").concat(e.productid);window.open(i,"__blank"),localStorage.setItem("topoData",JSON.stringify(e.config))},addressSure:function(){var e=new BMap.LocalSearch(this.map);e.enableAutoViewport();""==this.bmapform.address&&(this.deviceform.address=this.bmapform.keyword),e.search(this.bmapform.keyword),this.bmapdialogVisible=!1},handler:function(e){e.BMap;var t=e.map;this.center.lng=120.2,this.center.lat=30.26667,this.zoom=this.zoom,this.map=t},mapClick:function(e){var t=this;this.center.lng=e.point.lng,this.center.lat=e.point.lat,this.addresspointer=e.point.lng.toFixed(6)+","+e.point.lat.toFixed(6);var a=new BMap.Geocoder;a.getLocation(e.point,(function(e){t.bmapform.address=e.address,t.deviceform.address=e.address}))},updateLocation:function(){this.bmapdialogVisible=!0},handleClosebmap:function(){this.bmapdialogVisible=!1},getOnlineDevices:function(){var e=this;return Object(o["a"])(regeneratorRuntime.mark((function t(){var a,i;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return a={where:{status:"ONLINE"}},""!=e.deviceinput&&("设备名称"==e.selectdevice?a.where.name=e.deviceinput:a.where.devaddr=e.deviceinput),""!=e.devicenumber&&(a.where.devaddr=e.devicenumber),0!=e.equvalue&&(a.where.product=e.equvalue),t.next=6,e.$queryDevice(a);case 6:i=t.sent,e.onlineall=i.results.length;case 8:case"end":return t.stop()}}),t)})))()},getActiveDevices:function(){var e=this;return Object(o["a"])(regeneratorRuntime.mark((function t(){var a,i;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return a={where:{status:"ACTIVE"}},""!=e.deviceinput&&("设备名称"==e.selectdevice||"Device Name"==e.selectdevice?a.where.name=e.deviceinput:a.where.devaddr=e.deviceinput),""!=e.devicenumber&&(a.where.devaddr=e.devicenumber),0!=e.equvalue&&(a.where.product=e.equvalue),t.next=6,e.$queryDevice(a);case 6:i=t.sent,e.activeall=i.results.length;case 8:case"end":return t.stop()}}),t)})))()},searchProduct:function(){var e=this;return Object(o["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:Object(u["getProduct"])(e.equvalue).then((function(t){e.deviceform.productName=t.name}));case 1:case"end":return t.stop()}}),t)})))()},getDevices:function(e){var t=this;return Object(o["a"])(regeneratorRuntime.mark((function a(){var i,n;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return 0===e&&(t.devicestart=0),t.tableData=[],i={order:"-updatedAt",limit:t.devicelength,skip:t.devicestart,keys:"count(*)",include:"product",where:{product:t.$route.query.productid}},""!=t.deviceinput&&("设备名称"==t.selectdevice?params.where.name=t.deviceinput:params.where.devaddr=t.deviceinput),""!=t.devicenumber&&(params.where.devaddr=t.devicenumber),a.next=7,t.$queryDevice(i);case 7:n=a.sent,t.devicetotal=n.count,t.tableData=n.results,t.getActiveDevices(),t.getOnlineDevices();case 12:case"end":return a.stop()}}),a)})))()},handelUpdate:function(e,t,a){var i=this,n={};for(var r in t)n[r]=t[r];n.isEnable=1!=n.isEnable,this.tableData[a]=n,this.$confirm("是否修改此设备状态?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){var e={};for(var a in t)e[a]=t[a];e.isEnable=1==e.isEnable;var n={isEnable:e.isEnable};i.$putDevice(t.id,n).then((function(e){e.error?i.initQuery("状态修改失败","error"):(i.initQuery("状态修改成功","success"),i.getDevices())}))})).catch((function(){i.$message({type:"info",message:"已取消修改"});var e=t;e.isEnable=1!=e.isEnable,i.tableData[a]=e}))},timestampToTime:function(e){var t=new Date(1e3*e),a=t.getFullYear()+"-",i=(t.getMonth()+1<10?"0"+(t.getMonth()+1):t.getMonth()+1)+"-",n=(t.getDate()+1<=10?"0"+t.getDate():t.getDate())+" ",r=(t.getHours()+1<=10?"0"+t.getHours():t.getHours())+":",o=(t.getMinutes()+1<=10?"0"+t.getMinutes():t.getMinutes())+":",l=t.getSeconds()+1<=10?"0"+t.getSeconds():t.getSeconds();return a+i+n+r+o+l},utc2beijing:function(e){var t=new Date(+new Date(e)+288e5).toISOString().replace(/T/g," ").replace(/\.[\d]{3}Z/,"");return t},filterTag:function(e,t){return t.tag===e},handleSelectionChange:function(e){this.multipleTable=e},deleteDevcie:function(e){var t=this;return Object(o["a"])(regeneratorRuntime.mark((function e(){var a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return a=[],t.multipleTable.map((function(e){a.push(e.id)})),e.next=4,Object(s["Batchdelete"])("_Device",a,{}).then((function(e){e.error?t.initQuery("设备".concat(a,"删除失败"),"error"):t.initQuery("设备".concat(a,"删除成功"),"success")}));case 4:case"end":return e.stop()}}),e)})))()},unactiveDevice:function(e){var t=this;return Object(o["a"])(regeneratorRuntime.mark((function a(){var i,n;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return i=[],t.multipleTable.map((function(e){i.push(e.id)})),n={isEnable:e},a.next=5,Object(s["Batchdelete"])("_Device",i,n).then((function(a){a.error?e?t.initQuery("设备".concat(i,"启动失败"),"error"):t.initQuery("设备".concat(i,"禁用失败"),"error"):e?t.initQuery("设备".concat(i,"启动成功"),"success"):t.initQuery("设备".concat(i,"禁用成功"),"success")}));case 5:case"end":return a.stop()}}),a)})))()},rowClass:function(e){e.row;var t=e.rowIndex;if(this.selectRow.includes(t))return{"background-color":"rgba(185, 221, 249, 0.3)"}},initQuery:function(e,t){this.$message({type:t||"info",message:e})},deviceSizeChange:function(e){this.devicelength=e,this.getDevices()},deviceCurrentChange:function(e){this.devicestart=(e-1)*this.devicelength,this.getDevices()},handleClose:function(){this.deviceid="",this.deviceform={name:"",devaddr:"",batchId:"",desc:"",nodeType:0,devType:"",netType:"",assetNum:"",devModel:"",address:"",productName:"",status:"",isEnable:"",brand:"",auth:12345678,yysId:""},this.$refs["deviceform"].resetFields(),this.devicedialogVisible=!1,this.equipmentEditor="添加"},addDeviceForm:function(){this.deviceid="",this.devicedialogVisible=!0,this.equipmentEditor="添加"},handleClose1:function(){this.pcdialogVisible=!1,this.batchid="",this.pcformInline={pcname:"",createdtime:""}},makeSure:function(e){var t=this;this.$deleteDevice(e.row.objectId).then((function(a){a.error?(e._self.$refs["popover-".concat(e.$index)].doClose(),t.initQuery("删除失败","error")):(t.initQuery("删除成功","success"),e._self.$refs["popover-".concat(e.$index)].doClose(),t.getDevices())}))},addDeviceBatch:function(e){var t=this;return Object(o["a"])(regeneratorRuntime.mark((function a(){var i,n;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return t.pcdialogVisible=0!=e,a.next=3,Object(m["getBatchNumer"])();case 3:i=a.sent,n=i.results,t.pctableData=n;case 6:case"end":return a.stop()}}),a)})))()},editorDevice:function(e){this.deviceid=e.objectId,this.devicedialogVisible=!0,this.deviceform={devaddr:e.devaddr,name:e.name,assetNum:void 0==e.detail?"":e.detail.assetNum,devModel:void 0==e.detail?"":e.detail.devModel,desc:void 0==e.detail?"":e.detail.desc,productid:e.product.objectId,brand:void 0==e.detail?"":e.detail.brand,productName:e.product.name,status:e.status,isEnable:e.isEnable,address:void 0==e.detail?"":e.detail.address,auth:void 0==e.basedata.auth?"":e.basedata.auth,yysId:void 0==e.basedata.yysId?"":e.basedata.yysId},this.bmapform.address=e.address,this.batchid=e.batchid,this.center.lat=e.latitude,this.center.lng=e.longitude,this.addresspointer=e.latitude+","+e.longitude,this.tagsid=e.tagid,this.equipmentEditor="编辑",this.rolesSelect(e.productid)},getBatch:function(){return new l["Promise"]((function(e,t){i.length>0?e(i):t(!1)}))},submitForm:function(e){var t=this,a={devaddr:this.deviceform.devaddr,name:this.deviceform.name};this.$refs[e].validate((function(e){if(e)if(""!=t.deviceid){var i={where:{devaddr:t.deviceform.devaddr}};t.$queryDevice(i).then((function(e){if(0==e.results.length){var n="role:"+t.productroleslist[0],r={};r[n]={read:!0,write:!0};var o={ACL:r,detail:{assetNum:t.deviceform.assetNum,devModel:t.deviceform.devModel,brand:t.deviceform.brand,address:t.deviceform.address,desc:t.deviceform.desc},product:{__type:"Pointer",className:"Product",objectId:t.equvalue},basedata:{auth:t.deviceform.auth,yysId:t.deviceform.yysId}};i=Object.assign(a,o),t.$putDevice(t.deviceid,i).then((function(e){e.error?t.initQuery("修改失败","error"):(t.initQuery("修改成功","success"),t.devicedialogVisible=!1,t.getDevices(),t.deviceform={})}))}else t.initQuery("设备已经存在","error")}))}else{i={where:{devaddr:t.deviceform.devaddr}};t.$queryDevice(i).then((function(e){if(0==e.results.length){var n="role:"+t.productroleslist[0],r={};r[n]={read:!0,write:!0};var o={ACL:r,detail:{assetNum:t.deviceform.assetNum,devModel:t.deviceform.devModel,brand:t.deviceform.brand,address:t.deviceform.address,desc:t.deviceform.desc},product:{__type:"Pointer",className:"Product",objectId:t.deviceform.productName},basedata:{auth:t.deviceform.auth,yysId:t.deviceform.yysId}};i=Object.assign(a,o),t.$postDevice(i).then((function(e){e.error?t.initQuery("创建失败","error"):(t.initQuery("创建成功","success"),t.devicedialogVisible=!1,t.getDevices(),t.deviceform={})}))}else t.initQuery("设备已经存在","error")}))}else t.$message("必填项未填")}))},addbatch:function(e){var t=this;return Object(o["a"])(regeneratorRuntime.mark((function a(){return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:t.$refs[e].validate((function(a){if(!a)return!1;if(""===t.batchid){var i="role:"+JSON.parse(t.$Cookies.get("roles"))[0].name,n={};n[i]={read:!0,write:!0};var r={data:{batch_name:t.pcformInline.pcname,createdtime:Math.ceil(t.pcformInline.createdtime/1e3)},ACL:n,key:t.pcformInline.pcname,type:"batch_number"};t.$postDict(r).then((function(a){a.error?t.$message({message:"新增失败".concat(a.error),type:"error"}):(t.$message({message:"新增成功",type:"success"}),t.$refs[e].resetFields(),t.addDeviceBatch())}))}else{var o="role:"+JSON.parse(t.$Cookies.get("roles"))[0].name,l={};l[o]={read:!0,write:!0};var s={objectId:t.batchid,data:{batch_name:t.pcformInline.pcname,createdtime:Math.ceil(t.pcformInline.createdtime/1e3)},ACL:l,type:"batch_number"};t.$putDict(s.objectId,s).then((function(a){a.error?t.initQuery("修改失败","error"):(t.initQuery("修改成功","success"),t.batchid="",t.pcformInline={pcname:"",createdtime:""},t.$refs[e].resetFields(),t.addDeviceBatch())}))}}));case 1:case"end":return a.stop()}}),a)})))()},updatebatch:function(e,t){this.pcformInline.pcname=e.data.batch_name,this.pcformInline.createdtime=1e3*e.data.createdtime,this.batchid=t},deletebatch:function(e){var t=this;this.$deleteDict(e).then((function(e){void 0==e.error?(t.$message({message:"删除成功",type:"success"}),t.addDeviceBatch()):t.$message({message:"删除失败".concat(e.error),type:"error"})}))},selectbatch:function(e,t){this.batchid=t,this.deviceform.pc=e.data.batch_name,this.deviceform.batchId=e.data.batch_name,this.pcdialogVisible=!1},deviceToDetail:function(e){this.$router.push({path:"/roles/editdevices",query:{deviceid:e.objectId,nodeType:e.nodeType,ischildren:"false"}})},handleClick:function(e,t){"second"==e.name&&this.queryDict()},queryDict:function(){var e=this;return Object(o["a"])(regeneratorRuntime.mark((function t(){var a,i;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.$getBatchNumer();case 2:a=t.sent,i=a.results,e.pctableData=i;case 5:case"end":return t.stop()}}),t)})))()},deviceToChildren:function(e){this.$router.push({path:"/roles/editdevices",query:{deviceid:e.objectId,nodeType:e.nodeType,ischildren:"true"}})}}},h=f,v=(a("ffd6d"),a("48a3"),a("2877")),g=Object(v["a"])(h,n,r,!1,null,"73b26beb",null);t["default"]=g.exports},ffd6d:function(e,t,a){"use strict";a("bcb5")}}]);